\documentclass[acmsmall]{acmart}
% \documentclass[letterpaper]{llncs}
% \usepackage[letterpaper, margin=1.5in]{geometry}


\usepackage{multicol}
\usepackage{mathpartir}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage{amsmath}
\usepackage{nccmath}
\usepackage{stmaryrd}
\usepackage{listings}
\usepackage[scaled]{beramono}
\usepackage[T1]{fontenc}
\usepackage[dvipsnames]{xcolor}
\usepackage{array}
\usepackage{wasysym}

\usepackage{pifont}% http://ctan.org/pkg/pifont

\usepackage{graphicx}
\graphicspath{ {./images/} }

\usepackage{url}

\newcounter{pdc}
\newcounter{sdc}

\makeatletter % allow us to mention @-commands
\def\arcr{\@arraycr}
\makeatother

\lstset{
    % identifierstyle=\color{violet},
    % textcolor=blue,
    % keywordstyle=\color{blue},
    % keywordstyle=\text,
    basicstyle=\ttfamily\small,
    % mathescape=true,
    % showspaces=false,
    % morekeywords={def, fix, in}
}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{definition}{Definition}[section]
\newtheorem{property}{Property}[section]
% \newtheorem{proof}{Proof}[section]

\newtheorem{experiment}{Experiment}[section]


\title{Extrinsic Type Inference SUPP (DRAFT 2025-06-03)}
\author{Thomas Logan}



\begin{document}



\newcommand{\pdc}{\stepcounter{pdc}\arabic{pdc}}
\newcommand{\sdc}{\stepcounter{sdc}\arabic{sdc}}

\newcommand{\Par}[1]{\paragraph{\textbf{#1}}}
\newcommand{\J}[1]{\texttt{\fontfamily{pcr}\selectfont #1}}
\newcommand{\lab}[1]{\text{\color{Gray}\ [#1]}}
\newcommand{\entails}{\vdash}
\newcommand{\satisfies}{\vDash}
\newcommand{\given}{\dashv}
\newcommand{\with}{\ \diamond\ }
\newcommand{\notfree}{\ \#\ }
\newcommand{\consis}{\ \star}
\newcommand{\safe}{\ \checkmark}
\newcommand{\relational}{\ \Re}


% \newcommand{\cmark}{\ding{51}}%
% \newcommand{\xmark}{\ding{55}}%
\newcommand{\pass}{\text{\normalsize \color{Green} \ding{51}}}
\newcommand{\assisted}{\text{\normalsize \color{Purple} \ding{45}}}
\newcommand{\fail}{\text{\normalsize \color{red} \ding{55}}}

\newcommand{\unique}{\ \dagger}

\newcommand{\factorsinto}{\Vdash}


\newcommand{\allsafe}{\ \Re\checkmark}

\newcommand{\qua}{\ .\ }



\newcommand{\ignore}{\varnothing}
\newcommand{\dTheta}{\dot{\Theta}}
\newcommand{\closed}{\bullet}
\newcommand{\local}{\blacktriangle}
\newcommand{\open}{\circ}



\newcommand{\up}{\ \land\ }
\newcommand{\down}{\ \lor\ }

% \newcommand{\tl}{\textasciitilde{}}

\newcommand{\multi}[1]{\widebar{\ #1\ }}
\newcommand{\hastype}{:}
\newcommand{\pattype}{\ \lozenge\ }
\newcommand{\liftfun}{:}

\newcommand{\sz}[1]{\text{\small #1}}


\newcommand{\block}[1]{{\footnotesize \[
  \begin{array}[t]{@{} l}
    #1
  \end{array}
\]}}

\newcommand{\ms}[1]{{\footnotesize $(#1)$}}

\newcommand{\code}[1]{\ms{\J{#1}}}


\newcommand{\R}[1]{\color{teal}\ \ [\emph{#1}]}
 
\newcommand{\subtypes}{<:}
\newcommand{\supertypes}{:>}
\newcommand{\I}{\hspace{4mm}}
\newcommand{\Z}{.\hspace{4mm}}
\newcommand{\Alpha}{\mathrm{A}}
\newcommand{\Tau}{\mathrm{T}}
\newcommand{\B}[1]{\textbf{#1}}
\newcommand{\F}[1]{\text{#1}}
\newcommand{\bigand}{\bigwedge\nolimits}
\newcommand{\bigor}{\bigvee\nolimits}
\newcommand{\C}[1]{\color{teal} \rhd\ \emph{#1}}
\newcommand{\com}[1]{\I \emph{#1}}
\newcommand{\D}[1]{\small \textsc{#1}}
% \newcommand{\fig}[1]{Fig. {\color{red} \fig{#1}}}
\newcommand{\FIG}[1]{Fig. {\color{red} \ref{#1}}}
\newcommand{\TODO}[1]{\noindent \B{\color{red} TODO: #1}}

\newcommand{\is}{\ ::=\ }
\newcommand{\sep}{\ \ |\ \ }
\newcommand{\nonterm}[1]{#1\ }
\newcommand{\contin}{|\ \ \ \ \ \ \ }
\newcommand{\wrt}{\B{wrt }}
% \newcommand{\let}{\B{def }}
% \newcommand{\for}{\B{for }}



\newcommand{\pc}{\hfill \break \noindent \ $\diamond$ \ }


\newcommand{\N}{\ $\cdot$\ \ }

\newcommand{\pitem}{\item[$\diamond$]}

\newcommand{\tl}{\textasciitilde{}}
\newcommand{\typdiff}{\J{\textbackslash}}

\maketitle

\section{Ancillaries}
\label{sec:ancillaries}

\TODO{add collection concatentation definition (oplus)}

\TODO{read through definitions and update syntax}

\TODO{organize descriptions}

\TODO{describe the important properties in depth}

\begin{definition}
  \label{def:expression_congruence}
  Expression Congruence 
  \hfill
  \small
  \boxed{e_l \cong e_r}
  \\
  \begin{mathpar}
    \inferrule { 
      \forall \delta, \tau \qua 
      \delta \satisfies e_l \hastype \tau 
      \iff
      \delta \satisfies e_r \hastype \tau
    } {
      e_l \cong e_r 
    } 
  \end{mathpar}
\end{definition}



\begin{definition}
  \label{def:union_drop}
  Union Drop 
  \hfill 
  \small
  \boxed{\alpha \Vdash \tau_r \supertypes \tau_r'}
  \\
  \begin{mathpar}
    \inferrule {
      \alpha \notin \textbf{ftv}(\tau)
    } {
      \alpha \Vdash \tau \supertypes \tau 
    }

    \inferrule {
      \alpha \in \textbf{ftv}(\tau)
      \\
      \alpha \Vdash \tau_l \supertypes \tau_l' 
      \\
      \alpha \Vdash \tau_r \supertypes \tau_r' 
    } {
      \alpha \Vdash \tau_l \J{|} \tau_r \supertypes \tau_l' \J{|} \tau_r'
    }

    \inferrule {
      \alpha \in \textbf{ftv}(\tau)
      \\
      \nexists \tau_l, \tau_r \qua \tau = \tau_l \J{|} \tau_r
    } {
      \alpha \Vdash \tau \supertypes \J{BOT} 
    }
  \end{mathpar}
\end{definition}
\hfill

\begin{definition}
  \label{def:type_negatability}
  Type Negatability
  \hfill 
  \small
  \boxed{\Theta, \Delta \Vvdash \eta}
  \\
  \begin{mathpar}
    \inferrule {
      \textbf{ftv}(\rho) \subseteq \emptyset
    } {
      \Vvdash \rho
    }

    \inferrule {
      \textbf{ftv}(\J{EXI[} \Theta \J{]} \Omega \J{:} \eta) \subseteq \emptyset
      \\
      \Theta, \Delta \Vvdash \Omega
      \\
      \Theta, \Delta \Vvdash \eta
    } {
      \Theta, \Delta \Vvdash \J{EXI[} \Theta \J{]} \Omega \J{:} \eta 
    }
  \end{mathpar}
\end{definition}
\hfill

\begin{definition}
  \label{def:subtyping_sequence_negatability}
  Subtyping Sequence Negatability
  \hfill 
  \small
  \boxed{\Theta, \Delta \Vvdash \Omega}
  \\
  \begin{mathpar}
    \inferrule {
    } {
      \Theta, \Delta \Vvdash \epsilon 
    }

    \inferrule {
      \Theta, \Delta \Vvdash \Omega
      \\
      \Theta, \Delta \Vvdash \eta
    } {
      \Theta, \Delta \Vvdash \Omega\ \tau \J{<:} \eta
    }

    \inferrule {
      \alpha \notin \Theta
      \\
      \Theta, \Delta \Vvdash \Omega
      \\
      (
      \forall \tau' \qua  \alpha \J{<:} \tau' \in \Delta \implies
      \tau' = \J{TOP}
      )
    } {
      \Theta, \Delta \Vvdash \Omega\ \alpha \J{<:} \tau 
    }
  \end{mathpar}
\end{definition}
\hfill

\begin{definition}
  \label{def:typing_consolidation}
  Typing Consolidation 
  \hfill 
  \small
  \boxed{\Theta, \Delta \entails e \hastype \Pi}
  \\
  \begin{mathpar}
    \inferrule {
      (\forall \Theta', \Delta' \qua 
      \Theta' \backslash \Theta, 
      \Delta' \backslash \Delta, 
      \tau 
      \in \Pi
      \implies
      \Theta, \Delta \entails e \hastype \tau \given \Theta', \Delta' 
      )
      \\\\
      \Theta \cup \textbf{ftv}(\Delta) \entails \Pi \searrow \Pi'
    } {
      \Theta, \Delta \entails e \hastype \Pi'
    }
  \end{mathpar}
\end{definition}
\hfill

\begin{definition}
  \label{def:loop_subtyping_consolidation}
  Loop Subtyping Consolidation 
  \hfill 
  \small
  \boxed{\Theta, \Delta \entails \tau \subtypes \alpha \rightarrow \Pi}
  \\
  \begin{mathpar}
    \inferrule {
      (\forall \Theta', \Delta' \qua 
      \Theta' \backslash \Theta, 
      \Delta' \backslash \Delta, 
      \alpha_l \J{->} \alpha_r 
      \in \Pi
      \implies
      \Theta, \Delta \entails \tau \subtypes \alpha \J{->} \alpha_l \J{->} \alpha_r \given \Theta', \Delta' 
      )
      \\\\
      \Theta \cup \textbf{ftv}(\Delta) \entails \Pi \searrow \Pi'
    } {
      \Theta, \Delta \entails \tau \subtypes \alpha \rightarrow \Pi'
    }
  \end{mathpar}
\end{definition}
\hfill

\TODO{...}

\begin{definition} 
  \label{def:function_typing_consolidation}
  Function Typing Consolidation 
  \hfill
  \small
  \boxed{\Theta, \Delta, \Gamma \entails f \liftfun \Pi \sim \Xi}
  \\
  \begin{mathpar}
    \inferrule {
    } {
      \Theta, \Delta, \Gamma \entails \epsilon \liftfun \epsilon \sim \epsilon 
    }

    \inferrule {
      \Theta, \Delta, \Gamma \entails f \liftfun \Pi \sim \Xi 
      \\
      p \hastype \rho \given \Gamma'
      \\
      \text{diff}(\rho, \Xi) = \tau_l
      \\
      \Theta \cup \textbf{ftv}(\Delta) \cup \textbf{ftv}(\Gamma) = \dTheta
      \\\\
      (\forall \Theta', \Delta', \tau_r  \qua 
      \Theta' \backslash \Theta, 
      \Delta' \backslash \Delta, 
      \tau_l \J{->} \tau_r \in \Pi'
      \implies
      \Theta, \Delta, \Gamma' \oplus \Gamma \backslash \textbf{dom}(\Gamma') \entails e \hastype \tau_r \given \Theta', \Delta' 
      )
      \\\\
      \text{capture}(\rho) = \eta
      \\
      \Theta \cup \textbf{ftv}(\Delta) \cup \textbf{ftv}(\Gamma) \entails \Pi' \searrow \Pi'' 
    } {
      \Theta, \Delta, \Gamma \entails f\ \J{?}p\J{=>}e \liftfun 
      \Pi \cup \Pi'' \sim \Xi\ \eta
    }
  \end{mathpar}
\end{definition}



\noindent
Path sequence typing $(\Theta, \Delta, \Gamma \entails f \liftfun \Pi \sim \Xi)$
handles the details of constructing types for each path of a function.
Progression of application tries each path of the applied function is in order.
That is, the application will progress along the first path whose pattern
matches the argument.
To account for this ordering and short-circuiting of pattern matching,
the types for each path of the function must subtract the types of patterns
from earlier paths $\Xi$ when constructing antecedents of path types.  
Each path of the function could branch out,
represented by the typing $(\Gamma \oplus \Gamma' \entails e \hastype \tau_r \given ...)$, 
so each function path can produce multiple path types $(\tau_l \J{->} \tau_r)$, 
which are collected in $\pi'$.

\TODO{explain the tidy up relation}
Keeps things tidy by compacting the subtyping environments and making the path
types more readable.

\begin{theorem} 
  \label{prop:schema_sequence_duality_correspondence}
  Schema Sequence Duality Correspondence
  \\
  \begin{mathpar}
    \inferrule {
      \alpha_\nu \downarrow \Pi_\nu \fallingdotseq \alpha_\mu \uparrow \Pi_\mu
      \\
      \delta \satisfies \Delta
    } {
      (
      \forall \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua
      (\Theta^\dagger,\Delta^\dagger, \tau^\dagger) \in \Pi_\nu \implies
      \exists \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \cong \Theta^\dagger \up
      \\\\
      (
      \forall \delta' \qua
      \textbf{dom}(\delta') \cap \textbf{ftv}(\Delta) = \epsilon \implies
      \\\\
      \delta\ \alpha_\nu \slash \J{BOT} \oplus \delta' \oplus \delta^\dagger \satisfies \Delta^\dagger \implies
      \delta\ \alpha_\nu \slash \J{BOT} \oplus \delta' \oplus \delta^\dagger \satisfies e_f \hastype \tau^\dagger
      )
      )
      \\\\
      \iff
      \\\\
      (\forall e_a, e_r \qua
      (
      \exists \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua
      (\Theta^\dagger,\Delta^\dagger, \tau^\dagger) \in \Pi_\mu \up
      (\forall \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \cong \Theta^\dagger \implies
      \\\\
      \exists \delta' \qua
      \textbf{dom}(\delta') \cap \textbf{ftv}(\Delta) = \epsilon \up
      \\\\
      \delta\ \alpha_\mu \slash \J{TOP} \oplus \delta' \oplus \delta^\dagger \satisfies \Delta^\dagger \up
      \delta\ \alpha_\mu \slash \J{TOP} \oplus \delta' \oplus \delta^\dagger \satisfies (e_a \J{,} e_r) \hastype \tau^\dagger 
      )
      )
      \implies
      e_r \cong e_f\J{(}e_a\J{)}
      )
    }
  \end{mathpar} 
\end{theorem} 

\noindent
Duality correspondence $\alpha_\nu \downarrow \Pi_\nu \fallingdotseq \alpha_\mu \uparrow \Pi_\mu$
rewrites schemas with path types $\Pi_\nu$ into schemas with pair types $\Pi_\nu$
such that for any interpretation $\delta$, a given function $e_f$ 
inhabits all interpretations of every path type schema
if and only if 
there's an argument $e_a$ paired with the function applied to it that inhabits 
at least one of the pair type schemas.

\begin{definition} 
  \label{def:schema_sequence_duality}
  Schema Sequence Duality 
  \hfill
  \small
  \boxed{\alpha_\nu \downarrow \Pi_\nu \fallingdotseq \alpha_\mu \uparrow \Pi_\mu}
  \\
  \begin{mathpar}
    \inferrule {
    } {
      \alpha_{\nu} \downarrow \epsilon
      \fallingdotseq 
      \alpha_{\mu} \uparrow \epsilon 
    }

    \inferrule {
      \alpha_{\nu} \downarrow \Pi_\nu
      \fallingdotseq 
      \alpha_{\mu} \uparrow \Pi_\mu
      \\
      \alpha_\nu \downarrow \Delta_\nu \fallingdotseq \alpha_\mu \uparrow \Delta_\mu
    } {
      \alpha_{\nu} \downarrow \Pi_\nu\ (\Theta_c,\Delta_\nu, \tau_l \J{->} \tau_r)
      \fallingdotseq 
      \alpha_{\mu} \uparrow \Pi_\mu\ (\Theta_c,\Delta_\mu, \tau_l \J{*} \tau_r)
    }
  \end{mathpar}
\end{definition}

\noindent
The duality correspondence predicate unrolls the two sequences of schemas simultaneously.  
In the case where both sequence are empty
$
\alpha_{\nu} \downarrow \epsilon
\fallingdotseq 
\alpha_{\mu} \uparrow \epsilon 
$, duality correspondence simply holds.
Otherwise, duality correspondence requires that the left sequence's last schema 
has a path type  $(\Theta_c,\Delta_\nu, \tau_l \J{->} \tau_r)$
and the right sequence's last schema has a pair type 
$(\Theta_c,\Delta_\nu, \tau_l \J{*} \tau_r)$;
the subtyping environments correspond 
$\alpha_\nu \downarrow \Delta_\nu \fallingdotseq \alpha_\mu \uparrow \Delta_\mu$;
and the earlier sequences of schemas correspond
$
\alpha_{\nu} \downarrow \Pi_\nu
\fallingdotseq 
\alpha_{\mu} \uparrow \Pi_\mu
$
.

\begin{theorem} 
  \label{prop:subtyping_environment_duality_correspondence}
  Subtyping Environment Duality Correspondence 
  \\
  \begin{mathpar}
    \inferrule {
      \alpha_\nu \downarrow \Delta_\nu \fallingdotseq \alpha_\mu \uparrow \Delta_\mu
    } {
      (
      \forall \tau_\nu, \Delta_\nu  \qua
      \delta\ \alpha_\nu \slash \tau_\nu \satisfies \Delta_\nu \implies
      \delta\ \alpha_\nu \slash \tau_\nu 
      \satisfies e_f \hastype \tau_\nu
      )
      \\\\
      \iff
      \\\\
      (
      \exists \tau_\mu, \Delta_\mu, e_a \qua
      \delta\ \alpha_\mu \slash \tau_\mu \satisfies \Delta_\mu \land
      \delta\ \alpha_\mu \slash \tau_\mu 
      \satisfies (e_a \J{,} e_f\J{(} e_a \J{)}) \hastype \tau_\mu
      )
      )
    }
  \end{mathpar} 
\end{theorem} 

\noindent
Subtyping duality correspondence $
  \alpha_\nu \downarrow \Delta_\nu \fallingdotseq \alpha_\mu \uparrow \Delta_\mu
$ rewrites a subtyping environment $\Delta_\nu$ containing path type upper bounds
on variable $\alpha_\nu$ 
into a subtyping environment $\Delta_\mu$ containing pair type lower bounds 
on variable $\alpha_\mu$,
such that 
for any interpretation $\delta$, a given function $e_f$
inhabits all types $\tau_\nu$ constrained by the environment's path type upper bounds
if and only if 
there's an argument $e_a$ paired with the function applied to it that inhabits 
at least one type $\tau_\mu$ constrained by the environment's pair type lower bounds.

\begin{definition}
  \label{def:subtyping_environment_duality}
  Subtyping Environment Duality
  \hfill
  \small
  \boxed{\alpha_\nu \downarrow \Delta_\nu \fallingdotseq \alpha_\mu \uparrow \Delta_\mu}
  \\
  \begin{mathpar}

    \inferrule {
    } {
      \alpha_\nu \downarrow \epsilon \fallingdotseq \alpha_\mu \uparrow \epsilon 
    }

    % \inferrule {
    %   \alpha_\nu \notin \textbf{ftv}(\tau_l)
    %   \\
    %   \alpha_\nu \notin \textbf{ftv}(\tau_r)
    %   \\
    %   \alpha_\nu \downarrow \Delta_\nu \fallingdotseq \alpha_\mu \uparrow \Delta_\mu
    % } {
    %   \alpha_\nu \downarrow \Delta_\nu \  \tau_l \J{<:} \tau_r 
    %   \fallingdotseq 
    %   \alpha_\mu \uparrow \Delta_\mu \  \tau_l \J{<:} \tau_r
    % }

    \inferrule {
      \alpha_\nu \downarrow \Delta_\nu \fallingdotseq \alpha_\mu \uparrow \Delta_\mu
    } {
      \alpha_\nu \downarrow \Delta_\nu \  \alpha_\nu \J{<:} \alpha_l \J{->} \alpha_r
      \fallingdotseq 
      \alpha_\mu \uparrow \Delta_\mu \  \alpha_l \J{*} \alpha_r \J{<:} \alpha_\mu 
    }
  \end{mathpar}
\end{definition}

\noindent
The subtyping duality correspondence predicate unrolls the two subtyping environments simultaneously.
In the case where both environments are empty 
$
  \alpha_\nu \downarrow \epsilon \fallingdotseq \alpha_\mu \uparrow \epsilon 
$, subtyping duality correspondence simply holds.
In the case where the subtyping constraints are the same,
the upper bounded variable $\alpha_\nu$ must not appear in the subtype $\tau_l$;
the lower bounded variable $\alpha_\mu$ must not appear in the supertype $\tau_r$;
and the correspondence must hold for the previous constraints in the environment
$\alpha_\nu \downarrow \Delta_\nu \fallingdotseq \alpha_\mu \uparrow \Delta_\mu$
.
Lastly, subtyping duality correspondence holds if
the last subtyping of each subtyping environment contains
the path type upper bounds $\alpha_\nu \J{<:} \alpha_l \J{->} \alpha_r$
and pair type lower bounds $\alpha_l \J{*} \alpha_r \J{<:} \alpha_\mu$ on the specified variables,
and the the correspondence holds for the previous constraints in the environment

\begin{theorem}
  \label{prop:type_interpretation_soundness}
  Type Interpretation Soundness 
  \\
  \begin{mathpar}
    \inferrule { 
      \llbracket \Theta \entails \Delta, \tau \rrbracket^\pm = (\Delta', \tau')
      \\
      \Theta \subseteq \textbf{dom}(\delta')
    } {
      \exists \delta .\ 
      (
      \delta \oplus \delta' \satisfies \Delta
      \land
      \delta \oplus \delta' \satisfies e \hastype \tau
      )
      \iff
      (
      \delta' \satisfies \Delta'
      \land
      \delta' \satisfies e \hastype \tau'
      )
    } 
  \end{mathpar}
\end{theorem}

\noindent
Type interpretation $\llbracket \Theta_\ignore, \Theta \entails \Delta, \tau \rrbracket^\pm = (\Delta', \tau')$
constructs a type $\tau'$, such that $\tau'$ is behaves like the input type $\tau$ for some interpretation $\delta$. 
The positive form $\llbracket ... \rrbracket^+$ constructs the strongest type or tries to get close to the strongest type possible.  
The negative form $\llbracket ... \rrbracket^-$ constructs the weakest type or tries to get close to the weakest type possible. 
The type variables $\Theta_\ignore$ and $\Theta$ must be irrelevant, meaning
the constructed type $\tau'$ must behave like $\tau$ 
for all interpretations over those variables $\delta'$.
Additionally, any interpretation $\delta'$ for the resulting subtyping environment $\Delta$' must
be part of some interpretation for the original subtyping environment $\Delta$.

The details of finding the type interpretation involves numerous tedious details, so we leave the definition
in the appendix (Section \ref{sect:appendix}).


\noindent
Packing ($\textbf{pack}^\pm(\Theta_\ignore \entails \Pi) = \tau'$)
constructs a type $\tau'$ from the schemas $\Pi$
such that for each schema $(\Theta, \Delta, \tau)$,
it binds the variables of the type $\tau$ within
some combination of 
existentials and/or universals,
where indexes are qualified by the constraints 
of the subtyping environment $\Delta$.
The choice of binding in an existential or universal is 
determined by whether the variable is open ($\alpha \not\in \Theta$)
or closed ($\alpha \in \Theta$)
and whether the interpretation is 
positive ($\textbf{pack}^+(...)$) or negative ($\textbf{pack}^-(...)$).
For the positive form, the construction (including how the closed variables are bound)
must result in a type $\tau'$ that is weaker than the type of every schema in every interpretation
of the closed variables $\delta'$, for some interpretation of the open variables $\delta$  
.
For the negative form, the construction must result in a type $\tau'$
that is stronger than the type of every schema in every interpretation
of the closed variables $\delta'$, for some interpretation of the open variables $\delta$  
.

The interested reader can find the actual the definition of packing in the appendix (Section \ref{sect:appendix}).

\begin{definition} 
  \label{def:type_interpretation}
  Type Interpretation 
  \hfill
  \small
  \boxed{
    \llbracket \Theta, \Delta \entails \tau \rrbracket^\pm = \tau'
  }
  \\
  \[
  \begin{array}[t]{r@{}c@{}lcl}
      \llbracket \Theta, \Delta \entails \alpha \rrbracket^\pm 
      &\ =\ & 
      \llbracket \Delta \star  \alpha \rrbracket^\pm
      &\text{if}& 
      \alpha \notin \Theta

      \\

      &&
      \alpha
      &\text{if}&
      \alpha \in \Theta

      \\

      \llbracket \Theta, \Delta \entails \J{@} \rrbracket^\pm 
      &\ =\ & 
      \J{@}
      &&

      \\

      \llbracket \Theta, \Delta \entails \J{<}l\J{>}\tau \rrbracket^\pm
      &\ =\ & 
      \J{<}l\J{>}\llbracket \Theta, \Delta \entails \tau \rrbracket^\pm

      \\

      \llbracket \Theta, \Delta \entails \tau_l\J{->}\tau_r \rrbracket^\pm 
      &\ =\ & 
      \llbracket \Theta, \Delta \entails \tau_l \rrbracket^{\text{flip}(\pm)}
      \J{->}
      \llbracket \Theta, \Delta \entails \tau_r \rrbracket^\pm

      \\

      \llbracket \Theta, \Delta \entails \tau_l\J{|}\tau_r \rrbracket^\pm
      &\ =\ & 
      \llbracket \Theta, \Delta \entails \tau_l \rrbracket^\pm
      \J{|}
      \llbracket \Theta, \Delta \entails \tau_r \rrbracket^{\pm}

      \\

      \llbracket \Theta, \Delta \entails \tau_l\J{\&}\tau_r \rrbracket^\pm 
      &\ =\ & 
      \llbracket \Theta, \Delta \entails \tau_l \rrbracket^\pm
      \J{\&}
      \llbracket \Theta, \Delta \entails \tau_r \rrbracket^{\pm}

      \\

      \llbracket \Theta, \Delta \entails \J{EXI[}\Theta_q\J{]} \Delta_q\ \tau \rrbracket^\pm 
      &\ =\ & 
      \J{EXI[}\Theta_q\J{]} \llbracket \Theta \cup \Theta_q, \Delta \entails \Delta_q \rrbracket^\pm 
      \ \llbracket \Theta \cup \Theta_q, \Delta \entails \tau \rrbracket^{\pm}

      \\

      \llbracket \Theta, \Delta \entails \J{ALL[}\Theta_q\J{]} \Delta_q\ \tau \rrbracket^\pm 
      &\ =\ & 
      \J{ALL[} \Theta_q \J{]} \llbracket \Theta \cup \Theta_q, \Delta \entails \Delta_q \rrbracket^\pm
      \ \llbracket \Theta \cup \Theta_q, \Delta \entails \tau \rrbracket^{\pm}

      \\

      \llbracket \Theta, \Delta \entails \tau \typdiff \eta \rrbracket^\pm 
      &\ =\ & 
      \llbracket \Theta, \Delta \entails \tau \rrbracket^\pm \typdiff \eta

      \\

      \llbracket \Theta, \Delta \entails \J{LFP[}\alpha \J{]} \tau \rrbracket^\pm 
      &\ =\ & 
      \J{LFP[}\alpha \J{]}\llbracket \Theta\ \alpha, \Delta \entails \tau \rrbracket^{\pm}
      \\
  \end{array}
  \]
\end{definition}

\begin{definition} 
  \label{def:qualification_interpretation}
  Qualification Interpretation 
  \hfill
  \small
  \boxed{
    \llbracket \Theta, \Delta \entails \Delta_q \rrbracket^\pm = \Delta_q'
  }
  \\
  \[
  \begin{array}[t]{r@{}c@{}lcl}
      \llbracket \Theta, \Delta \entails \epsilon \rrbracket^\pm
      &\ =\ & 
      \epsilon
      && 

      \\

      \llbracket \Theta, \Delta \entails \Delta_q \  \tau_l \J{<:} \tau_r \rrbracket^\pm
      &\ =\ & 
      \llbracket \Theta, \Delta \entails \Delta_q\rrbracket^\pm\  
      \llbracket \Theta, \Delta \entails \tau_l \rrbracket^{\text{flip}(\pm)} 
      \J{<:} 
      \llbracket \Theta, \Delta \entails \tau_r \rrbracket^\pm
  \end{array}
  \]
\end{definition} 

\TODO{...}


% \begin{definition} 
%   \label{def:pruning_interpretation}
%   Pruning Interpretation 
%   \hfill
%   \boxed{
%     \llbracket \Theta \star \Delta, \alpha \rrbracket^\pm = (\Delta', \tau)
%   }
%   \\
%   \[
%   \begin{array}[t]{r@{}c@{}lcl}
%       \llbracket \Theta \star \Delta, \alpha \rrbracket^\pm
%       &\ =\ & 
%       (\Delta', \tau)
%       &\text{if}& 
%       \begin{array}[t]{@{}l}
%         (\forall \tau_l\ \tau_r .\  \tau_l \J{<:} \tau_r \in \Delta' \iff \Theta, \Theta_\bullet, \Delta, \alpha \looparrowright^\pm \tau_l \subtypes \tau_r)
%         \\
%         \llbracket \Delta\backslash\Delta', \alpha \rrbracket^\pm = (\Delta', \tau)
%       \end{array}

%       \\
%   \end{array}
%   \]
% \end{definition}

% \TODO{...}

% \begin{definition} 
%   \label{def:indirection}
%   Indirection  
%   \hfill
%   \boxed{
%     \Theta, \Delta, \alpha \looparrowright^\pm \tau_l \subtypes \tau_r 
%   }
%   \\
%   \begin{mathpar}
%     \inferrule {
%       \ \alpha\J{<:}\tau \in \Delta 
%       \\\\
%       \alpha' \in \textbf{ftv}(\tau) \backslash \Theta
%       \\
%       \ \alpha'\J{<:}\tau' \in \Delta 
%     } {
%       \Theta, \Delta, \alpha \looparrowright^- \alpha \subtypes \tau
%     }

%     \inferrule {
%       \ \alpha\J{<:}\tau \in \Delta 
%       \\\\
%       \alpha' \in \textbf{ftv}(\tau) \backslash \Theta
%       \\
%       \ \alpha'\J{<:}\tau' \in \Delta 
%     } {
%       \Theta, \Delta, \alpha \looparrowright^- \alpha' \subtypes \tau'
%     }
%     \\
%     \inferrule {
%       \ \tau \J{<:} \alpha\in \Delta 
%       \\\\
%       \alpha' \in \textbf{ftv}(\tau) \backslash \Theta
%       \\
%       \ \tau'\J{<:} \alpha' \in \Delta 
%     } {
%       \Theta, \Delta, \alpha \looparrowright^+ \tau \subtypes \alpha
%     }

%     \inferrule {
%       \ \tau \J{<:} \alpha\in \Delta 
%       \\\\
%       \alpha' \in \textbf{ftv}(\tau) \backslash \Theta
%       \\
%       \ \tau'\J{<:} \alpha' \in \Delta 
%     } {
%       \Theta, \Delta, \alpha \looparrowright^+ \tau' \subtypes \alpha'
%     }
%   \end{mathpar}
% \end{definition}

% \TODO{...}

\begin{definition} 
  \label{def:variable_interpretation}
  Variable Interpretation
  \hfill
  \small
  \boxed{
    \llbracket\Delta \star \alpha \rrbracket^\pm = \tau
  }
  \\
  \[
  \begin{array}[t]{r@{}c@{}lcl}

      \llbracket \epsilon \star \alpha \rrbracket^-
      &\ =\ & 
      \J{TOP}

      \\

      \llbracket \Delta \ \alpha  \J{<:} \tau \star \alpha \rrbracket^- 
      &\ =\ & 
      \llbracket \Delta \star \alpha \rrbracket^- \J{\&} \tau

      \\

      \llbracket \Delta \ \tau_l \J{<:} \tau_r \star \alpha \rrbracket^- 
      &\ =\ & 
      \llbracket \Delta, \alpha \rrbracket^-
      &\text{if}& 
      \begin{array}[t]{@{}l}
        \alpha \neq \tau_l
      \end{array}

      \\

      \llbracket \epsilon \star \alpha \rrbracket^+ 
      &\ =\ & 
      \J{BOT}

      \\

      \llbracket \Delta \  \tau \J{<:} \alpha \star \alpha \rrbracket^+ 
      &\ =\ & 
      \llbracket \Delta \star \alpha \rrbracket^+ \J{|} \tau

      \\

      \llbracket \Delta \ \tau_l \J{<:} \tau_r \star \alpha \rrbracket^+ 
      &\ =\ & 
      \llbracket \Delta \star \alpha \rrbracket^+
      &\text{if}& 
      \begin{array}[t]{@{}l}
        \alpha \neq \tau_r
      \end{array}
  \end{array}
  \]
\end{definition}

\TODO{...}

\TODO{update type packing to place constraints on inside if they have neither skolem nor learnable variables} 
\TODO{the inner constraints will not be required to have conform to a decidable syntax}

\TODO{update implementation to check restriction on skolem constraints}

\TODO{double check that tests still pass}

\begin{definition}
  \label{def:type_packing}
  Type Packing 
  \hfill
  \small
  \boxed{\textbf{pack}^\pm(\dTheta \entails \Theta, \Delta, \tau) = \tau'} 
  \\
  \[
  \begin{array}[t]{r@{}c@{}lcl}
      \textbf{pack}^\pm(\dTheta \entails \Theta, \Delta, \tau) 
      &\ =\ & 
      \text{wrap}^{\pm}(\Theta_o, \Delta_o, \Theta_i, \Delta_i, \tau)
      &\text{if}& 
      \begin{array}[t]{@{}l}
        \textbf{ftv}(\tau) = \Theta_p
        \\
        \dTheta, \Theta \entails \Delta \rightrightarrows \Delta_o, \Delta_i 
        \\
        (\textbf{ftv}(\Delta) \cup \Theta_p) \cap \Theta = \Theta_o 
        \\
        \textbf{ftv}(\Delta_i) \cup \Theta_p \backslash \Theta \backslash \dTheta = \Theta_i 
      \end{array}
  \end{array}
  \]
\end{definition}


\begin{definition}
  \label{def:multiple_type_packing}
  Multiple Type Packing 
  \hfill
  \boxed{\textbf{pack}^\pm(\Theta \entails \Pi) = \tau}\ 
  \\
  \[
  \begin{array}[t]{r@{}c@{}lcl}
      \textbf{pack}^+(\Theta_\ignore \entails \epsilon) 
      &\ =\ & 
      \J{TOP} 

      \\

      \textbf{pack}^+(\Theta_\ignore \entails \Pi\ (\Theta, \Delta, \tau)) 
      &\ =\ & 
      \tau_l \J{\&} \tau_r
      &\text{if}& 
      \begin{array}[t]{@{}l}
        \textbf{pack}^+(\Theta_\ignore \entails \Pi) = \tau_l 
        \\
        \textbf{pack}^+(\Theta_\ignore \entails \Theta, \Delta, \tau) = \tau_r
      \end{array}

      \\

      \textbf{pack}^-(\Theta_\ignore \entails \epsilon) 
      &\ =\ & 
      \J{BOT} 

      \\

      \textbf{pack}^-(\Theta_\ignore \entails \Pi\ (\Theta, \Delta, \tau))
      &\ =\ & 
      \tau_l \J{|} \tau_r
      &\text{if}& 
      \begin{array}[t]{@{}l}
        \textbf{pack}^-(\Theta_\ignore \entails \Pi) = \tau_l
        \\
        \textbf{pack}^-(\Theta_\ignore \entails \Theta, \Delta, \tau) = \tau_r
      \end{array}
  \end{array}
  \]
\end{definition}


\begin{definition}
  \label{def:polar_subtyping_environment_substitution}
  Polar Subtyping Environment Substitution 
  \hfill
  \small
  \boxed{\Delta[\alpha\slash\tau]^\pm = \Delta}\ 
  \\
  \begin{mathpar}
    \TODO{...}
  \end{mathpar}
\end{definition}

\begin{definition}
  Subtyping Environment Filter 
  \hfill
  \small
  \boxed{\Theta \entails \Delta \dashrightarrow \Delta'}
  \\
  \begin{mathpar}
    \inferrule {
    } {
      \Theta \entails \epsilon \dashrightarrow \epsilon 
    }

    \inferrule {
      \exists \alpha .\ \alpha \in (\textbf{ftv}(\tau_l) \cup \textbf{ftv}(\tau_r)) \cap \Theta
      \\
      \Theta \entails \Delta \dashrightarrow \Delta'
    } {
      \Theta \entails  \Delta \  \tau_l \J{<:} \tau_r\dashrightarrow \Delta' \  \tau_l \J{<:} \tau_r
    }

    \inferrule {
      \forall \alpha .\ \alpha \in \Theta \implies \alpha \notin \textbf{ftv}(\tau_l) \cup \textbf{ftv}(\tau_r)
      \\
      \Theta \entails \Delta \dashrightarrow \Delta'
    } {
      \Theta \entails  \Delta \  \tau_l \J{<:} \tau_r\dashrightarrow \Delta'
    }
  \end{mathpar}
\end{definition}

\TODO{need lemma for correctness}

\begin{definition}
   Schema Sequence Compaction
  \hfill
  \small
  \boxed{\dTheta \entails \Pi \searrow \Pi'}
  \\
  \begin{mathpar}
    \inferrule {
    } {
      \dTheta \entails \epsilon \searrow \epsilon 
    }

    \inferrule {
      \dTheta \entails \Pi \searrow \Pi'
      \\
      \dTheta \cup \Theta \entails \Delta \dashrightarrow \Delta'
      \\
      \llbracket \dTheta \cup \Theta, \Delta \entails \tau \rrbracket^\pm = \tau'
    } {
      \dTheta \entails \Pi\ (\Theta, \Delta, \tau) \searrow \Pi'\ (\Theta, \Delta', \tau')
    }
  \end{mathpar}
\end{definition}

\TODO{need lemma for correctness}

\begin{definition}
  Outer
  \hfill
  \small
  \boxed{\text{outer}(\pm) = \J{ALL}|\J{EXI}}
  \\
  \[\begin{array}[t]{r@{}c@{}lcl}
    \\
    \text{outer}(+) 
    &\ =\ & 
    \J{EXI} 
    % & \C{positive} 
    \\
    \text{outer}(-) 
    &\ =\ & 
    \J{ALL} 
    % & \C{negative} 
  \end{array}\]
\end{definition}

\begin{definition}
  Inner
  \hfill
  \small
  \boxed{\text{inner}(\pm) = \J{ALL}|\J{EXI}}
  \\
  \[\begin{array}[t]{r@{}c@{}lcl}
    \\
    \text{inner}(+) 
    &\ =\ & 
    \J{ALL} 
    % & \C{positive} 
    \\
    \text{inner}(-) 
    &\ =\ & 
    \J{EXI} 
    % & \C{negative} 
  \end{array}\]
\end{definition}

\begin{definition}
  Wrap
  \hfill
  \small
  \boxed{\text{wrap}^{\pm}(\Theta, \Delta, \Theta, \Delta, \tau) = \tau}
  \\
  \[
  \begin{array}[t]{r@{}c@{}lcl}
    \text{wrap}^{\pm}(\epsilon, \epsilon, \epsilon, \epsilon, \tau) 
    &\ =\ & 
    \tau
    \\
    \text{wrap}^{\pm}(\epsilon, \epsilon, \Theta_i, \Delta_i, \tau) 
    &\ =\ & 
    \text{inner}(\pm)\J{[}\Theta_i\J{ }\Delta_i\J{]}\tau
    \\
    \text{wrap}^{\pm}(\Theta_o, \Delta_o, \epsilon, \epsilon, \tau) 
    &\ =\ & 
    \text{outer}(\pm)\J{[}\Theta_o\J{ }\Delta_o\J{]}\tau
    \\
    \text{wrap}^{\pm}(\Theta_o, \Delta_o, \Theta_i, \Delta_i, \tau) 
    &\ =\ & 
    \text{outer}(\pm)\J{[}\Theta_o\J{ }\Delta_o\J{]}
    \text{inner}(\pm)\J{[}\Theta_i\J{ }\Delta_i\J{]}
    \tau
  \end{array}\]
\end{definition}


\begin{definition}
  Partition
  \hfill
  \small
  \boxed{\Theta_\ignore , \Theta \entails \Delta \rightrightarrows \Delta_o , \Delta_i}
  \\
  \begin{mathpar}
    \inferrule {
    } {
      \Theta_\ignore , \Theta \entails \epsilon \rightrightarrows \epsilon , \epsilon 
    }

    \inferrule {
      \Theta_\ignore , \Theta \entails \Delta \rightrightarrows \Delta_o , \Delta_i 
      \\\\
      \exists \alpha .\ \alpha \in (\textbf{ftv}(\tau_l) \cup \textbf{ftv}(\tau_r)) \backslash \Theta_\ignore \backslash \Theta
    } {
      \Theta_\ignore , \Theta \entails \Delta \  \tau_l \J{<:}\tau_r \rightrightarrows \Delta_o , \Delta_i \  \tau_l \J{<:} \tau_r
    }

    \inferrule {
      \Theta_\ignore , \Theta \entails \Delta \rightrightarrows \Delta_o , \Delta_i 
      \\\\
      \exists \alpha .\ \alpha \in (\textbf{ftv}(\tau_l) \cup \textbf{ftv}(\tau_r)) \cap \Theta 
      \\
      \textbf{ftv}(\tau_l) \cup \textbf{ftv}(\tau_r) \subseteq \Theta_\ignore \cup \Theta
    } {
      \Theta_\ignore , \Theta \entails \Delta \  \tau_l \J{<:}\tau_r \rightrightarrows \Delta_o  \  \tau_l \J{<:} \tau_r , \Delta_i
    }
  \end{mathpar}

\end{definition}

\section{Model Theory}
\label{sec:model_theory}

\begin{theorem}
  \label{thm:record_extension_preservation}
  Record Extension Preservation 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies r \hastype \tau
      \\
      \nexists e' .\ \J{<} l \J{>} e' \in r
    } {
      \delta \satisfies r\ \J{<}l\J{>}e \hastype \tau
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:entry_type_introduction}
  Entry Type Introduction 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies e \hastype \tau
      \\
      \nexists e' .\ \J{<} l \J{>} e' \in r
    } {
      \delta \satisfies r\ \J{<}l\J{>}e \hastype \J{<}l\J{>} \tau
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_typing_entry_elimination}
  Model Typing Entry Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies e \hastype \J{<}l\J{>} \tau
    } {
      \delta \satisfies e \J{.} l \hastype \tau
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:entry_type_preservation}
  Entry Type Preservation 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau_l \subtypes \tau_r
    } {
      \delta \satisfies \J{<}l\J{>} \tau_l \subtypes \J{<}l\J{>} \tau_r
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_union_type_path_antecedent}
  Model Subtyping Union Type Path Antecedent 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      \delta \satisfies 
      (\tau_a\J{->}\tau_r)\J{\&}(\tau_b\J{->}\tau_r)
      \subtypes 
      (\tau_a\J{|}\tau_b)\J{->}\tau_r)
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_intersection_type_path_consequent}
  Model Subtyping Intersection Type Path Consequent 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      \delta \satisfies 
      (\tau_r\J{->}\tau_a)\J{\&}(\tau_r\J{->}\tau_b)
      \subtypes 
      \tau_r\J{->}(\tau_a\J{\&}\tau_b)
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_intersection_type_entry_consequent}
  Model Subtyping Intersection Type Entry Consequent 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      \delta \satisfies 
      (\J{<}l\J{>}\tau_a)\J{\&}(\J{<}l\J{>}\tau_b)
      \subtypes 
      \J{<}l\J{>}(\tau_a\J{\&}\tau_b)
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_transitivity}
  Model Subtyping Transitivity 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau \subtypes \tau'
      \\
      \delta \satisfies \tau' \subtypes \tau''
    } {
      \delta \satisfies \tau \subtypes \tau''
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_typing_path_elimination}
  Model Typing Path Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies e_f \hastype \tau \J{->} \tau'
      \\
      \delta \satisfies e_a \hastype \tau
    } {
      \delta \satisfies e_f \J{(} e_a \J{)} \hastype \tau'
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:path_type_preservation}
  Path Type Preservation 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau_x \subtypes \tau_p
      \\
      \delta \satisfies \tau_q \subtypes \tau_y 
    } {
      \delta \satisfies \tau_p \J{->} \tau_q \subtypes \tau_x \J{->} \tau_y
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:annotated_binding_introduction}
  Annotated Binding Introduction  
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies e \hastype \tau
      \\
      \delta \satisfies  e'[x \slash e]\hastype \tau'
    } {
      \delta \satisfies \J{def } x \J{:} \tau \J{ = } e \J{ in } e' \hastype \tau'
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_sequence_introduction}
  Model Subtyping Sequence Introduction 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \Delta
      \\
      \delta \satisfies \Delta'
    } {
      \delta \satisfies \Delta \cup \Delta'
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_sequence_elimination}
  Model Subtyping Sequence Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \Delta'
      \\
      \Delta \subseteq \Delta'
    } {
      \delta \satisfies \Delta
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_sequence_interpretation_independence}
  Model Subtyping Sequence Interpretation Independence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \textbf{dom}(\delta') \cap \textbf{ftv}(\Delta) = \emptyset
    } {
      \delta \satisfies \Delta
      \iff
      \delta \oplus \delta' \satisfies \Delta
    }
  \end{mathpar}
\end{theorem}
\hfill


\begin{theorem}
  \label{thm:model_typing_interpretation_independence}
  Model Typing Interpretation Independence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \textbf{dom}(\delta') \cap \textbf{ftv}(\tau) = \emptyset
    } {
      \delta \satisfies e \hastype \tau 
      \iff
      \delta \oplus \delta' \satisfies e \hastype \tau 
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:subtyping_interpretation_independence}
  Subtyping Interpretation Independence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \textbf{dom}(\delta') \cap \textbf{ftv}(\tau) = \emptyset
      \\
      \textbf{dom}(\delta') \cap \textbf{ftv}(\tau') = \emptyset
    } {
      \delta \satisfies \tau \subtypes \tau' 
      \iff
      \delta \oplus \delta' \satisfies \tau \subtypes \tau' 
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:subtyping_interpretation_reordering}
  Subtyping Interpretation Reordering 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \textbf{dom}(\delta_1) \cap \textbf{dom}(\delta_2) = \emptyset
    } {
      \delta_0 \oplus \delta_1 \oplus \delta_2 \oplus \delta_3 \satisfies \tau \subtypes \tau' 
      \iff
      \delta_0 \oplus \delta_2 \oplus \delta_1 \oplus \delta_3 \satisfies \tau \subtypes \tau' 
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:submodel_typing_sequence_interpretation_reordering}
  Subtyping Environment Interpretation Reordering 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \textbf{dom}(\delta_1) \cap \textbf{dom}(\delta_2) = \emptyset
    } {
      \delta_0 \oplus \delta_1 \oplus \delta_2 \oplus \delta_3 \satisfies \Delta 
      \iff
      \delta_0 \oplus \delta_2 \oplus \delta_1 \oplus \delta_3 \satisfies \Delta 
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_sequence_interpretation_independence}
  Subtyping Environment Interpretation Independence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \textbf{dom}(\delta') \cap \textbf{ftv}(\Delta) = \emptyset
    } {
      \delta \satisfies \Delta 
      \iff
      \delta \oplus \delta' \satisfies \Delta 
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_typing_sequence_interpretation_independence}
  Model Typing Sequence Interpretation Independence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \textbf{dom}(\delta') \cap \textbf{ftv}(\Gamma) = \emptyset
    } {
      \delta, \sigma \satisfies \Gamma 
      \iff
      \delta \oplus \delta', \sigma \satisfies \Gamma
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:domain_extension}
  Domain Extension 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \textbf{dom}(\delta_l) = \Theta_l  
      \\
      \textbf{dom}(\delta_r) = \Theta_r  
    } {
      \textbf{dom}(\delta_l \oplus \delta_r) = \Theta_l \cup \Theta_r 
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_typing_subsumption}
  Subsumption 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau \subtypes \tau'
      \\
      \delta \satisfies e \hastype \tau
    } {
      \delta \satisfies e \hastype \tau'
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_union_type_elimination}
  Model Subtyping Union Type Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau_l \subtypes \tau
      \\
      \delta \satisfies \tau_r \subtypes \tau
    } {
      \delta \satisfies \tau_l \J{|} \tau_r \subtypes \tau
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_indexed_union_type_elimination}
  Model Subtyping Indexed Union Type Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      (
      \forall \delta' \qua 
      \textbf{dom}(\delta') \subseteq \Theta \implies
      \delta \oplus \delta' \satisfies \Delta \implies 
      \delta \oplus \delta' \satisfies \tau \subtypes \tau'
      )
      \\
      \Theta \cap \textbf{ftv}(\tau') = \emptyset
    } {
      \delta \satisfies \J{EXI[} \Theta \J{]}\Delta\ \tau \subtypes \tau'
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_intersection_type_introduction}
  Model Subtyping Union Type Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau \subtypes \tau_l
      \\
      \delta \satisfies \tau \subtypes \tau_r
    } {
      \delta \satisfies \tau \subtypes \tau_l \J{\&} \tau_r
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_indexed_intersection_type_introduction}
  Model Subtyping Indexed Intersection Type Introduction 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      (
      \forall \delta' \qua 
      \textbf{dom}(\delta') \subseteq \Theta \implies
      \delta \oplus \delta' \satisfies \Delta \implies 
      \delta \oplus \delta' \satisfies \tau \subtypes \tau'
      )
      \\
      \Theta \cap \textbf{ftv}(\tau') = \emptyset
    } {
      \delta \satisfies \tau \subtypes \J{ALL[} \Theta \J{]}\Delta\ \tau
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:least_fixed_point_type_elimination}
  Least Fixed Point Type Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies e \hastype \J{LFP[}\alpha\J{]}\tau
    } {
      \delta\ \alpha \slash \J{TOP} \satisfies e \hastype \tau
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_induction}
  Model Subtyping Induction 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      (
      \forall \tau \qua
      \delta \satisfies \tau \subtypes \tau_r
      \implies
      \delta\ \alpha \slash \tau \satisfies \tau_l \subtypes \tau_r
      )
      \\
      \alpha \notin \textbf{ftv}(\tau_r)
    } {
      \delta \satisfies \J{LFP[}\alpha\J{]}\tau_l \subtypes \tau_r
    }
  \end{mathpar}
\end{theorem}

\begin{theorem}
  \label{thm:left_congruence}
  Left Congruence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      (e_l\J{,}e_r)\J{.left} \cong e_l
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:right_congruence}
  Right Congruence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      (e_l\J{,}e_r)\J{.right} \cong e_r
    }
  \end{mathpar}
\end{theorem}
\hfill


\begin{theorem}
  \label{thm:model_typing_path_elimination_loop}
  Path Type Elimination Loop 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies e \hastype \alpha \J{->} \tau
    } {
      \delta \satisfies \J{loop(}e\J{)} \hastype \tau
    } {
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:path_type_introduction}
  Path Type Introduction 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \forall e_a \qua
      \delta \satisfies e_a \hastype \tau_l 
      \implies
      \delta \satisfies e_f \J{(} e_a \J{)} \hastype \tau_r
    } {
      \delta \satisfies e_f \hastype \tau_l \J{->} \tau_r
    } {
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_difference_elimination}
  Model Subtyping Difference Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau_0 \subtypes \tau_1 \J{|} \tau_2
    } {
      \delta \satisfies \tau_0 \typdiff \tau_1 \subtypes \tau_2
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_union_right_introduction}
  Model Subtyping Union Right Introduction 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      \delta \satisfies \tau_l \subtypes \tau_l \J{|} \tau_r
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_union_left_introduction}
  Model Subtyping Union Left Introduction 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      \delta \satisfies \tau_r \subtypes \tau_l \J{|} \tau_r
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_intersection_left_elimination}
  Model Subtyping Intersection Left Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      \delta \satisfies \tau_l \J{\&} \tau_r \subtypes \tau_r
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_intersection_right_elimination}
  Model Subtyping Intersection Right Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      \delta \satisfies \tau_l \J{\&} \tau_r \subtypes \tau_l
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_typing_union_reorder}
  Model Typing Union Reorder 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      \delta \satisfies e \hastype \tau_a \J{|} \tau_b
      \iff
      \delta \satisfies e \hastype \tau_b \J{|} \tau_a
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_difference_introduction}
  Model Subtyping Difference Introduction 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      (\nexists e \qua \delta \satisfies e \hastype \tau_0 \up \delta \satisfies e \hastype \tau_2)
      \\
      \delta \satisfies \tau_0 \subtypes \tau_1
    } {
      \delta \satisfies \tau_0 \subtypes \tau_1 \typdiff \tau_2
    } {
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_indexed_union_introduction}
  Model Subtyping Indexed Union Introduction 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau_l \subtypes \tau_r
      \\
      \delta \satisfies \Delta 
    } {
      \delta \satisfies \tau_l \subtypes \J{EXI[}\Theta\J{]}\Delta\ \tau_r
    } {
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:model_subtyping_indexed_intersection_elimination}
  Model Subtyping Indexed Intersection Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau_l \subtypes \tau_r
      \\
      \delta \satisfies \Delta 
    } {
      \delta \satisfies \J{ALL[}\Theta\J{]}\Delta\ \tau_l \subtypes \tau_r
    } {
    }
  \end{mathpar}
\end{theorem}
\hfill



\section{Proof Theory}
\label{sec:proof_theory}

\begin{theorem}
  \label{thm:type_substitution_correspondence}
  Type Substitution Correspondence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
    } {
      \delta \satisfies e \hastype \tau[\alpha \slash \tau'] 
      \iff  
      \delta\ \alpha \slash \tau' \satisfies e \hastype \tau
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:proof_typing_containment}
  Proof Typing Containment 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta, \Gamma \entails e \hastype \tau \given \Theta', \Delta'
    } {
      \textbf{ftv}(\Gamma) \subseteq \textbf{ftv}(\Delta)
      \up
      \Delta \subseteq \Delta'
      \up
      \textbf{ftv}(\tau) \subseteq \textbf{ftv}(\Delta')
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:proof_subtyping_containment}
  \emph{proof subtyping containment}
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \tau \subtypes \tau' \given \Theta', \Delta'
    } {
      \Delta \subseteq \Delta'
      \up
      \textbf{ftv}(\tau) \subseteq \textbf{ftv}(\Delta')
      \up
      \textbf{ftv}(\tau') \subseteq \textbf{ftv}(\Delta')
    }
  \end{mathpar}
\end{theorem}
\hfill


\begin{theorem}
  \label{thm:proof_subtyping_environment_containment}
  Proof Subtyping Environment Containment 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \Delta_q \given \Theta', \Delta'
    } {
      \Delta \subseteq \Delta'
      \up
      \textbf{ftv}(\Delta_q) \subseteq \textbf{ftv}(\Delta')
    }
  \end{mathpar}
\end{theorem}
\hfill


\begin{theorem}
  \label{thm:proof_typing_skolem_freshness}
  Proof Typing Skolem Freshness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta, \Gamma \entails e \hastype \tau \given \Theta', \Delta'
    } {
      \Theta' \backslash \Theta \cap \textbf{ftv}(\Delta) = \emptyset
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:proof_subtyping_skolem_freshness}
  Proof Subtyping Skolem Freshness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \tau \subtypes \tau' \given \Theta', \Delta'
    } {
      \Theta' \backslash \Theta \cap \textbf{ftv}(\Delta) = \emptyset
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:proof_subtyping_sequence_skolem_freshness}
  Proof Subtyping Sequence Skolem Freshness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \Delta_q \given \Theta', \Delta'
    } {
      \Theta' \backslash \Theta \cap \textbf{ftv}(\Delta) = \emptyset
    }
  \end{mathpar}
\end{theorem}
\hfill


\begin{theorem}
  \label{thm:loop_subtyping_consolidation_soundness}
  Function Type Explosion Soundness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \tau \subtypes \alpha \rightarrow \Pi 
    } {
      \forall  \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
      (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi \implies
      \\\\
      (
      \exists \delta \qua \textbf{dom}(\delta) \cong \Theta^\dagger \up 
      (
      \forall \delta' \qua 
      \delta' \oplus \delta \satisfies \Delta \cup \Delta^\dagger \implies
      \delta' \oplus \delta \satisfies \tau \subtypes \alpha \J{->} \tau^\dagger
      )
      )
    }
  \end{mathpar}
\end{theorem}
\hfill


\begin{theorem}
  \label{thm:loop_subtyping_consolidation_skolem_freshness}
  Function Type Explosion Skolem Freshness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \tau \subtypes \alpha \rightarrow \Pi 
    } {
      \forall  \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
      (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi \implies
      \Theta^\dagger \cap \Theta = \emptyset 
      \up
      \Theta^\dagger \cap \textbf{ftv}(\Delta) = \emptyset
    }
  \end{mathpar}
\end{theorem}
\hfill


\begin{theorem}
  \label{thm:function_typing_consolidation_soundness}
  Path Sequence Typing Soundness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta, \Gamma \entails f \liftfun \Pi \sim \Xi 
    } {
      \forall  \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
      (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi \implies
      \\\\
      (
      \exists \delta \qua \textbf{dom}(\delta) \cong \Theta^\dagger \up 
      (
      \forall \delta', \sigma \qua 
      \delta' \oplus \delta \satisfies \Delta \cup \Delta^\dagger \implies
      \delta', \sigma \satisfies \Gamma \implies
      \delta' \oplus \delta \satisfies f[\sigma] \hastype \tau^\dagger
      )
      )
    }

    \TODO{proof of this depends on consistency of subtyping environment when checking skolem variables}

    \TODO{to prevent a path expression from having an empty type}
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:function_lifting_skolem_freshness}
  Function Lifting Skolem Freshness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta, \Gamma \entails f \liftfun \Pi \sim \Xi 
    } {
      (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi 
      \implies
      % \Theta^\dagger \backslash \Theta \backslash \textbf{ftv}(\Delta) \backslash \textbf{ftv}(\Gamma) = \Theta^\dagger
      \Theta^\dagger \cap \Theta = \emptyset 
      \up
      \Theta^\dagger \cap \textbf{ftv}(\Delta) = \emptyset
      \up
      \Theta^\dagger \cap  \textbf{ftv}(\Gamma) = \emptyset
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem} 
  \label{thm:schema_sequence_duality_correspondence}
  Schema Sequence Duality Correspondence
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \alpha_\nu \downarrow \Pi_\nu \fallingdotseq \alpha_\mu \uparrow \Pi_\mu
      \\
      \delta \satisfies \Delta
    } {
      (
      \forall \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua
      (\Theta^\dagger,\Delta^\dagger, \tau^\dagger) \in \Pi_\nu \implies
      \exists \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \up
      \\\\
      (
      \forall \delta' \qua
      \textbf{dom}(\delta') \cap \textbf{ftv}(\Delta) = \epsilon \implies
      \\\\
      \delta\ \alpha_\nu \slash \J{BOT} \oplus \delta' \oplus \delta^\dagger \satisfies \Delta^\dagger \implies
      \delta\ \alpha_\nu \slash \J{BOT} \oplus \delta' \oplus \delta^\dagger \satisfies e_f \hastype \tau^\dagger
      )
      )
      \\\\
      \iff
      \\\\
      (\forall e_a, e_r \qua
      (
      \exists \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua
      (\Theta^\dagger,\Delta^\dagger, \tau^\dagger) \in \Pi_\mu \up
      (\forall \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \implies
      \\\\
      \exists \delta' \qua
      \textbf{dom}(\delta') \cap \textbf{ftv}(\Delta) = \epsilon \up
      \\\\
      \delta\ \alpha_\mu \slash \J{TOP} \oplus \delta' \oplus \delta^\dagger \satisfies \Delta^\dagger \up
      \delta\ \alpha_\mu \slash \J{TOP} \oplus \delta' \oplus \delta^\dagger \satisfies (e_a \J{,} e_r) \hastype \tau^\dagger 
      )
      )
      \implies
      e_r \cong e_f\J{(}e_a\J{)}
      )
    }
  \end{mathpar} 
\end{theorem} 
\hfill

\begin{theorem}
  \label{thm:packing_correspondence}
  Packing Correspondence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \textbf{pack}^+(\dTheta \entails \Pi) = \tau 
      \\
      \delta \satisfies \Delta
      \\
      \dTheta \subseteq \textbf{dom}(\delta)
    } {
      (\forall  \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
      (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi \implies
      \\\\
      (
      \exists \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \backslash \dTheta \up 
      \\\\
      (
      \forall \delta' \qua 
      \textbf{dom}(\delta') \cap \textbf{ftv}(\Delta) = \emptyset \implies
      \delta \oplus \delta' \oplus \delta^\dagger \satisfies \Delta^\dagger \implies
      \delta \oplus \delta' \oplus \delta^\dagger \satisfies e \hastype \tau^\dagger
      )
      ) 
      \\\\
      \iff
      \\\\
      \delta \satisfies e \hastype \tau
    }

    \inferrule {
      \textbf{pack}^-(\dTheta \entails \Pi) = \tau 
      \\
      \delta \satisfies \Delta
      \\
      \dTheta \subseteq \textbf{dom}(\delta)
    } {
      (\exists  \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
      (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi \up
      \\\\
      (
      \forall \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \backslash \dTheta \implies
      \\\\
      (
      \exists \delta' \qua 
      \textbf{dom}(\delta') \cap \textbf{ftv}(\Delta) = \emptyset \up
      \delta \oplus \delta' \oplus \delta^\dagger \satisfies \Delta^\dagger \up
      \delta \oplus \delta' \oplus \delta^\dagger \satisfies e \hastype \tau^\dagger
      )
      ) 
      \\\\
      \iff
      \\\\
      \delta \satisfies e \hastype \tau
    }
  \end{mathpar}
\end{theorem}
\hfill

\begin{theorem}
  \label{thm:subtyping_factorization_correspondence}
  Subtyping Factorization Correspondence 
  \\
  \small
  \begin{mathpar}
    % \inferrule {
    %   \factorsinto \tau \subtypes \J{<}l\J{>} \tau'
    % } {
    %   \delta \satisfies \tau \subtypes \J{<}l\J{>} \tau'
    % }
    % 
    \inferrule {
      \factorsinto \tau \subtypes \J{<}l\J{>} \tau'
    } {
      \forall e' \qua \delta \satisfies e'  \hastype \tau'
      \iff
      (\exists e \qua e \J{.} l \cong e' \up \delta \satisfies e \hastype \tau)
    }
  \end{mathpar}
\end{theorem}
\hfill


\begin{theorem}
  \label{thm:proof_subtyping_sequence_soundness}
  Proof Subtyping Sequence Soundness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \Delta_q \given \Theta', \Delta'
    } {
      \exists \delta \qua \textbf{dom}(\delta) \subseteq \Theta' \backslash \Theta \up 
      (
      \forall \delta' \qua 
      \delta' \oplus \delta \satisfies \Delta' \implies
      \delta' \oplus \delta \satisfies \Delta_q 
      )
    }
  \end{mathpar}
\end{theorem}

\begin{theorem}
  \label{thm:proof_decidable_subtyping_sequence_uniqueness}
  Proof Decidable Subtyping Sequence Uniqueness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \Omega \given \Theta', \Delta'
    } {
      \forall \Theta'', \Delta'' \qua
      \Theta, \Delta \entails \Omega \given \Theta'', \Delta''
      \implies
      (\Theta'', \Delta'') = (\Theta', \Delta')
    }
  \end{mathpar}
\end{theorem}

\begin{theorem}
  Proof Decidable Subtyping Sequence Completeness  
  \label{thm:proof_decidable_subtyping_sequence_completeness}
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \Omega \given \Theta', \Delta'
      \\
      \delta' \satisfies \Delta'
    } {
      \forall \delta^\dagger \qua
      \delta' \oplus \delta^\dagger \satisfies \Omega \implies
      \delta' \oplus \delta^\dagger \satisfies \Delta'
    }
    % \TODO{note that this is a sufficient form of completeness, derived from uniqueness}
    % \TODO{meaning any solution $\Delta'$ is complete wrt to $\Omega$}
  \end{mathpar}
\end{theorem}


\begin{theorem}
  Proof Decidable Subtyping Solution Completeness  
  \label{thm:proof_decidable_subtyping_solution_completeness}
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \tau \subtypes \eta \given \Theta', \Delta'
      \\
      \textbf{ftv}(\eta) \subseteq \emptyset
      \\
      \delta' \satisfies \Delta'
    } {
      \forall \delta^\dagger \qua
      \delta' \oplus \delta^\dagger \satisfies \tau \subtypes \eta \implies
      \delta' \oplus \delta^\dagger \satisfies \Delta'
    }
  \end{mathpar}
\end{theorem}

\begin{theorem}
  Proof Decidable Subtyping Existential Completeness
  \label{thm:proof_decidable_subtyping_strong_existential_completeness}
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \tau \subtypes \eta
      \\
      \delta \satisfies \Delta
    } {
      \exists \Theta', \Delta' \qua \Theta, \Delta \entails \tau \subtypes \eta \given \Theta', \Delta'
    }
  \end{mathpar}
\end{theorem}



\begin{theorem}
  \label{thm:proof_subtyping_interpretation_independence}
  Proof Subtyping Interpretation Independence 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \tau_l \subtypes \tau_r \given \Theta', \Delta'
      \\
      \delta' \satisfies \Delta'
    } {
      \forall \delta^\dagger \qua
      \textbf{dom}(\delta^\dagger) \subseteq \textbf{ftv}(\Delta)
      \implies
      \delta' \oplus \delta^\dagger \satisfies \Delta
      \implies
      \delta' \oplus \delta^\dagger \satisfies \Delta'
    }
  \end{mathpar}
\end{theorem}



\begin{theorem}
  \label{thm:proof_typig_annotation_soundness}
  Proof Typing Annotation Soudness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta, \Gamma \entails \J{def } x \J{:} \tau_a \J{ = } e \J{ in } e' \hastype \tau' \given \Theta', \Delta'
    } {
      \forall \delta, \sigma \qua 
      \delta, \sigma \satisfies \Gamma \implies
      \delta \satisfies e \hastype \tau_a
    }
  \end{mathpar}
\end{theorem}

\begin{theorem}
  \label{thm:proof_typing_substance}
  Proof Typing Substance 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails e \hastype \tau \given \Theta', \Delta'
    } {
      \forall \delta \qua \textbf{dom}(\delta) \subseteq \Theta \implies
      \exists \delta' \qua \delta \oplus \delta' \satisfies \Delta
      \implies
      \exists \delta' \qua \delta \oplus \delta' \satisfies \Delta'
    }
  \end{mathpar}
\end{theorem}



\begin{theorem}
  \label{thm:proof_subtyping_substance}
  Proof Subtyping Substance 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \tau_l \subtypes \tau_r \given \Theta', \Delta'
    } {
      \forall \delta \qua \textbf{dom}(\delta) \subseteq \Theta \implies
      \exists \delta' \qua \delta \oplus \delta' \satisfies \Delta
      \implies
      \exists \delta' \qua \delta \oplus \delta' \satisfies \Delta'
    }
  \end{mathpar}

  \TODO{note how this is necessary for safety of function type inference}

  \TODO{so that bottom can't be inferred for a function expression}
\end{theorem}

\begin{theorem}
  \label{thm:polar_substitution_consistency}
  Polar Substitution Consistency 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \delta \satisfies \Delta[\alpha \slash \tau]^+ 
    } {
      \exists \delta' \qua
      \delta' \satisfies \Delta\ \alpha \J{<:} \tau
    }

    \inferrule {
      \delta \satisfies \Delta[\alpha \slash \tau]^-
    } {
      \exists \delta' \qua
      \delta' \satisfies \Delta\ \tau \J{<:} \alpha
    }
  \end{mathpar}

  \TODO{note how this is necessary to prove subtyping consistency}

  \TODO{note how consitency is necessary to prove parts of subtyping soundness}

\end{theorem}

\begin{theorem}
  \label{thm:type_substitution_positive_elimination}
  Type Substitution (Positive) Elimination 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \tau_l[\alpha \slash \tau_r]^+ = \tau^\dagger
      \\
      \delta \satisfies  \tau^\dagger \subtypes \tau_r
      \\
      \alpha \notin \textbf{ftv}(\tau^\dagger)
      \\
      \alpha \notin \textbf{ftv}(\tau_r)
    } {
      \forall \tau \qua
      \delta \satisfies \tau \subtypes \tau_r
      \implies
      \delta\ \alpha \slash \tau \satisfies \tau_l \subtypes \tau_r
    }
  \end{mathpar}
\end{theorem}


\begin{theorem}
  \label{thm:proof_subtyping_skolem_variable_elimination_soundness}
  Proof Subtyping Skolem Variable Elimination Soundness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \alpha \J{<:} \tau \safe
    } {
      \forall \delta \qua \delta \satisfies \Delta \implies \delta \satisfies \alpha \subtypes \tau 
    }
  \end{mathpar}
\end{theorem}

\begin{theorem}
  \label{thm:proof_subtyping_soundness}
  Proof Subtyping Soundness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta \entails \tau_l \subtypes \tau_r \given \Theta', \Delta'
    } {
      \exists \delta' \qua \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta \up 
      (
      \forall \delta \qua 
      \delta \oplus \delta' \satisfies \Delta' \implies
      \delta \oplus \delta' \satisfies \tau_l \subtypes \tau_r
      )
    }
  \end{mathpar}
  \\\\
  \noindent
  Induct over Definition \ref{def:proof_subtyping}.

  %%%%%%%%%%%%%%%%

  \item \N Assume $(\Theta, \Delta \entails \tau \subtypes \tau \given \Theta, \Delta)$
  \item \I \N Derive $(\textbf{dom}(\epsilon) \subseteq \Theta \backslash \Theta)$
  \item \I \N For $\delta$, assume $(\delta \oplus \epsilon \satisfies \Delta)$
  \item \I\I \N Derive $(\forall e \qua \delta \oplus \epsilon \satisfies e \hastype \tau \implies \delta \oplus \epsilon \satisfies e \hastype \tau)$
  \item \I\I \N Derive $(\delta \oplus \epsilon \satisfies \tau \subtypes \tau)$ 
    [Def. \ref{def:model_subtyping}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
      \Theta, \Delta \entails 
      \J{<}l \J{>} \tau_l \subtypes \J{<} l \J{>} \tau_r
      \given \Theta', \Delta'
  )$
  \item \I \N Derive $(
      \Theta, \Delta \entails 
      \tau_l \subtypes \tau_r
      \given \Theta', \Delta' 
  )$ [Def. \ref{def:proof_subtyping_implication_preservation}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies \tau_l \subtypes \tau_r 
  )$ [IH]
  \item \I \N For $\delta$, 
      assume $(\delta \oplus \delta' \satisfies \Delta')$
  \item \I\I \N Derive $(\delta \oplus \delta' \satisfies \tau_l \subtypes \tau_r)$ [P]
  \item \I\I \N Derive $(\delta \oplus \delta' \satisfies \J{<}l\J{>}\tau_l \subtypes \J{<}l\J{>}\tau_r)$ [Thm. \ref{thm:entry_type_preservation}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \tau_{p} \J{->} \tau_{q} 
    \subtypes 
    \tau_{x} \J{->} \tau_{y}
    \given \Theta'', \Delta'' 
  )$

  \item \I \N Derive $(
    \Theta, \Delta \entails \tau_{x} \subtypes \tau_{p} \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_implication_preservation}]

  \item \I \N And $(
    \Theta', \Delta' \entails \tau_{q} \subtypes \tau_{y} \given \Theta'', \Delta'' 
  )$ [Def. \ref{def:proof_subtyping_implication_preservation}]

  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta_0) \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P0: $(
    \forall \delta \qua 
    \delta \oplus \delta_0 \satisfies \Delta' 
    \implies 
    \delta \oplus \delta_0 \satisfies \tau_x \subtypes \tau_p
  )$ [IH]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash \Theta'
  )$ [IH]
  \item \I \N And P1: $(
    \forall \delta \qua 
    \delta \oplus \delta_1 \satisfies \Delta' 
    \implies 
    \delta \oplus \delta_1 \satisfies \tau_q \subtypes \tau_y
  )$ [IH]

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta
  )$
  \item \I \N For $\delta$, assume $(\delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'')$

  \item \I\I \N Derive $(\delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta')$
    [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:model_subtyping_sequence_introduction}]
  \item \I\I \N Derive $(\delta \oplus \delta_0 \satisfies \Delta')$
    [Thm. \ref{thm:proof_subtyping_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \tau_x \subtypes \tau_p
  )$ [P0]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_x \subtypes \tau_p
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:subtyping_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_q \subtypes \tau_y
  )$ [P1]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_p \J{->} \tau_q \subtypes \tau_x \J{->} \tau_y
  )$ [Thm \ref{thm:path_type_preservation}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
      \Theta, \Delta \entails 
      \tau_l \subtypes 
      (\tau_a\J{|}\tau_b)\J{->}\tau_r
      \given \Theta', \Delta' 
  )$ 
  \item \I \N Derive $(
    \Theta, \Delta \entails 
    \tau_l \subtypes
    (\tau_a\J{->}\tau_r)\J{\&}(\tau_b\J{->}\tau_r)
    \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_implication_rewriting}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies \tau_l \subtypes (\tau_a\J{->}\tau_r)\J{\&}(\tau_b\J{->}\tau_r) 
  )$ [IH]
  \item \I \N For $\delta$, assume $(\delta \oplus \delta' \satisfies \Delta')$
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau_l \subtypes (\tau_a\J{->}\tau_r)\J{\&}(\tau_b\J{->}\tau_r)
  )$ [P]
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau_l \subtypes (\tau_a\J{|}\tau_b)\J{->}\tau_r)
  )$ [Thm. \ref{thm:model_subtyping_union_type_path_antecedent}, Thm. \ref{thm:model_subtyping_transitivity}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \tau_l \subtypes 
    \tau_r\J{->}(\tau_{a}\J{\&}\tau_{b})
    \given \Theta', \Delta'
  )$ 
  \item \I \N Derive $(
    \Theta, \Delta \entails 
    \tau_l
    \subtypes
    (\tau_r\J{->}\tau_a)
    \J{\&}
    (\tau_r\J{->}\tau_b)
    \given \Theta', \Delta' 
  )$ [Def. \ref{def:proof_subtyping_implication_rewriting}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies \tau_l \subtypes 
    (\tau_r\J{->}\tau_a) \J{\&} (\tau_r\J{->}\tau_b)
  )$ [IH]
  \item \I \N For $\delta$, assume $(\delta \oplus \delta' \satisfies \Delta')$
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau_l \subtypes
    (\tau_r\J{->}\tau_a) \J{\&} (\tau_r\J{->}\tau_b)
  )$ [P]
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau_l \subtypes \tau_r\J{->}(\tau_a\J{\&}\tau_b))
  )$ [Thm. \ref{thm:model_subtyping_intersection_type_path_consequent}, Thm. \ref{thm:model_subtyping_transitivity}]


  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \tau \subtypes 
    \J{<} l \J{>} (\tau_{a}\J{\&}\tau_{b})
    \given \Theta', \Delta'
  )$ 
  \item \I \N Derive $(
    \Theta, \Delta \entails 
    \tau
    \subtypes
    (\J{<} l \J{>} \tau_a)
    \J{\&}
    (\J{<} l \J{>} \tau_b)
    \given \Theta', \Delta' 
  )$ [Def. \ref{def:proof_subtyping_implication_rewriting}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies 
    \tau
    \subtypes
    (\J{<} l \J{>} \tau_a)
    \J{\&}
    (\J{<} l \J{>} \tau_b)
  )$ [IH]
  \item \I \N For $\delta$, 
    assume $(\delta \oplus \delta' \satisfies \Delta')$
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies 
    \tau \subtypes
    (\J{<} l \J{>} \tau_a)
    \J{\&}
    (\J{<} l \J{>} \tau_b)
  )$ [P]
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau \subtypes \J{<} l \J{>}(\tau_a\J{\&}\tau_b))
  )$ [Thm. \ref{thm:model_subtyping_intersection_type_entry_consequent}, Thm. \ref{thm:model_subtyping_transitivity}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails
    \tau_a\J{|}\tau_b \subtypes \tau
    \given \Theta'', \Delta'' 
  )$

  \item \I \N Derive $(
    \Theta, \Delta \entails
    \tau_a \subtypes \tau
    \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_expansion_elimination}]

  \item \I \N And $(
    \Theta', \Delta' \entails
    \tau_b \subtypes \tau
    \given \Theta'', \Delta''
  )$ [Def. \ref{def:proof_subtyping_expansion_elimination}]

  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta_0) \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P0: $(
    \forall \delta \qua 
    \delta \oplus \delta_0 \satisfies \Delta' 
    \implies 
    \delta \oplus \delta_0 \satisfies \tau_a \subtypes \tau
  )$ [IH]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash \Theta'
  )$ [IH]
  \item \I \N And P1: $(
    \forall \delta \qua 
    \delta \oplus \delta_1 \satisfies \Delta' 
    \implies 
    \delta \oplus \delta_1 \satisfies \tau_b \subtypes \tau
  )$ [IH]

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta
  )$
  \item \I \N For $\delta$, 
    assume $(\delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'')$

  \item \I\I \N Derive $(\delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta')$
    [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:model_subtyping_sequence_introduction}]
  \item \I\I \N Derive $(\delta \oplus \delta_0 \satisfies \Delta')$
    [Thm. \ref{thm:proof_subtyping_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \tau_a \subtypes \tau
  )$ [P0]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_a \subtypes \tau
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:subtyping_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_b \subtypes \tau
  )$ [P1]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_a \J{|} \tau_b \subtypes \tau
  )$ [Thm \ref{thm:model_subtyping_union_type_elimination}]

  %%%%%%%%%%%%%%%%

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails
    \J{EXI[}\Theta_l\J{]}\Omega \J{:} \tau_l \subtypes \tau_r
    \given \Theta'', \Delta'' 
  )$

  \item \I \N Derive $(
    \Theta_l \cap \textbf{ftv}(\Delta) \subseteq \emptyset 
  )$ [Def. \ref{def:proof_subtyping_expansion_elimination}]
  \item \I \N And $(
    \Theta_l \cap \textbf{ftv}(\tau_r) \subseteq \emptyset
  )$ [Def. \ref{def:proof_subtyping_expansion_elimination}]
  \item \I \N And $(
    \forall \tau, \eta \qua (\tau \J{<:} \eta) \in \Omega \implies \textbf{ftv}(\eta) \subseteq \emptyset
  )$ [Def. \ref{def:proof_subtyping_expansion_elimination}]
  \item \I \N And $(
    \Theta, \Delta \entails \Omega \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_expansion_elimination}]
  \item \I \N And $(
    \Theta' \cup \Theta_l, \Delta' \entails
    \tau_l \subtypes \tau_r \given \Theta'', \Delta''
  )$ [Def. \ref{def:proof_subtyping_expansion_elimination}]


  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta) \subseteq \Theta' \backslash \Theta
  )$ [Thm. \ref{thm:proof_subtyping_sequence_soundness}]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash (\Theta' \cup \Theta_l)
  )$ [IH]


  \item \I \N And P1: $(
    \forall \delta \qua
    \delta \oplus \delta_1 \satisfies \Delta''
    \implies
    \delta \oplus \delta_1 \satisfies \tau_l \subtypes \tau_r
  )$ [IH]

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta \backslash \Theta_l
  )$

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta
  )$

  \item \I \N For $\delta$, assume $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta''
  )$ 

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'
  )$ [Thm. \ref{thm:model_subtyping_sequence_introduction}]

  \item \I\I \N Derive $(
    \forall \delta_l \qua
    \textbf{dom}(\delta_l) \subseteq \textbf{ftv}(\Delta')
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \Delta' 
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \Delta''
  )$ [Thm \ref{thm:proof_subtyping_interpretation_independence}]


  \item \I\I \N Derive $(
    \forall \delta_l \qua
    \textbf{dom}(\delta_l) \subseteq \textbf{ftv}(\Delta')
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \Omega 
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \Delta''
  )$ [Thm \ref{thm:proof_decidable_subtyping_sequence_completeness}]

  \item \I\I \N Derive $(
    \Theta_l \subseteq \textbf{ftv}(\Delta')
  )$ [Thm. \ref{thm:proof_subtyping_environment_containment}]

  \item \I\I \N Derive $(
    \forall \delta_l \qua
    \textbf{dom}(\delta_l) \subseteq \Theta_l 
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \Omega
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \Delta''
  )$ 

  \item \I\I \N Derive $(
    \forall \delta_l \qua
    \textbf{dom}(\delta_l) \subseteq \Theta_l 
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \Omega
    \implies
    \delta \oplus \delta_0 \oplus \delta_l \oplus \delta_1 \satisfies \Delta''
  )$ [Thm. Thm. \ref{thm:subtyping_interpretation_reordering}]

  \item \I\I \N Derive $(
    \forall \delta_l \qua
    \textbf{dom}(\delta_l) \subseteq \Theta_l
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \Omega
    \implies
    \delta \oplus \delta_0 \oplus \delta_l \oplus \delta_1 \satisfies \tau_l \subtypes \tau_r
  )$ [P1] 

  \item \I\I \N Derive $(
    \forall \delta_l \qua
    \textbf{dom}(\delta_l) \subseteq \Theta_l
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \Omega
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_l \satisfies \tau_l \subtypes \tau_r
  )$ [Thm. \ref{thm:subtyping_interpretation_reordering}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \J{EXI[} \Theta_l \J{]} \Omega \J{:} \tau_l \subtypes \tau_r
  )$ [Thm. \ref{thm:model_subtyping_indexed_union_type_elimination}]


  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails
    \tau \subtypes \tau_{a}\J{\&}\tau_{b} \given \Theta'', \Delta''
  )$

  \item \I \N Derive $(
    \Theta, \Delta \entails
    \tau \subtypes \tau_{a} \given \Theta', \Delta' 
  )$ [Def. \ref{def:proof_subtyping_refinement_introduction}]

  \item \I \N Derive $(
    \Theta', \Delta' \entails
    \tau \subtypes \tau_{b} \given \Theta'', \Delta''
  )$ [Def. \ref{def:proof_subtyping_refinement_introduction}]

  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta_0) \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P0: $(
    \forall \delta \qua 
    \delta \oplus \delta_0 \satisfies \Delta' 
    \implies 
    \delta \oplus \delta_0 \satisfies \tau \subtypes \tau_a
  )$ [IH]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash \Theta'
  )$ [IH]
  \item \I \N And P1: $(
    \forall \delta \qua 
    \delta \oplus \delta_1 \satisfies \Delta' 
    \implies 
    \delta \oplus \delta_1 \satisfies \tau \subtypes \tau_b
  )$ [IH]

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta
  )$
  \item \I \N For $\delta$, 
    assume $(\delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'')$

  \item \I\I \N Derive $(
    \delta' \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:model_subtyping_sequence_introduction}]
  \item \I\I \N Derive $(
    \delta' \oplus \delta_0 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \tau \subtypes \tau_a
  )$ [P0]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau \subtypes \tau_a
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:subtyping_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau \subtypes \tau_b
  )$ [P1]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau \subtypes \tau_a \J{\&} \tau_b
  )$ [Thm \ref{thm:model_subtyping_intersection_type_introduction}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails \tau_l \subtypes \J{ALL[}\Theta_r\J{]}\Omega \J{:} \tau_r \given \Theta'', \Delta''
  )$
  \item \I \N Derive $(
    \Theta_r \cap \textbf{ftv}(\Delta) \subseteq \emptyset
  )$ [Def. \ref{def:proof_subtyping_refinement_introduction}]
  \item \I \N And $(
    \Theta_r \cap \textbf{ftv}(\tau_l) \subseteq \emptyset
  )$ [Def. \ref{def:proof_subtyping_refinement_introduction}]
  \item \I \N And $(
    \forall \tau, \eta \qua (\tau \J{<:} \eta) \in \Omega \implies \textbf{ftv}(\eta) \subseteq \emptyset
  )$ [Def. \ref{def:proof_subtyping_refinement_introduction}]
  \item \I \N And $(
    \Theta, \Delta \entails \Omega \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_refinement_introduction}]
  \item \I \N And $(
    \Theta' \cup \Theta_r, \Delta' \entails
    \tau_l \subtypes \tau_r \given \Theta'', \Delta''
  )$ [Def. \ref{def:proof_subtyping_refinement_introduction}]

  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta) \subseteq \Theta' \backslash \Theta
  )$ [Thm. \ref{thm:proof_subtyping_sequence_soundness}]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash (\Theta' \cup \Theta_r)
  )$ [IH]

  \item \I \N And P1: $(
    \forall \delta \qua
    \delta \oplus \delta_1 \satisfies \Delta''
    \implies
    \delta \oplus \delta_1 \satisfies \tau_l \subtypes \tau_r
  )$ [IH]

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta \backslash \Theta_r
  )$

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta
  )$

  \item \I \N For $\delta$, assume $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta''
  )$ 

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'
  )$ [Thm. \ref{thm:model_subtyping_sequence_introduction}]

  \item \I\I \N Derive $(
    \forall \delta_r \qua
    \textbf{dom}(\delta_r) \subseteq \textbf{ftv}(\Delta')
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \Delta' 
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \Delta''
  )$ [Thm \ref{thm:proof_subtyping_interpretation_independence}]


  \item \I\I \N Derive $(
    \forall \delta_r \qua
    \textbf{dom}(\delta_r) \subseteq \textbf{ftv}(\Delta')
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \Omega 
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \Delta''
  )$ [Thm \ref{thm:proof_decidable_subtyping_sequence_completeness}]

  \item \I\I \N Derive $(
    \Theta_r \subseteq \textbf{ftv}(\Delta')
  )$ [Thm. \ref{thm:proof_subtyping_environment_containment}]

  \item \I\I \N Derive $(
    \forall \delta_r \qua
    \textbf{dom}(\delta_r) \subseteq \Theta_r 
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \Omega
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \Delta''
  )$ 

  \item \I\I \N Derive $(
    \forall \delta_r \qua
    \textbf{dom}(\delta_r) \subseteq \Theta_r
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \Omega
    \implies
    \delta \oplus \delta_0 \oplus \delta_r \oplus \delta_1 \satisfies \Delta''
  )$ [Thm. Thm. \ref{thm:subtyping_interpretation_reordering}]

  \item \I\I \N Derive $(
    \forall \delta_r \qua
    \textbf{dom}(\delta_r) \subseteq \Theta_r
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \Omega
    \implies
    \delta \oplus \delta_0 \oplus \delta_r \oplus \delta_1 \satisfies \tau_l \subtypes \tau_r
  )$ [P1] 

  \item \I\I \N Derive $(
    \forall \delta_r \qua
    \textbf{dom}(\delta_r) \subseteq \Theta_r
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \Omega
    \implies
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_r \satisfies \tau_l \subtypes \tau_r
  )$ [Thm. \ref{thm:subtyping_interpretation_reordering}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_l \subtypes \J{ALL[} \Theta_r \J{]} \Omega \J{:} \tau_r
  )$ [Thm. \ref{thm:model_subtyping_indexed_intersection_type_introduction}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails \alpha \subtypes \tau \given \Theta', \Delta'\ \alpha\J{<:}\tau
  )$ and $(
    \alpha \notin \Theta
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails \Delta[\alpha\slash\tau]^{+} \backslash \Delta \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_variable_elimination}]

  \item \I \N Let $\delta$ be, such that $(
    \textbf{dom}(\delta) \subseteq \Theta' \backslash \Theta
  )$ [Def. \ref{def:type_variable_assigment_sequence}]

  \item \I \N For $\delta'$, assume $(
    \delta \oplus \delta \satisfies \Delta'\ \alpha \J{<:} \tau
  )$ 
  \item \I\I \N Derive $(
    \delta \oplus \delta \satisfies \alpha \J{<:} \tau
  )$ [Thm. \ref{...}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \alpha \subtypes \tau
    \given \Theta, \Delta\ \alpha \J{<:} \tau
  )$ and $(
    \alpha \in \Theta 
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails \alpha \subtypes \tau \safe
  )$ [Def. \ref{def:proof_subtyping_variable_elimination}]
  \item \I \N And $(
    \nexists \alpha'  \qua \tau = \alpha'
  )$ [Def. \ref{def:proof_subtyping_variable_elimination}]

  \item \I \N For $\delta'$, assume $(
    \delta \oplus \epsilon \satisfies \Delta\ \alpha \J{<:} \tau 
  )$ 
  \item \I\I \N Derive $(
    \delta \oplus \epsilon \satisfies \alpha \J{<:} \tau
  )$ [Def. \ref{def:model_subtyping_sequence}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \tau \subtypes \alpha \given \Theta', \Delta'\ \tau\J{<:}\alpha
  )$ and $(
    \alpha \notin \Theta
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails 
    \Delta[\alpha\slash\tau]^{-} \backslash \Delta \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_variable_introduction}]

  \item \I \N Let $\delta$ be, such that $(
    \textbf{dom}(\delta) \subseteq \Theta' \backslash \Theta
  )$ [Def. \ref{def:type_variable_assigment_sequence}]

  \item \I \N For $\delta'$, assume $(
    \delta \oplus \delta \satisfies \Delta'\ \tau \J{<:} \alpha
  )$ 
  \item \I\I \N Derive $(
    \delta \oplus \delta \satisfies \tau \J{<:} \alpha
  )$ [Thm. \ref{...}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \tau \subtypes \alpha \given \Theta, \Delta
  )$ and $(
    \alpha \in \Theta
  )$

  \item \I \N Derive $(
    \Theta, \Delta \entails \tau \subtypes \alpha \safe
  )$ [Def. \ref{def:proof_subtyping_variable_introduction}]

  \item \I \N And $(
    \nexists \alpha' \qua \tau = \alpha'
  )$ [Def. \ref{def:proof_subtyping_variable_introduction}]

  \item \I \N For $\delta'$, assume $(
    \delta \oplus \epsilon \satisfies \Delta\ \tau \J{<:} \alpha
  )$ 
  \item \I\I \N Derive $(
    \delta \oplus \epsilon \satisfies \tau \J{<:} \alpha
  )$ [Def. \ref{def:model_subtyping_sequence}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \J{LFP[}\alpha\J{]}\tau_l \subtypes \tau_r 
    \given \Theta', \Delta' 
  )$
  \item \I \N Derive $(
    \tau_l[\alpha\slash\tau_r]^+ = \tau^\dagger 
  )$ [Def. \ref{def:proof_subtyping_lfp_elimination}]
  \item \I \N And $(
    \Theta, \Delta \entails 
    \tau_l[\alpha\slash\tau_r]^+ \subtypes \tau_r \given 
    \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_lfp_elimination}]
  \item \I \N And $(
    \alpha \not\in \textbf{ftv}(\tau^\dagger)
  )$ [Def. \ref{def:proof_subtyping_lfp_elimination}]
  \item \I \N And $(
    \alpha \not\in \textbf{ftv}(\tau_r)
  )$ [Def. \ref{def:proof_subtyping_lfp_elimination}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]

  \item \I \N And P: $(
    \forall \delta \qua
    \delta \oplus \delta \satisfies \Delta'
    \implies
    \delta \oplus \delta \satisfies \tau^\dagger \subtypes \tau_r
  )$ [IH]


  \item \I \N For $\delta$, Assume $(
    \delta \oplus \delta \satisfies \Delta'
  )$

  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau^\dagger \subtypes \tau_r
  )$ [P]

  \item \I\I \N Derive $(
    \forall \tau \qua \delta \oplus \delta' \satisfies \tau \subtypes \tau_r \implies \delta' \oplus \delta\ \alpha \slash \tau \satisfies \tau_l \subtypes \tau_r
  )$ [Thm. \ref{thm:type_substitution_positive_elimination}]

  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \J{LFP[}\alpha\J{]}\tau_l \subtypes \tau_r
  )$ [Thm. \ref{thm:model_subtyping_induction}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \tau \subtypes \rho \typdiff \eta
    \given \Theta', \Delta'
  )$
  \item \I \N \TODO{REDO} 
  % \item \I \N Derive $(
  %   \Theta, \Delta \entails 
  %   \tau \subtypes \rho \given \Theta', \Delta' 
  % )$ [Def. \ref{def:proof_subtyping_difference_intro}]
  % \item \I \N And $(
  %   \textbf{ftv}(\eta) \subseteq \emptyset
  % )$ [Def. \ref{def:proof_subtyping_difference_intro}]
  % \item \I \N And $(
  %   \nexists \Theta', \Delta' \qua  
  %   \Theta, \Delta \entails 
  %   \tau \subtypes \eta \given \Theta', \Delta'
  % )$ [Def. \ref{def:proof_subtyping_difference_intro}]

  % \item \I \N Let $\delta'$ be, such that $(
  %   \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  % )$ [IH]

  % \item \I \N And P: $(
  %   \forall \delta \qua
  %   \delta \oplus \delta' \satisfies \Delta'
  %   \implies
  %   \delta \oplus \delta' \satisfies \tau \subtypes \rho
  % )$ [IH]

  % \item \I \N For $\delta$, Assume $(
  %   \delta \oplus \delta' \satisfies \Delta'
  % )$

  % \item \I\I \N Derive $(
  %   \delta \oplus \delta' \satisfies \tau \subtypes \rho
  % )$ [P]

  % \item \I\I \N Derive $(
  %   \delta \oplus \delta' \satisfies \Delta
  % )$ [Thm. \ref{thm:proof_subtyping_containment}]

  % \item \I\I \N Derive $(
  %   \neg (\delta \oplus \delta' \satisfies \tau \subtypes \eta)
  % )$ [Thm \ref{thm:proof_decidable_subtyping_strong_existential_completeness}]

  % \item \I\I \N Derive $(
  %   \delta \oplus \delta' \satisfies \tau \subtypes \rho \typdiff \eta
  % )$ [Thm \ref{thm:model_subtyping_difference_introduction}]


  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails
    \tau_l \subtypes \J{LFP[} \alpha \J{]}\tau_r \given \Theta', \Delta'
  )$
  \item \I \N Derive $(
    \Theta, \Delta \star \tau_l \subtypes \J{LFP[} \alpha \J{]} \tau_r
  )$ [Def. \ref{def:proof_subtyping_lfp_intro}]
  \item \I \N And $(
    \Theta, \Delta \entails
    \tau_l \subtypes \tau_r[\alpha \slash \J{LFP[} \alpha \J{]} \tau_r]
    \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_lfp_intro}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies
    \tau_l \subtypes \tau_r[\alpha \slash \J{LFP[} \alpha \J{]} \tau_r]
  )$ [IH]

  \item \I \N For $\delta$, assume $(
    \delta \oplus \delta' \satisfies \Delta'
  )$

  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies
    \tau_l \subtypes \tau_r[\alpha \slash \J{LFP[} \alpha \J{]} \tau_r]
  )$ [P]

  \item \I\I \N Derive $(
    \forall e \qua
    \delta \oplus \delta' \satisfies
    e \hastype \tau_r[\alpha \slash \J{LFP[} \alpha \J{]} \tau_r] 
    \implies 
    \delta \oplus \delta'\ \alpha \slash \J{LFP[} \alpha \J{]} \tau_r \satisfies
    e \hastype
    \tau_r
  )$ [Thm. \ref{thm:type_substitution_correspondence}]

  \item \I\I \N Derive $(
    \forall e \qua
    \delta \oplus \delta' \satisfies
    e \hastype \tau_r[\alpha \slash \J{LFP[} \alpha \J{]} \tau_r] 
    \implies 
    \delta \oplus \delta' \satisfies
    e \hastype
    \J{LFP[} \alpha \J{]} \tau_r
  )$ [Thm. \ref{def:model_typing}]

  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies
    \tau_r[\alpha \slash \J{LFP[} \alpha \J{]} \tau_r] \subtypes \J{LFP[} \alpha \J{]} \tau_r
  )$ [Def. \ref{def:model_subtyping}]

  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies
    \tau_l \subtypes \J{LFP[} \alpha \J{]} \tau_r
  )$ [Thm. \ref{thm:model_subtyping_transitivity}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \rho \typdiff \eta \subtypes \tau \given \Theta', \Delta'
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails 
    \rho \subtypes \eta \J{|} \tau \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_diff_elimination}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies \rho \subtypes \eta \J{|} \tau
  )$ [IH]
  \item \I \N For $\delta$, 
    assume $(\delta \oplus \delta' \satisfies \Delta')$
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \rho \subtypes \eta \J{|} \tau
  )$ [P]
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \rho \typdiff \eta \subtypes \tau
  )$ [Thm. \ref{thm:model_subtyping_difference_elimination}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails \tau \subtypes \tau_{l}\J{|}\tau_{r} \given \Theta', \Delta' 
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails \tau \subtypes \tau_{l} \given \Theta', \Delta' 
  )$ [Def. \ref{def:proof_subtyping_expansion_introduction}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies \tau \subtypes \tau_{l}
  )$ [IH]
  \item \I \N For $\delta$, 
    assume $(\delta \oplus \delta' \satisfies \Delta')$
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau \subtypes \tau_{l}
  )$ [P]
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau \subtypes \tau_l \J{|} \tau_r
  )$ [Thm. \ref{thm:model_subtyping_union_right_introduction}, Thm. \ref{thm:model_subtyping_transitivity}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails \tau \subtypes \tau_{l}\J{|}\tau_{r} \given \Theta', \Delta' 
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails \tau \subtypes \tau_{r} \given \Theta', \Delta' 
  )$ [Def. \ref{def:proof_subtyping_expansion_introduction}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies \tau \subtypes \tau_{r}
  )$ [IH]
  \item \I \N For $\delta$, 
    assume $(\delta \oplus \delta' \satisfies \Delta')$
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau \subtypes \tau_{r}
  )$ [P]
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau \subtypes \tau_l \J{|} \tau_r
  )$ [Thm. \ref{thm:model_subtyping_union_left_introduction}, Thm. \ref{thm:model_subtyping_transitivity}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \tau_l
    \subtypes 
    \J{EXI[}\Theta_r\J{]}\Delta_r\ \tau_r \given \Theta'', \Delta'' 
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails \tau_l \subtypes \tau_r \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_expansion_introduction}]
  \item \I \N And $(
    \Theta', \Delta' \entails \Delta_r \given \Theta'', \Delta'' 
  )$ [Def. \ref{def:proof_subtyping_expansion_introduction}]

  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta_0) \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P0: $(
    \forall \delta' \qua 
    \delta \oplus \delta_0 \satisfies \Delta' 
    \implies 
    \delta \oplus \delta_0 \satisfies \tau_l \subtypes \tau_r
  )$ [IH]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash \Theta'
  )$ [Inductive Thm. \ref{thm:proof_subtyping_sequence_soundness}]
  \item \I \N And P1: $(
    \forall \delta' \qua 
    \delta \oplus \delta_1 \satisfies \Delta'' 
    \implies 
    \delta \oplus \delta_1 \satisfies \Delta_r 
  )$ [Inductive Thm. \ref{thm:proof_subtyping_sequence_soundness}]


  \item \I \N For $\delta$, assume $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta''
  )$


  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:model_subtyping_sequence_elimination}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_sequence_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \tau_l \subtypes \tau_r
  )$ [P0]


  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_l \subtypes \tau_r
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:subtyping_interpretation_independence}]


  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta_r
  )$ [P1]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_l \subtypes \J{EXI[}\Theta_r\J{]}\Delta_r\ \tau_r
  )$ [Thm \ref{thm:model_subtyping_indexed_union_introduction}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails \tau_{l}\J{\&}\tau_{r}  \subtypes \tau \given \Theta', \Delta' 
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails \tau_{l} \subtypes \tau \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_refinement_elimination}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies \tau_l \subtypes \tau
  )$ [IH]
  \item \I \N For $\delta$, 
    assume $(\delta \oplus \delta' \satisfies \Delta')$
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau_l \subtypes \tau
  )$ [P]
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau_l \J{\&} \tau_r \subtypes \tau 
  )$ [Thm. \ref{thm:model_subtyping_intersection_right_elimination}, Thm. \ref{thm:model_subtyping_transitivity}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails \tau_{l}\J{\&}\tau_{r}  \subtypes \tau \given \Theta', \Delta'
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails \tau_r \subtypes \tau \given \Theta', \Delta' 
  )$ [Def. \ref{def:proof_subtyping_refinement_elimination}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P: $(
    \forall \delta \qua 
    \delta \oplus \delta' \satisfies \Delta' 
    \implies 
    \delta \oplus \delta' \satisfies \tau_r \subtypes \tau
  )$ [IH]
  \item \I \N For $\delta$, 
    assume $(\delta \oplus \delta' \satisfies \Delta')$
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau_r \subtypes \tau
  )$ [P]
  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies \tau_l \J{\&} \tau_r \subtypes \tau 
  )$ [Thm. \ref{thm:model_subtyping_intersection_left_elimination}, Thm. \ref{thm:model_subtyping_transitivity}]

  %%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta \entails 
    \J{ALL[}\Theta_l\J{]} \Delta_l\ \tau_l
    \subtypes 
    \tau_r
    \given \Theta'', \Delta'' 
  )$
  \item \I \N Derive $(
    \Theta, \Delta \entails \tau_l \subtypes \tau_r \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_subtyping_refinement_elimination}]
  \item \I \N And $(
    \Theta', \Delta' \entails \Delta_l \given \Theta'', \Delta'' 
  )$ [Def. \ref{def:proof_subtyping_refinement_elimination}]

  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta_0) \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P0: $(
    \forall \delta \qua 
    \delta \oplus \delta_0 \satisfies \Delta' 
    \implies 
    \delta \oplus \delta_0 \satisfies \tau_l \subtypes \tau_r
  )$ [IH]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash \Theta'
  )$ [Inductive Thm. \ref{thm:proof_subtyping_sequence_soundness}]
  \item \I \N And P1: $(
    \forall \delta \qua 
    \delta \oplus \delta_1 \satisfies \Delta'' 
    \implies 
    \delta \oplus \delta_1 \satisfies \Delta_l 
  )$ [Inductive Thm. \ref{thm:proof_subtyping_sequence_soundness}]


  \item \I \N For $\delta$, assume $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta''
  )$


  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:model_subtyping_sequence_elimination}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_sequence_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \tau_l \subtypes \tau_r
  )$ [P0]


  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau_l \subtypes \tau_r
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:subtyping_interpretation_independence}]


  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta_l
  )$ [P1]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \J{ALL[}\Theta_l\J{]}\Delta_l\ \tau_l \subtypes \tau_r
  )$ [Thm. \ref{thm:model_subtyping_indexed_intersection_elimination}]

  %%%%%%%%%%%%%%%%

  \noindent
  $\square$
\end{theorem}
\hfill


\begin{theorem}
  \label{thm:proof_typing_soundness}
  Proof Typing Soundness 
  \\
  \small
  \begin{mathpar}
    \inferrule {
      \Theta, \Delta, \Gamma \entails e \hastype \tau \given \Theta', \Delta'
    } {
      \exists \delta' \qua \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta \up 
      (
      \forall \delta, \sigma \qua 
      \delta \oplus \delta' \satisfies \Delta' \implies
      \delta, \sigma \satisfies \Gamma \implies
      \delta \oplus \delta' \satisfies e[\sigma] \hastype \tau
      )
    }
  \end{mathpar}
  \\\\
  \noindent
  Induct over Definition \ref{def:proof_typing}

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \item \N Assume $(
      \Theta, \Delta, \Gamma \entails \J{@} \hastype \J{@} 
      \given \Theta, \Delta
  )$

  \item \I \N Derive $(
    \textbf{dom}(\epsilon) \subseteq \Theta \backslash \Theta
  )$

  \item \I \N For $\delta$, $\sigma$,
    assume $(\delta \oplus \epsilon \satisfies \Delta')$
    and $(\delta, \sigma \satisfies \Gamma)$

  \item \I\I \N Derive $(
    \delta \oplus \epsilon \satisfies \J{@} \hastype \J{@}
  )$ [Def. \ref{def:model_typing}]

  \item \I\I \N Derive $(
    \delta \oplus \epsilon \satisfies \J{@}[\sigma] \hastype \J{@}
  )$ [Def. \ref{def:expr_substitution}]

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta, \Gamma \entails x \hastype \tau \given \Theta, \Delta
  )$

  \item \I \N Derive $(
    x \hastype \tau \in \Gamma 
  )$ [Def. \ref{def:proof_typing}]

  \item \I \N Derive $(
    \textbf{dom}(\epsilon) \subseteq \Theta \backslash \Theta
  )$

  \item \I \N For $\delta$, $\sigma$,
    assume $(\delta \oplus \epsilon \satisfies \Delta')$
    and $(\delta, \sigma \satisfies \Gamma)$

  \item \I\I \N Derive $(
    \delta \oplus \epsilon \satisfies x[\sigma] \hastype \tau
  )$ [Def. \ref{def:model_typing_sequence}]

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta, \Gamma \entails \epsilon \hastype \J{TOP} \given \Theta, \Delta
  )$

  \item \I \N Derive $(
    \textbf{dom}(\epsilon) \subseteq \Theta \backslash \Theta
  )$

  \item \I \N For $\delta$, $\sigma$,
    assume $(\delta \oplus \epsilon \satisfies \Delta')$
    and $(\delta, \sigma \satisfies \Gamma)$

  \item \I\I \N Derive $(
    \delta \oplus \epsilon \satisfies \epsilon \hastype \J{TOP}
  )$ [Def. \ref{def:model_typing}]

  \item \I\I \N Derive $(
    \delta \oplus \epsilon \satisfies \epsilon[\sigma] \hastype \J{TOP}
  )$ [Def. \ref{def:expr_substitution}]

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \item \N Assume $(
    r\ \J{<}l \J{>} e \hastype (\tau\ \J{\&}\ \J{<} l \J{>} \tau') \given \Theta'', \Delta''
  )$

  \item \I \N Derive $(
    \Theta, \Delta, \Gamma \entails r \hastype \tau \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_typing}]

  \item \I \N Derive $(
    \Theta', \Delta', \Gamma \entails e \hastype \tau' \given \Theta'', \Delta''
  )$ [Def. \ref{def:proof_typing}]

  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta_0) \subseteq \Theta' \backslash \Theta
  )$ [IH]

  \item \I \N And P0: $(
    \forall \delta \qua 
    \delta \oplus \delta_0 \satisfies \Delta'
    \implies 
    \delta, \sigma \satisfies \Gamma
    \implies 
    \delta \oplus \delta_0 \satisfies r \hastype \tau 
  )$ [IH]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash \Theta'
  )$ [IH]

  \item \I \N And P1: $(
    \forall \delta \qua 
    \delta \oplus \delta_1 \satisfies \Delta'
    \implies 
    \delta, \sigma \satisfies \Gamma
    \implies 
    \delta \oplus \delta_1 \satisfies e \hastype \tau'
  )$ [IH]

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta
  )$ 

  \item \I \N For $\delta$, $\sigma$,
    assume $(\delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'')$
    and $(\delta, \sigma \satisfies \Gamma)$

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_typing_containment}, Thm. \ref{thm:model_subtyping_sequence_elimination}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_typing_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies r \hastype \tau
  )$ [P0]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies r[\sigma] \hastype \tau
  )$ [Thm. \ref{thm:proof_typing_skolem_freshness}, 
      Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \Gamma
  )$ [Thm. \ref{thm:proof_typing_skolem_freshness},
      Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_sequence_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies e[\sigma] \hastype \tau'
  )$ [P1]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies r[\sigma]\J{<}l\J{>}e[\sigma] \hastype \tau
  )$ [Thm. \ref{thm:record_extension_preservation}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies r[\sigma]\J{<}l\J{>}e[\sigma] \hastype \J{<}l\J{>}\tau'
  )$ [Thm. \ref{thm:entry_type_introduction}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies r[\sigma]\J{<}l\J{>}e[\sigma] \hastype \tau \J{\&} \J{<}l\J{>}\tau'
  )$ [Def. \ref{def:model_typing}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies (r\J{<}l\J{>}e)[\sigma] \hastype \tau \J{\&} \J{<}l\J{>}\tau'
  )$ [Def. \ref{def:expr_substitution}]

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta, \Gamma \entails f \hastype \tau \given \Theta, \Delta
  )$

  \item \I \N Derive $(
    \exists \Xi \qua \Theta, \Delta, \Gamma \entails f \liftfun \Pi \sim \Xi
  )$ [Def. \ref{def:proof_typing}]

  \item \I \N Derive $(
    \Theta \cup \textbf{ftv}(\Delta) \cup \textbf{ftv}(\Gamma) = \dTheta
  )$ [Def. \ref{def:proof_typing}]

  \item \I \N Derive $(
    \textbf{pack}^+(\dTheta \entails \Pi) = \tau
  )$ [Def. \ref{def:proof_typing}]

  \item \I \N Derive $(
    \textbf{dom}(\epsilon) \subseteq \Theta \backslash \Theta
  )$

  \item \I \N For $\delta$, $\sigma$,
    assume $(\delta \oplus \epsilon \satisfies \Delta)$
    and $(\delta, \sigma \satisfies \Gamma)$

  \item \I\I \N Derive $(
    \delta \satisfies \Delta'
  )$

  \item \I\I \N Derive $(
    \delta \satisfies f[\sigma] \hastype \tau
  )$ [Ind. Thm. \ref{thm:function_typing_consolidation_soundness}, Thm. \ref{thm:function_lifting_skolem_freshness},
      Thm. \ref{thm:packing_correspondence}]

  \item \I\I \N Derive $(
    \delta \oplus \epsilon \satisfies f[\sigma] \hastype \tau
  )$ 

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta, \Gamma \entails e \J{.} l \hastype \alpha \given \Theta'', \Delta''
  )$

  \item \I \N Derive $(
    \Theta, \Delta, \Gamma \entails e \hastype \tau \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_typing}]

  \item \I \N Derive $(
    \Theta', \Delta' \entails \tau \subtypes  \J{<} l \J{>} \alpha \given \Theta'', \Delta''
  )$ [Def. \ref{def:proof_typing}]


  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta_a) \subseteq \Theta' \backslash \Theta
  )$ [IH]

  \item \I \N And P0: $(
    \forall \delta, \sigma \qua 
    \delta \oplus \delta_0 \satisfies \Delta' \implies
    \delta, \sigma \satisfies \Gamma \implies
    \delta \oplus \delta_0 \satisfies e[\sigma] \hastype \tau
  )$ [IH]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_a) \subseteq \Theta'' \backslash \Theta'
  )$ [Ind. Thm. \ref{thm:proof_subtyping_soundness}]

  \item \I \N And P1: $(
    \forall \delta, \sigma \qua 
    \delta \oplus \delta_1 \satisfies \Delta'' \implies
    \delta \oplus \delta_1 \satisfies \tau \subtypes \J{<}l\J{>}\alpha
  )$ [Ind. Thm. \ref{thm:proof_subtyping_soundness}]

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta
  )$ [Thm. \ref{thm:domain_extension}]

  \item \I \N For $\delta$, $\sigma$,
    assume $(\delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'')$
    and $(\delta, \sigma \satisfies \Gamma)$

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:model_subtyping_sequence_elimination}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies e[\sigma] \hastype \tau
  )$ [P0]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies e[\sigma] \hastype \tau
  )$ [Thm. \ref{thm:proof_subtyping_skolem_freshness}, 
      Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \tau \subtypes \J{<} l \J{>} \alpha
  )$ [P1]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies e[\sigma] \hastype \J{<}l\J{>}\alpha
  )$ [Thm. \ref{thm:model_typing_subsumption}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies (e[\sigma])\J{.}l
  )$ [Thm. \ref{thm:model_typing_entry_elimination}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies (e\J{.}l)[\sigma]
  )$ [Def. \ref{def:expr_substitution}]

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \item \N Assume $(
    \Theta, \Delta, \Gamma \entails e_f \J{(} e_a \J{)} \hastype \alpha \given \Theta''', \Delta'''
  )$
  \item \I \N Derive $(
    \Theta, \Delta, \Gamma \entails e_f \hastype \tau_f \given \Theta', \Delta'
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \Theta', \Delta', \Gamma \entails e_a \hastype \tau_a \given \Theta'', \Delta''
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \Theta'', \Delta'', \tau_f \subtypes \tau_a\J{->}\alpha \given \Theta''', \Delta'''
  )$ [Def. \ref{def:proof_typing}]

  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta_0) \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P0: $(
    \forall \delta, \sigma \qua 
    \delta \oplus \delta_0 \satisfies \Delta' \implies
    \delta, \sigma \satisfies \Gamma \implies
    \delta \oplus \delta_0 \satisfies e_f[\sigma] \hastype \tau_f
  )$ [IH]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash \Theta'
  )$ [IH]
  \item \I \N And P1: $(
    \forall \delta, \sigma \qua 
    \delta \oplus \delta_1 \satisfies \Delta' \implies
    \delta, \sigma \satisfies \Gamma \implies
    \delta \oplus \delta_1 \satisfies e_a[\sigma] \hastype \tau_a
  )$ [IH]

  \item \I \N Let $\delta_2$ be, such that $(
    \textbf{dom}(\delta_2) \subseteq \Theta''' \backslash \Theta''
  )$ [Ind. Thm. \ref{thm:proof_subtyping_soundness}]
  \item \I \N And P2: $(
    \forall \delta, \sigma \qua 
    \delta \oplus \delta_2 \satisfies \Delta' \implies
    \delta \oplus \delta_2 \satisfies \tau_f \subtypes \tau_a \J{->} \alpha
  )$ [Ind. Thm. \ref{thm:proof_subtyping_soundness}]

  \item \I \N Derive $(
    \text{dom}(\delta_0 \oplus \delta_1 \oplus \delta_2) \subseteq \Theta''' \backslash \Theta
  )$ [Thm. \ref{thm:domain_extension}]


  \item \I \N For $\delta$, $\sigma$,
    assume $(\delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_2 \satisfies \Delta''')$
    and $(\delta, \sigma \satisfies \Gamma)$

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_2 \satisfies \Delta''
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:model_subtyping_sequence_elimination}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta''
  )$ [Thm. \ref{thm:proof_subtyping_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_typing_containment}, Thm. \ref{thm:model_subtyping_sequence_elimination}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_typing_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies e_f[\sigma] \hastype \tau_f
  )$ [P0]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies e_f[\sigma] \hastype \tau_f
  )$ [Thm. \ref{thm:proof_typing_skolem_freshness}, 
      Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_interpretation_independence}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_2 \satisfies e_f[\sigma] \hastype \tau_f
  )$ [Thm. \ref{thm:proof_subtyping_skolem_freshness}, 
      Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \Gamma
  )$ [Thm. \ref{thm:proof_typing_skolem_freshness},
      Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_sequence_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies e_a[\sigma] \hastype \tau_a
  )$ [P1]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_2 \satisfies e_a[\sigma] \hastype \tau_a
  )$ [Thm. \ref{thm:proof_subtyping_skolem_freshness}, 
      Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_2  \satisfies \tau_f \subtypes \tau_a \J{->} \alpha
  )$ [P2]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_2 \satisfies e_f[\sigma] \hastype \tau_a \J{->} \alpha
  )$ [Thm. \ref{thm:model_typing_subsumption}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_2 \satisfies e_f[\sigma]\J{(}e_a[\sigma]\J{)} \hastype \alpha
  )$ [Thm \ref{thm:model_typing_path_elimination}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \oplus \delta_2 \satisfies (e_f\J{(}e_a\J{)})[\sigma] \hastype \alpha
  )$ [Def. \ref{def:expr_substitution}]


  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \item \N Assume $(
    (\Theta, \Delta, \Gamma \entails \J{def } x \J{:} \tau_a \J{ = } e \J{ in } e' \hastype \tau' \given \Theta'', \Delta'')
  )$
  \item \I \N Derive $(
    \Theta, \Delta, \Gamma \entails e \hastype \tau \given \Theta', \Delta' 
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \textbf{ftv}(\tau_a) \subseteq \emptyset
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \exists \Theta^\dagger, \Delta^\dagger \qua \Theta', \Delta' \entails \tau \subtypes \tau_a \given \Theta^\dagger, \Delta^\dagger
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \Theta', \Delta', \Gamma, x:\tau_a \entails e' \hastype \tau' \given \Theta'', \Delta''
  )$ [Def. \ref{def:proof_typing}]


  \item \I \N Let $\delta_0$ be, such that $(
    \textbf{dom}(\delta_0) \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P0: $(
    \forall \delta, \sigma \qua 
    \delta \oplus \delta_0 \satisfies \Delta' \implies
    \delta, \sigma \satisfies \Gamma \implies
    \delta \oplus \delta_0 \satisfies e[\sigma] \hastype \tau
  )$ [IH]

  \item \I \N Let $\Theta^\dagger$, $\Delta^\dagger$ be, such that $(
    \Theta', \Delta' \entails \tau \subtypes \tau_a \given \Theta^\dagger, \Delta^\dagger
  )$

  \item \I \N Let $\delta^\dagger$ be, such that $(
    \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \backslash \Theta'
  )$ [Ind. Thm. \ref{thm:proof_subtyping_soundness}]
  \item \I \N And P$\dagger$: $(
    \forall \delta, \sigma \qua 
    \delta \oplus \delta^\dagger \satisfies \Delta^\dagger \implies
    \delta \oplus \delta^\dagger \satisfies \tau \subtypes \tau_a
  )$ [Ind. Thm. \ref{thm:proof_subtyping_soundness}]

  \item \I \N Let $\delta_1$ be, such that $(
    \textbf{dom}(\delta_1) \subseteq \Theta'' \backslash \Theta'
  )$ [IH]
  \item \I \N And P1: $(
    \forall \delta, \sigma \qua 
    \delta \oplus \delta_1 \satisfies \Delta'' \implies
    \delta, \sigma \satisfies \Gamma\ x \hastype \tau_a \implies
    \delta \oplus \delta_1 \satisfies e'[\sigma] \hastype \tau'
  )$ [IH]


  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta^\dagger) \subseteq \Theta^\dagger \backslash \Theta
  )$ [Thm. \ref{thm:domain_extension}]

  \item \I \N Derive $(
    \textbf{dom}(\delta_0 \oplus \delta_1) \subseteq \Theta'' \backslash \Theta
  )$ [Thm. \ref{thm:domain_extension}]


  \item \I \N For $\delta$, $\sigma$,
    assume $(\delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'')$
    and $(\delta, \sigma \satisfies \Gamma)$

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_containment}, Thm. \ref{thm:model_subtyping_sequence_elimination}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \Delta'
  )$ [Thm. \ref{thm:proof_subtyping_skolem_freshness}, Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies e[\sigma] \hastype \tau
  )$ [P0]
  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies e[\sigma] \hastype \tau
  )$ [Thm. \ref{thm:proof_subtyping_skolem_freshness}, 
      Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta^\dagger \satisfies \Delta^\dagger
  )$ [Ind. Thm. NonVac \TODO{...}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta^\dagger \satisfies \tau \subtypes \tau_a
  )$ [P$\dagger$]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \tau \subtypes \tau_a
  )$ [Because ftv is empty]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies e[\sigma] \hastype \tau_a
  )$ [Thm. \ref{thm:model_typing_subsumption}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \satisfies \Gamma
  )$ [Thm. \ref{thm:proof_typing_skolem_freshness},
      Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_sequence_interpretation_independence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0\ x \slash e[\sigma] \satisfies \Gamma\ x \slash \tau_a
  )$ [Def. \ref{def:model_typing_sequence}]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies e'[\sigma\ x\slash[\sigma]] \hastype \tau'
  )$ [P2]

  \item \I\I \N Derive $(
    \delta \oplus \delta_0 \oplus \delta_1 \satisfies e'[\sigma][x\slash[\sigma]] \hastype \tau'
  )$ [Def. \ref{def:expr_substitution}]

  \item \I\I \N Derive $(
    \delta \oplus \delta \entails \J{def } x \J{:} \tau_a \J{ = } e[\sigma] \J{ in } e'[\sigma] \hastype \tau'
  )$ [Thm. \ref{thm:annotated_binding_introduction}]

  \item \I\I \N Derive $(
    \delta \oplus \delta \entails (\J{def } x \J{:} \tau_a \J{ = } e \J{ in } e')[\sigma] \hastype \tau'
  )$ [Def. \ref{def:expr_substitution}]

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \item \N Assume $(
    \Theta, \Delta, \Gamma \entails \J{loop(}e\J{)} \hastype 
    \tau_l \J{->} \tau_r \given \Theta', \Delta'
  )$
  \item \I \N Derive $(
    \Theta, \Delta, \Gamma \entails e \hastype \tau \given  \Theta', \Delta'
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \Theta', \Delta' \entails \tau \subtypes \alpha_\nu \rightarrow \Pi_\nu
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \alpha_\nu \downarrow \Pi_\nu \fallingdotseq \alpha_\mu \uparrow \Pi_\mu
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \textbf{pack}^-(\textbf{ftv}(\Delta)\ \alpha_\mu \entails \Pi_\mu) = \tau_\mu
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \factorsinto \J{LFP[} \alpha_\mu \J{]}\tau_\mu \subtypes \J{<left>}\ \tau_l
  )$ [Def. \ref{def:proof_typing}]
  \item \I \N Derive $(
    \factorsinto \J{LFP[} \alpha_\mu \J{]}\tau_\mu \subtypes \J{<right>}\ \tau_r
  )$ [Def. \ref{def:proof_typing}]

  \item \I \N Let $\delta'$ be, such that $(
    \textbf{dom}(\delta') \subseteq \Theta' \backslash \Theta
  )$ [IH]
  \item \I \N And P0: $(
    \forall \delta, \sigma \qua 
    \delta \oplus \delta' \satisfies \Delta' \implies
    \delta, \sigma \satisfies \Gamma \implies
    \delta \oplus \delta' \satisfies e[\sigma] \hastype \tau
  )$ [P0]

  \item \I \N For $\delta$, $\sigma$,
    assume $(\delta \oplus \delta' \satisfies \Delta')$
    and $(\delta, \sigma \satisfies \Gamma)$

  \item \I\I \N Derive $(
    \delta \oplus \delta' \satisfies e[\sigma] \hastype \tau
  )$ [P0]

  \item \I\I \N Derive P1: $(
    \forall \delta'' \qua \textbf{dom}(\delta'') \cap \textbf{ftv}(\Delta') = \emptyset \implies \delta \oplus \delta' \oplus \delta'' \satisfies \Delta'
  )$ [Thm. \ref{thm:model_subtyping_sequence_interpretation_independence}]

  \item \I\I \N Derive P2: $(
    \forall \delta'' \qua \textbf{dom}(\delta'') \cap \textbf{ftv}(\Delta') = \emptyset \implies \delta \oplus \delta' \oplus \delta'' \satisfies e[\sigma] \hastype \tau
  )$ [Thm. \ref{thm:proof_typing_containment},
      Thm. \ref{thm:model_typing_interpretation_independence}]

  \item \I\I \N Derive P3: $(
    \forall \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
    (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi_\nu \implies
    \exists \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \up 
    (
    \forall \delta \qua
    \delta \oplus \delta^\dagger \satisfies \Delta' \implies
    \delta \oplus \delta^\dagger \satisfies \Delta^\dagger \implies
    \delta \oplus \delta^\dagger \satisfies \tau \subtypes \alpha \J{->} \tau^\dagger
    )
  )$ [Thm. \ref{thm:loop_subtyping_consolidation_soundness}, Thm. \ref{thm:model_subtyping_sequence_introduction}]

  \item \I\I \N Derive $(
    \forall \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
    (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi_\nu \implies
    \exists \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \up 
    (
    \forall \delta'' \qua
    \delta \oplus \delta' \oplus \delta'' \oplus \delta^\dagger \satisfies \Delta' \implies
    \delta \oplus \delta' \oplus \delta'' \oplus \delta^\dagger \satisfies \Delta^\dagger \implies
    \delta \oplus \delta' \oplus \delta'' \oplus \delta^\dagger \satisfies \tau \subtypes \alpha \J{->} \tau^\dagger
    )
  )$ [P3]

  \item \I\I \N Derive $(
    \forall \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
    (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi_\nu \implies
    \exists \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \up 
    (
    \forall \delta'' \qua
    \textbf{dom}(\delta'') \cap \textbf{ftv}(\Delta') = \emptyset \implies
    \delta' \oplus \delta \oplus \delta'' \oplus \delta^\dagger \satisfies \Delta^\dagger \implies
    \delta' \oplus \delta \oplus \delta'' \oplus \delta^\dagger \satisfies e[\sigma] \hastype \alpha \J{->} \tau^\dagger
    )
  )$ [P1, P2, Thm. \ref{thm:model_typing_subsumption}]

  \item \I\I \N Derive $(
    \forall \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
    (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi_\nu \implies
    \exists \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \up 
    (
    \forall \delta'' \qua
    \textbf{dom}(\delta'') \cap \textbf{ftv}(\Delta') = \emptyset \implies
    \delta \oplus \delta'\ \alpha \slash \J{BOT} \oplus \delta'' \oplus \delta^\dagger \satisfies \Delta^\dagger \implies
    \delta \oplus \delta'\ \alpha \slash \J{BOT} \oplus \delta'' \oplus \delta^\dagger \satisfies e[\sigma] \hastype \alpha \J{->} \tau^\dagger
    )
  )$ [Thm. \ref{...} \TODO{weakest interpretation of alpha}]

  \item \I\I \N Derive $(
    \forall \Theta^\dagger, \Delta^\dagger, \tau^\dagger \qua 
    (\Theta^\dagger, \Delta^\dagger, \tau^\dagger) \in \Pi_\nu \implies
    \exists \delta^\dagger \qua \textbf{dom}(\delta^\dagger) \subseteq \Theta^\dagger \up 
    (
    \forall \delta'' \qua
    \textbf{dom}(\delta'') \cap \textbf{ftv}(\Delta') = \emptyset \implies
    \delta \oplus \delta' \oplus \delta'' \oplus \delta^\dagger \satisfies \Delta^\dagger \implies
    \delta \oplus \delta' \oplus \delta'' \oplus \delta^\dagger \satisfies \J{loop(}e[\sigma]\J{)} \hastype \tau^\dagger
    )
  )$ [Thm. \ref{thm:model_typing_path_elimination_loop}]

  \item \I\I \N Derive $(
    \forall e_a, e_r \qua 
    \delta \oplus \delta'\ \alpha_\mu \slash \J{TOP} \satisfies (e_a\J{,}e_r) \hastype \tau_\mu
    \implies 
    e_r \cong \J{loop(}e[\sigma]\J{)(} e_a \J{)}
  )$ [Thm. \ref{thm:packing_correspondence}]

  \item \I\I \N Derive $(
    \forall e_a, e_r \qua 
    \delta \oplus \delta' \satisfies (e_a\J{,}e_r) \hastype \J{LFP[}\alpha_\mu\J{]}\tau_\mu
    \implies 
    e_r \cong \J{loop(}e[\sigma]\J{)(} e_a \J{)}
  )$ [Thm. \ref{thm:least_fixed_point_type_elimination}]

  \item \I\I \N Derive $(
    \forall e_a, e_r \qua 
    \delta \oplus \delta' \satisfies (e_a\J{,}e_r) \hastype \J{LFP[}\alpha_\mu\J{]}\tau_\mu
    \implies 
    \delta \oplus \delta' \satisfies e_r \hastype \tau_r 
    \up
    e_r \cong \J{loop(}e[\sigma]\J{)(} e_a \J{)}
  )$ [Thm. \ref{thm:subtyping_factorization_correspondence},
      Thm. \ref{thm:model_typing_subsumption},
      Thm. \ref{thm:model_typing_entry_elimination},
      Thm. \ref{thm:right_congruence}]

  \item \I\I \N Derive $(
    \forall e_a, e_r \qua 
    \delta \oplus \delta' \satisfies e_a \hastype \tau_l 
    \implies 
    \delta \oplus \delta' \satisfies e_r \hastype \tau_r 
    \up
    e_r \cong \J{loop(}e[\sigma]\J{)(} e_a \J{)}
  )$ [Thm. \ref{thm:left_congruence}, Thm. \ref{thm:subtyping_factorization_correspondence}]

  \item \I\I \N Derive $(
    \forall e_a \qua 
    \delta \oplus \delta' \satisfies e_a \hastype \tau_l 
    \implies 
    \delta \oplus \delta' \satisfies \J{loop(}e[\sigma]\J{)(} e_a \J{)} \hastype \tau_r 
  )$ [Thm. \ref{thm:expression_congruence_typing} \TODO{...}]

  \item \I\I \N Derive $(
    \delta \oplus \delta'  \satisfies \J{loop(}e[\sigma]\J{)} \hastype \tau_l \J{->}\tau_r 
  )$ [Thm. \ref{thm:model_typing_path_elimination_loop}]

  \item \I\I \N Derive $(
    \delta \oplus \delta'  \satisfies \J{loop(}e\J{)}[\sigma] \hastype \tau_l \J{->}\tau_r 
  )$ [Thm. \ref{def:expr_substitution}]

  \noindent
  $\square$

\end{theorem}


\TODO{update implementation to be consistent with paper}.



% \begin{definition}\boxed{\VDash e}
%   \label{def:expression_good_formation}
%   \begin{mathpar}
%     \inferrule {
%       e = v
%     } {
%       \VDash e
%     } 

%     \inferrule { 
%       e \rightsquigarrow e' 
%       \\
%       \VDash e'
%     } {
%       \VDash e
%     } 
%   \end{mathpar}
% \end{definition}

% \begin{theorem}(Typing Soundness)
%   \label{thm:typing_soundness}
%   \begin{mathpar}
%     \inferrule { 
%       \entails e \hastype \tau \given Z
%     } {
%       \VDash e
%     } 
%   \end{mathpar}
%   Proof:
%   \item $\B{assume } \entails e \hastype \tau \given Z$
%     \item \Z $\B{def } \delta\ \Gamma' \ \tau' \B{ s.t. } \delta, \Gamma' \satisfies e \hastype \tau'$ by \D{Lemma \ref{thm:proof_typing_soundness}}
%     \item \Z $\delta, \sigma \satisfies \Gamma'$ by ...
%     \item \Z $\VDash e[\sigma]$ by theorem \ref{thm:model_typing_soundness}
%     \item \Z $e[\sigma] = e$ by ...
%     \item \Z $\VDash e$ by substitution 
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Proof typing consistency)
%   \label{thm:proof_typing_consistency}
%   \begin{mathpar}
%     \inferrule { 
%       \Gamma \entails e \hastype \tau \given Z  
%     } {
%       \exists \delta .\ \delta \satisfies Z
%     } 
%   \end{mathpar}
%   \TODO{...}
% \end{theorem}

% \begin{theorem}(Proof typing soundness)
%   \label{thm:proof_typing_soundness}
%   \begin{mathpar}
%     \inferrule { 
%       \Gamma \entails e \hastype \tau \given Z  
%     } {
%       \exists \delta .\ \delta, \Gamma \satisfies e \hastype \tau
%     } 
%   \end{mathpar}
%   \TODO{...}
% \end{theorem}


% \begin{theorem}(Proof typing weak soundness)
%   \label{thm:proof_typing_weak_soundness}
%   \begin{mathpar}
%     \inferrule { 
%       \Gamma \entails e \hastype \tau \given Z  
%     } {
%       \forall \delta .\ \delta \satisfies Z \implies \delta, \Gamma \satisfies e \hastype \tau
%     } 
%   \end{mathpar}

%   \TODO{rewrite inductive hypotheses with just the conclusion implied by the case conditions}

%   \TODO{rewrite cases with universal/implication in conclusion/hypotheses}

%   Proof: 
%   \item $
%     \B{assume } 
%     \Gamma \entails e \hastype \tau \given Z 
%   $ 
%     \item \Z $\B{induct on } \Gamma \entails e \hastype \tau \given Z$ 
% \end{theorem}

%     \item \Z $\B{case } e = \J{@} \I \tau = \J{@}$ 
%       \item \Z\Z $\B{def } \delta$ by definition
%       \item \Z\Z $\delta, \Gamma \satisfies \J{@} \hastype \J{@}$ by definition
%       \item \Z\Z $\delta, \Gamma \satisfies e \hastype \tau$ by substitution
%       \item \Z\Z $\exists \delta .\ \delta, \Gamma \satisfies e \hastype \tau$ by witness 

%     \item \Z $\B{case } e = x \I \J{$x$:$\tau$} \in \Gamma$ 
%     \item \Z $\B{wrt } x$ 
%       \item \Z\Z $\B{def } \delta$ by definition
%       \item \Z\Z $\delta, \Gamma \satisfies x \hastype \tau$  by definition
%       \item \Z\Z $\delta, \Gamma \satisfies e \hastype \tau$ by substitution
%       \item \Z\Z $\exists \delta .\ \delta, \Gamma \satisfies e \hastype \tau$ by witness 

%   \item \Z $\B{case } 
%     \Gamma \entails e' \hastype \tau' \given Z
%     \I
%     \tau = \J{<$l$>$\tau'$}
%     \I
%     e = \J{<$l$>$e'$} 
%   $ 
%   \item \Z $\B{hypo } 
%       \Gamma \entails e' \hastype \tau' \given Z  
%       \implies
%       \delta, \Gamma \satisfies e' \hastype \tau'
%   $ 
%   \item \Z $\B{wrt } e' \ \tau'$ 
%     \item \Z\Z $\B{def } \delta $ by definition
%     \item \Z\Z $
%       \delta, \Gamma \satisfies e' \hastype \tau'
%     $ by application
%     \item \Z\Z $
%       \delta, \Gamma \satisfies \J{<$l$>$e'$} \hastype \J{<$l$>$\tau'$}
%     $ by definition
%     \item \Z\Z $
%       \delta, \Gamma \satisfies e \hastype \tau 
%     $ by substitution
%     \item \Z\Z $
%       \exists \delta .\ \delta, \Gamma \satisfies e \hastype \tau 
%     $ by witness 

%   \item \Z \TODO{remaining trivial introduction cases} 
%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   \item \Z $\B{case } $ 
%   \item \Z $\B{hypo } $ 
%   \item \Z $\B{wrt } $ 
%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   %   \inferrule {
%   %     \Gamma \entails R \hastype \tau_0 \given Z_0
%   %     \\
%   %     Z_0 \looparrowright Z_1
%   %     \\
%   %     \Gamma \entails e \hastype \tau_1 \given Z_1
%   %   } {
%   %     \Gamma \entails R\ \J{*$l$=$e$} \hastype \tau_0\ \J{\&}\ \J{$l$:$\tau_1$} \given Z_1
%   %   }

%   %   \inferrule {
%   %     Z, \Gamma \entails F \liftfun \Pi, \Tau_n 
%   %     \\
%   %     \Gamma \entails \Pi \equiv \Tau 
%   %   } {
%   %     \Gamma \entails F \hastype \J{\&}(\Tau) \given Z
%   %   }
%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%   \item \Z $\B{case } 
%     \Gamma \entails e_0 \hastype \tau_0 \given Z_0
%     \I
%     Z_0 \looparrowright Z_1
%     \I
%     \tau_0 \subtypes \J{$l$->$\alpha$} \given Z_1
%     \I
%     e = \J{$e_0$.$l$} \I \tau = \alpha \I Z = Z_1
%   $
   
%   \item \Z $\B{hypo } 
%     \Gamma \entails e_0 \hastype \tau_0 \given Z_0 
%     \implies 
%     \delta, \Gamma \satisfies e_0 \hastype \tau_0
%   $ 
%   \item \Z $\B{wrt } \delta\ e' \ l \ \alpha \ \tau_0 \ Z_0 \ Z_1$ 

%     \item \Z\Z $
%       \delta, \Gamma \satisfies e_0 \hastype \tau_0
%     $ by application

%     \item \Z\Z $
%       \B{def }
%       M\ \Delta
%       \B{ s.t. }
%       \tau_0 \subtypes \J{$l$->$\alpha$} \given M, \Delta
%     $ by theorem \ref{thm:proof_subtyping_choice}


%     \item \Z\Z $
%       \delta \satisfies \tau_0  \subtypes \J{$l$->$\alpha$}
%     $ by theorem \ref{thm:proof_subtyping_weak_soundness}
%     \item \Z\Z $
%       \delta, \Gamma \satisfies e_0 \hastype \J{$l$->$\alpha$}
%     $ by theorem \ref{thm:model_subtyping_elimination} 
%     \item \Z\Z $
%       \delta, \Gamma \satisfies \J{$e_0$.$l$} \hastype \alpha 
%     $ by theorem \ref{thm:model_subtyping_record_elimination} 
%     \item \Z\Z $
%       \delta, \Gamma \satisfies e \hastype \tau
%     $ by substitution 
%     \item \Z\Z $
%       \exists \delta .\ \delta, \Gamma \satisfies e \hastype \tau
%     $ by witness 


%   \item \Z $\B{case } 
%     \Gamma \entails e_0 \hastype \tau_0 \given Z_0
%     \I
%     Z_0 \looparrowright Z_1
%     \I
%     \Gamma \entails e_1 \hastype \tau_1 \given Z_1
%     \I
%     e = \J{$e_0$($e_1$)} 
%     \I 
%     \tau = \alpha 
%     \I
%     Z = Z_2
%   $ 
%   \item \Z $ 
%     Z_1 \looparrowright Z_2
%     \I
%     \tau_0 \subtypes \J{$\tau_1$->$\alpha$} \given Z_2
%   $ 
%   \item \Z $\B{hypo } 
%     \Gamma \entails e_0 \hastype \tau_0 \given Z_0
%     \implies 
%     \delta, \Gamma \satisfies e_0 \hastype \tau_0
%     \I
%     \Gamma \entails e_1 \hastype \tau_1 \given Z_1
%     \implies 
%     \delta, \Gamma \satisfies e_1 \hastype \tau_1
%   $ 
%   \item \Z $\B{wrt } e_0\ e_1\ \alpha\ \tau_0\ \tau_1\ Z_0\ Z_1\ Z_2 $ 
%     \item \Z\Z $
%       \delta, \Gamma \satisfies e_0 \hastype \tau_0
%     $ by application
%     \item \Z\Z $
%       \delta, \Gamma \satisfies e_1 \hastype \tau_1
%     $ by application

%     \item \Z\Z $
%       \B{def } M\ \Delta
%       \B{ s.t. }
%       \tau_0 \subtypes \J{$\tau_1$->$\alpha$} \given \left<M, \Delta \right>
%     $ by theorem \ref{thm:proof_subtyping_choice} 
%     \item \Z\Z $
%       \delta, \Gamma \satisfies \tau_0 \subtypes \J{$\tau_1$->$\alpha$} 
%     $ by theorem \ref{thm:proof_subtyping_weak_soundness} 
%     \item \Z\Z $
%       \delta \satisfies e_0 \hastype \J{$\tau_1$->$\alpha$} 
%     $ by theorem \ref{thm:model_subtyping_elimination} 
%     \item \Z\Z $
%       \delta, \Gamma \satisfies \J{$e_0$($e_1$)} \hastype \alpha
%     $ by theorem \ref{thm:model_typing_implication_elimination} 
%     \item \Z\Z $
%       \delta, \Gamma \satisfies e \hastype \tau
%     $ by substitution 
%     \item \Z\Z $
%       \exists \delta .\ \delta, \Gamma \satisfies e \hastype \tau
%     $ by substitution 

%   \item \Z $\B{case } 
%     e = \J{loop($e'$)} 
%   $ 
%   \item \Z $\contin  
%     \tau = \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.$\alpha_l'$*$\alpha_r'$<:LFLFP[$\alpha_{h^-}$] |$(\Tau)$]$\alpha_r$} 
%   $
%   \item \Z $\contin 
%     Z = Z_0 
%   $
%   \item \Z $\contin  
%     \Gamma \entails e' \hastype \J{$\alpha_{h^+}$->$\tau'$} \given Z_0
%     \I
%     Z_0 \looparrowright Z_1
%     \I
%     \tau' \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z_1
%   $ 
%   \item \Z $\contin  
%     \textbf{ftv}(\Gamma) \entails \alpha_{h^+} \cdot Z_1 \cdot \J{$\alpha_l$->$\alpha_r$} \fallingdotseq \alpha_{h^-} \cdot \Tau
%   $
%   \item \Z $\B{hypo } 
%     \forall \delta .\ \delta \satisfies Z_0 \implies
%     \delta, \Gamma \satisfies e' \hastype \J{$\alpha_{h^+}$->$\tau'$}
%   $ 
%   \item \Z $\B{wrt } e'\ \tau'\ \alpha_{h^+}\ \alpha_l\ \alpha_r\ \alpha_{h^-}\ \alpha_l'\ \alpha_r'\ \Tau\ Z_0\ Z_1 $ 
%     \item \Z\Z $\B{for } \delta \B{ assume } \delta \satisfies Z$
%       \item \Z\Z\Z $\delta \satisfies Z_0$ by substitution
%       \item \Z\Z\Z $
%         \delta, \Gamma \satisfies e' \hastype \J{$\alpha_{h^+}$->$\tau'$}
%       $ by instantiation and application
%       \item \Z\Z\Z $
%         \delta \satisfies \tau' \subtypes 
%         \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.$\alpha_l'$*$\alpha_r'$<:LFP[$\alpha_{h^-}$] |$(\Tau)$]$\alpha_r$}
%       $ by theorem \ref{thm:fixpoint_duality_correspondence}

%       \item \Z\Z\Z $
%         \delta \satisfies \tau' \subtypes \tau
%       $ by substitution  

%       \item \Z\Z\Z $
%         \delta \satisfies e' \hastype \J{$\alpha_{h^+}$->$\tau$}
%       $ by theorem \ref{thm:model_subtyping_elimination} 

%       \item \Z\Z\Z $
%         \delta \satisfies \J{loop($e'$)} \hastype \tau 
%       $ by theorem \ref{thm:model_typing_implication_independence}

%       \item \Z\Z\Z $
%         \delta \satisfies e \hastype \tau 
%       $ by substitution 

%     \item \Z\Z $
%       \forall \delta .\ \delta \satisfies Z \implies \delta \satisfies e \hastype \tau 
%     $ by implication and generalization 

%   \item \Z $\delta, \Gamma \satisfies e \hastype \tau$
%     by induction
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Fixpoint duality soundness (new))
%   \label{thm:fixpoint_duality_correspondence}
%   \begin{mathpar}
%     \inferrule { 
%       \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z_1
%       \\
%       \textbf{ftv}(\tau) \subseteq N
%       \\
%       \alpha_l \notin N
%       \\
%       \alpha_r \notin N
%       \\
%       N \entails \alpha_{h^+} \cdot Z_1 \cdot \J{$\alpha_l$->$\alpha_r$} \fallingdotseq \alpha_{h^-} \cdot \Tau
%     } {
%       \delta \satisfies 
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.$\alpha_l'$*$\alpha_r'$<:LFP[$\alpha_{h^-}$] |$(\Tau)$]$\alpha_r'$} 
%     } 
%   \end{mathpar}
%   \TODO{...}
% \end{theorem}

% \TODO{Cretin's corresponding theorem is Theorem 101 on p. 134}

% \TODO{See how Cretin proves this without using subject reduction}

% \begin{theorem}(Fixpoint duality soundness old)
%   \label{thm:fixpoint_duality_correspondence_old}
%   \begin{mathpar}
%     \inferrule { 
%       Z_0 \looparrowright Z_1
%       \\
%       N \entails \alpha_{h^+} \cdot Z_1 \cdot \J{$\alpha_l$->$\alpha_r$} \fallingdotseq \alpha_{h^-} \cdot \Tau
%     } {
%       \forall \tau .\ 
%       \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z_1
%       \implies
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.$\alpha_l'$*$\alpha_r'$<:LFP[$\alpha_{h^-}$] |$(\Tau)$]$\alpha_r'$} 
%       \given Z_0
%     } 
%   \end{mathpar}
%   Proof: 
%   \item $\B{assume }
%     Z_0 \looparrowright Z_1
%     \I
%     N \entails \alpha_{h^+} \cdot Z_1 \cdot \J{$\alpha_l$->$\alpha_r$} \fallingdotseq \alpha_{h^-} \cdot \Tau
%   $ 
%   \item \Z $\B{induct on }
%     N \entails \alpha_{h^+} \cdot Z_1 \cdot \J{$\alpha_l$->$\alpha_r$} \fallingdotseq \alpha_{h^-} \cdot \Tau
%   $
%   \item \Z $\B{case }
%     Z_1 = \epsilon \I \Tau = \epsilon
%   $
%     \item \Z\Z $\B{for } \tau$
%       \item \Z\Z\Z $\B{assume }
%         \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z_1
%       $
%         \item \Z\Z\Z\Z $
%           \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given \epsilon 
%         $ by substitution

%         \item \Z\Z\Z\Z $
%           \B{def } M\ \Delta\ \B{ s.t. } \left<M, \Delta\right> \in \epsilon 
%         $ by theorem \ref{thm:universe_proof_typing_worldly}  

%         \item \Z\Z\Z\Z $\bot$ by theorem \ref{thm:empty_containment_absurd}
%       \item \Z\Z\Z $
%         \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z_1
%         \implies
%         \tau
%         \subtypes
%         \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.$\alpha_l'$*$\alpha_r'$<:LFP[$\alpha_{h^-}$] |$(\Tau)$]$\alpha_r'$} 
%         \given Z_0
%       $ by implication
%     \item \Z\Z $
%       \forall \tau .\ 
%       \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z_1
%       \implies
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.$\alpha_l'$*$\alpha_r'$<:LFP[$\alpha_{h^-}$] |$(\Tau)$]$\alpha_r'$} 
%       \given Z_0
%     $ by generalization 
%   \item \Z $\B{case }
%     Z_1 = Z\ \left<M, \Delta \right> \I \Tau = \Tau_i\ \tau_i
%   $
%   \item \Z $\contin
%     N \entails 
%     \alpha_{h^+} \cdot Z \cdot \J{$\alpha_l$->$\alpha_r$} 
%     \fallingdotseq 
%     \alpha_{h^-} \cdot \Tau_i
%   $
%   \item \Z $\contin
%     M, \Delta, \Delta \entails \alpha_{h^+} \subtypes \Tau_h
%     \I
%     M, \Delta, \Delta \entails \alpha_l \subtypes \Tau_l 
%     \I
%     M, \Delta, \Delta \entails \Tau_r \subtypes \alpha_r
%   $
%   \item \Z $\contin
%     \widebar{\J{$\tau_l$*$\tau_r$<:$\alpha_{h^-}$}}^{\tau_l\ \tau_r .\ \tau_l\J{->}\tau_r \in \Tau_h} = \Delta_h
%   $
%   \item \Z $\contin
%     N \cup M \cup \textbf{ftv}(\Tau_l) \cup \textbf{ftv}(\Tau_r)\ \alpha_{h^-} = \Alpha 
%     \I
%     \Delta \entails \Alpha \pitchfork \Delta_i  
%   $
%   \item \Z $\contin
%     N\ \alpha_{h^-}, M, \Delta_i \cup \Delta_h \entails \J{\&$(\Tau_l)$*|$(\Tau_r)$} \cong^{-} \tau_i
%   $
%   \item \Z $\B{hypo }
%     N \entails 
%     \alpha_{h^+} \cdot Z \cdot \J{$\alpha_l$->$\alpha_r$} 
%     \fallingdotseq 
%     \alpha_{h^-} \cdot \Tau_i
%     \implies
%     \\
%     \forall \tau .\ 
%     \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z
%     \implies
%     \tau
%     \subtypes
%     \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.($\alpha_l'$,$\alpha_r'$)<:LFP[$\alpha_{h^-}$] |$(\Tau_i)$]$\alpha_r'$} 
%     \given Z_0
%   $
%   \item \Z $\B{wrt }
%     Z\ M\ \Delta\ \Tau_i\ \tau_i
%   $

%     \item \Z\Z $\B{for } \tau \B{ assume }
%       \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z_1
%     $
%       \item \Z\Z\Z $
%         \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z\ \left<M, \Delta\right>
%       $ by substitution

%       \item \Z\Z\Z $
%         \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given\left<M, \Delta\right>
%       $ by theorem \ref{thm:proof_subtyping_decomposition}

%       \item \Z\Z\Z $
%         \tau
%         \subtypes
%         \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.($\alpha_l'$,$\alpha_r'$)<:LFP[$\alpha_{h^-}$] |$(\Tau_i)$]$\alpha_r'$} 
%         \given Z_0
%       $ by instantiation and application 
%       \item \Z\Z\Z $
%         \tau
%         \subtypes
%         \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.($\alpha_l'$,$\alpha_r'$)<:LFP[$\alpha_{h^-}$] |$(\Tau_i\ \tau_i)$]$\alpha_r'$} 
%         \given Z_0
%       $ by theorem \ref{thm:universe_proof_typing_fixpoint_extension}
%     \item \Z\Z $
%       \forall \tau .\ 
%       \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z_1
%       \implies
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.($\alpha_l'$,$\alpha_r'$)<:LFP[$\alpha_{h^-}$] |$(\Tau)$]$\alpha_r'$} 
%       \given Z_0
%     $ by implication and generalization 


%   \item \Z $
%     \forall \tau .\ 
%     \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given Z_1
%     \implies
%     \tau
%     \subtypes
%     \J{ALL[$\alpha_l'$]$\alpha_l'$->EXI[$\alpha_r'$.($\alpha_l'$,$\alpha_r'$)<:LFP[$\alpha_{h^-}$] |$(\Tau)$]$\alpha_r'$} 
%     \given Z_0
%   $ by induction
%   \item $\square$ by implication
% \end{theorem}

% \begin{theorem}(Universe Proof Typing fixpoint extension)
%   \label{thm:universe_proof_typing_fixpoint_extension}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l$]$\alpha_l$->EXI[$\alpha_r$.($\alpha_l$,$\alpha_r$)<:LFP[$\alpha_{h^-}$] |$(\Tau_i)$]$\alpha_r$} 
%       \\\\
%       \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given\left<M, \Delta\right>
%       \\\\
%       \Delta \entails \alpha_{h^+} \subtypes \Tau_h
%       \\
%       \Delta \entails \alpha_l \subtypes \Tau_l 
%       \\
%       \Delta \entails \Tau_r \subtypes \alpha_r
%       \\\\
%       \widebar{\J{$\tau_l$*$\tau_r$<:$\alpha_{h^-}$}}^{\tau_l\J{->}\tau_r \in \Tau_h} = \Delta_h
%       \\
%       N \cup M \cup \textbf{ftv}(\Tau_l) \cup \textbf{ftv}(\Tau_r)\ \alpha_{h^-} = \Alpha 
%       \\ 
%       \Delta \entails \Alpha \pitchfork \Delta_i  
%       \\
%       N\ \alpha_{h^-}, M, \Delta_i \cup \Delta_h \entails \J{\&$(\Tau_l)$*|$(\Tau_r)$} \cong^{-} \tau_i
%     } {
%       \delta \satisfies
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l$]$\alpha_l$->EXI[$\alpha_r$.$\alpha_l$*$\alpha_r$<:LFP[$\alpha_{h^-}$] |$(\Tau_i\ \tau_i)$]$\alpha_r$} 
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Universe Proof Typing case soundness)
%   \label{thm:universe_proof_typing_case_soundnes}
%   \begin{mathpar}
%     \inferrule { 
%       \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given\left<M, \Delta\right>
%       \\\\
%       \Delta \entails \alpha_{h^+} \subtypes \Tau_h
%       \\
%       \Delta \entails \alpha_l \subtypes \Tau_l 
%       \\
%       \Delta \entails \Tau_r \subtypes \alpha_r
%       \\\\
%       \widebar{\J{$\tau_l$*$\tau_r$<:$\alpha_{h^-}$}}^{\tau_l\J{->}\tau_r \in \Tau_h} = \Delta_h
%       \\
%       N \cup M \cup \textbf{ftv}(\Tau_l) \cup \textbf{ftv}(\Tau_r)\ \alpha_{h^-} = \Alpha 
%       \\ 
%       \Delta \entails \Alpha \pitchfork \Delta_i  
%       \\
%       N\ \alpha_{h^-}, M, \Delta_i \cup \Delta_h \entails \J{\&$(\Tau_l)$*|$(\Tau_r)$} \cong^{-} \tau_i
%     } {
%       \delta \satisfies
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l$]$\alpha_l$->EXI[$\alpha_r$.$\alpha_l$*$\alpha_r$<:LFP[$\alpha_{h^-}$] $\tau_i$]$\alpha_r$} 
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Universe Proof Typing fixpoint union)
%   \label{thm:universe_proof_typing_fixpoint_union}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l$]$\alpha_l$->EXI[$\alpha_r$.$\alpha_l$*$\alpha_r$<:LFP[$\alpha_{h^-}$] |($\Tau$)]$\alpha_r$} 
%       \\
%       \delta \satisfies
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l$]$\alpha_l$->EXI[$\alpha_r$.$\alpha_l$*$\alpha_r$<:LFP[$\alpha_{h^-}$] $\tau$]$\alpha_r$} 
%     } {
%       \delta \satisfies
%       \tau
%       \subtypes
%       \J{ALL[$\alpha_l$]$\alpha_l$->EXI[$\alpha_r$.$\alpha_l$*$\alpha_r$<:LFP[$\alpha_{h^-}$] |($\Tau\ \tau$)]$\alpha_r$} 
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}

% \begin{theorem}\ Influential soundness 
%   \label{thm:influential_soundness}

%   \TODO{Prove that any constraints on non-influential variables with have been transitively applied to the influential variables}

%   \begin{mathpar}
%     \inferrule { 
%       \tau \subtypes \J{$\alpha_l$->$\alpha_r$} \given M, \Delta
%       \\
%       \Delta \entails \alpha_l \subtypes \Tau_l 
%       \\
%       \Delta \entails \Tau_r \subtypes \alpha_r
%       \\\\
%       \Delta \entails \Alpha \pitchfork \Delta_i  
%       \\
%       \textbf{ftv}(\tau) \subseteq \Alpha
%       \\\\
%       N, M, \Delta \cup \Delta' \given \J{\&$(\Tau_l)$*|$(\Tau_r)$} \cong^- \tau
%       \\
%       N, M, \Delta_i \cup \Delta' \given \J{\&$(\Tau_l)$*|$(\Tau_r)$} \cong^- \tau_i
%     } {
%       \delta \satisfies \tau \subtypes \tau_i 
%       \land
%       \delta \satisfies \tau_i \subtypes \tau
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}

% % \begin{theorem}(Universe Proof Typing implication expansion)
% %   \label{thm:universe_proof_typing_implication}
% %   \begin{mathpar}
% %     \inferrule { 
% %       M, \Delta, \Delta \entails \alpha_l \subtypes \Tau_l 
% %       \\
% %       M, \Delta, \Delta \entails \Tau_r \subtypes \alpha_r
% %       \\
% %     } {
% %       \J{\&$(\Tau_l)$->|$(\Tau_r)$}
% %       \subtypes
% %       \J{ALL[$\alpha_l$]$\alpha_l$->EXI[$\alpha_r$.($\alpha_l$,$\alpha_r$)<:(\&$(\Tau_l)$,|$(\Tau_r)$)]$\alpha_r$} 
% %       \given M, \Delta
% %     } 
% %   \end{mathpar}
% %   Proof: 
% %   \item \TODO{$P \implies Q$ is equivalent to $\neg (P \land \neg Q)$} 
% %   \item $\square$
% % \end{theorem}

% \begin{theorem}(Universe Proof Typing implication expansion)
%   \label{thm:universe_proof_typing_implication_expansion}
%   \begin{mathpar}
%     \inferrule { 
%     } {
%       \J{$\tau_l$->$\tau_r$}
%       \subtypes
%       \J{ALL[$\alpha_l$]$\alpha_l$->EXI[$\alpha_r$.($\alpha_l$,$\alpha_r$)<:($\tau_l$,$\tau_r$)]$\alpha_r$} 
%       \given M, \Delta
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{$P \implies Q$ is equivalent to $\neg (P \land \neg Q)$} 
%   \item \TODO{$X \rightarrow Y$ is equivalent to $\forall x \in X .\ \exists y .\ (x,y) \in (X \times Y)$} 
%   \item \TODO{$X \rightarrow Y$ is equivalent to $\neg (\exists x \in X \land \nexists y \in Y)$} 
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Upper bound interpretation sound)
%   \label{thm:upper_bound_interpretation_sound}
%   \begin{mathpar}
%     \inferrule { 
%       M, \Delta, \Delta \entails \alpha \subtypes \Tau 
%     } {
%      \alpha \subtypes \J{\&$(\Tau)$} \given \left<M, \Delta\right>
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Lower bound interpretation sound)
%   \label{thm:lower_bound_interpretation_sound}
%   \begin{mathpar}
%     \inferrule { 
%       M, \Delta, \Delta \entails \Tau \subtypes \alpha
%       \\
%     } {
%      \J{|$(\Tau)$} \subtypes \alpha \given \left<M, \Delta\right>
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}


% \begin{theorem}(Universe Proof Typing worldly)
%   \label{thm:universe_proof_typing_worldly}
%   \begin{mathpar}
%     \inferrule { 
%       \tau_l \subtypes \tau_r \given Z 
%     } {
%       \exists M\ \Delta\ .\ \left<M, \Delta\right> \in Z
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Empty containment absurd)
%   \label{thm:empty_containment_absurd}
%   \begin{mathpar}
%     \inferrule { 
%       \left<M, \Delta\right> \in \epsilon 
%     } {
%       \bot
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}


% \begin{theorem}(Model typing implication independence)
%   \label{thm:model_typing_implication_independence}
%   \begin{mathpar}
%     \inferrule { 
%       \delta, \Gamma \satisfies e \hastype \J{$\tau_l$->$\tau_r$} 
%       \\
%       \delta \satisfies \tau_r
%     } {
%       \delta, \Gamma \satisfies \J{loop($e$)} \hastype \tau_r
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}


% % \begin{theorem}(Proof typing fix interpolation weakest pre-condition)
% %   \label{thm:fix_duality}
% %   \begin{mathpar}
% %     \inferrule { 
% %       \tau \subtypes \J{$\alpha_0$->$\alpha_1$->$\alpha_2$} \given Z_1
% %       \\\\
% %       \textbf{ftv}(\Gamma) \entails \alpha_0 \cdot Z_1 \cdot \J{$\alpha_1$->$\alpha_2$} \fallingdotseq \alpha_3 \circlearrowright \Tau_{rel}
% %     } {
% %       \J{ALL[$\alpha_4$]$\alpha_4$->EXI[$\alpha_5$.($\alpha_4$,$\alpha_5$)<:LFP[$\alpha_3$.|$(\Tau_{rel})$]]$\alpha_5$} 
% %       \subtypes
% %       \J{$\alpha_1$->$\alpha_2$}
% %       \given Z_1
% %     } 
% %   \end{mathpar}
% %   Proof: 
% %   \item \TODO{...} 
% %   \item $\square$
% % \end{theorem}

% \begin{theorem}(Proof subtyping decomposition)
%   \label{thm:proof_subtyping_decomposition}
%   \begin{mathpar}
%     \inferrule { 
%       \tau_l \subtypes \tau_r \given Z\ \left<M, \Delta\right>
%     } {
%       \tau_l \subtypes \tau_r \given \left<M, \Delta\right>
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}


% \begin{theorem}(Proof subtyping choice)
%   \label{thm:proof_subtyping_choice}
%   \begin{mathpar}
%     \inferrule { 
%       \tau_l \subtypes \tau_r \given Z 
%     } {
%       \exists M\ \Delta .\ \tau_l \subtypes \tau_r \given M, \Delta
%     } 
%   \end{mathpar}
%   Proof: 
%   \item \TODO{...} 
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Model subtyping elimination)
%   \label{thm:model_subtyping_elimination}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \tau_l \subtypes \tau_r
%       \\
%       \delta, \Gamma \satisfies e \hastype  \tau_l  
%     } {
%       \delta, \Gamma \satisfies e \hastype \tau_r 
%     } 
%   \end{mathpar}
%   Proof: 
%   \item $\B{assume } 
%     \delta \satisfies \tau_l \subtypes \tau_r
%     \I
%     \delta, \Gamma \satisfies e \hastype  \tau_l  
%   $
%   \item \Z $\B{invert on } \delta \satisfies \tau_l \subtypes \tau_r$
%   \item \Z $\B{case } \forall e'\ \Gamma' .\ \delta, \Gamma' \satisfies e' \hastype  \tau_l  \implies \delta, \Gamma' \satisfies e' \hastype \tau_r$
%   \item \Z\Z $\delta, \Gamma \satisfies e \hastype  \tau_l  \implies \delta, \Gamma \satisfies e \hastype \tau_r$ by instantiation
%   \item \Z\Z $\delta, \Gamma \satisfies e \hastype \tau_r$ by application 
%   \item \Z $\delta, \Gamma \satisfies e \hastype \tau_r$ by inversion
%   \item $\square$ by implication
% \end{theorem}


\begin{theorem}(Model typing record elimination)
  \label{thm:model_subtyping_record_elimination}
  \begin{mathpar}
    \inferrule { 
      \delta, \Gamma \satisfies e \hastype \J{$l$->$\tau$}
    } {
      \delta, \Gamma \satisfies \J{$e$.$l$} \hastype \tau 
    } 
  \end{mathpar}
  Proof: 
  \item $\B{assume } 
    \delta, \Gamma \satisfies e \hastype \J{$l$->$\tau$}
  $ 
    \item \Z $\B{induct on } 
      \delta, \Gamma \satisfies e \hastype \J{$l$->$\tau$}
    $ 
    \item \Z $\B{case }
      e = G
      \I
      \J{?$l$=>$v$} \in G
      \I
      \delta, \Gamma \satisfies v \hastype \tau
      \I
      \forall v' .\ \J{?$l$=>$v'$} \in G \implies v' = v 
    $ 
    \item \Z $\B{wrt }
      G\ v 
    $
  
      \item \Z\Z $
        \delta, \Gamma \satisfies G \hastype \J{$l$->$\tau$}
      $ by substitution

      \item \Z\Z $
        \J{$G$.$l$} \rightsquigarrow v
      $ by definition 

      \item \Z\Z $
        \B{def } \sigma \B{ s.t. } \delta, \Gamma \satisfies \sigma 
      $ by theorem \ref{...} 
      \item \Z\Z $
        \J{$G$.$l$}[\sigma] \rightsquigarrow v
      $ by definition 
      \item \Z\Z $
        v = v[\sigma \cup \epsilon] 
      $ by definition 
      \item \Z\Z $
        \J{$G$.$l$}[\sigma] \rightsquigarrow v[\sigma \cup \epsilon] 
      $ by substitution 
      \item \Z\Z $
        \delta, \epsilon \satisfies \epsilon 
      $ by definition 

      \item \Z\Z $
        \delta, \Gamma \cup \epsilon \satisfies v \hastype \tau
      $ by definition 
      \item \Z\Z $
        \delta, \Gamma \satisfies \J{$G$.$l$} \hastype \tau 
      $ by definition 
      \item \Z\Z $
        \delta, \Gamma \satisfies \J{$e$.$l$} \hastype \tau 
      $ by substitution


    \item \Z $\B{case }
      \delta, \sigma \satisfies \Gamma
      \I
      e[\sigma] \rightsquigarrow e'[\sigma \cup \sigma']
      \I
      \delta, \sigma' \satisfies \Gamma'
      \I
      \delta, \Gamma \cup \Gamma' \satisfies e' \hastype \J{$l$->$\tau$}
    $
    \item \Z $\B{hypo }
      \delta, \Gamma \cup \Gamma' \satisfies e' \hastype \J{$l$->$\tau$}
      \implies
      \delta, \Gamma \cup \Gamma' \satisfies \J{$e'$.$l$} \hastype \tau
    $
    \item \Z $\B{wrt }
      \sigma\ e'\ \sigma'\ \Gamma'
    $
      \item \Z\Z $
        \delta, \Gamma \cup \Gamma' \satisfies \J{$e'$.$l$} \hastype \tau
      $ by application
      \item \Z\Z $
        \J{$e[\sigma]$.$l$} \rightsquigarrow \J{$e'[\sigma \cup \sigma']$.$l$}
      $ by definition 
      \item \Z\Z $
        \J{$e[\sigma]$.$l$} = \J{$e$.$l$}[\sigma]
      $ by definition 
      \item \Z\Z $
        \J{$e'[\sigma \cup \sigma']$.$l$} = \J{$e'$.$l$}[\sigma \cup \sigma']
      $ by definition 
      \item \Z\Z $
        \J{$e$.$l$}[\sigma] \rightsquigarrow \J{$e'$.$l$}[\sigma \cup \sigma']
      $ by substitution 
      \item \Z\Z $
        \delta, \Gamma \satisfies \J{$e$.$l$} \hastype \tau 
      $ by definition 

    \item \Z $
      \delta, \Gamma \satisfies \J{$e$.$l$} \hastype \tau 
    $ by induction 
  \item $\square$
\end{theorem}

% \begin{theorem}(Proof subtyping consistency)
%   \label{thm:proof_subtypig_substance}
%   \begin{mathpar}
%     \inferrule { 
%       \tau_l \subtypes \tau_r \given M, \Delta 
%     } {
%       \exists \delta .\ 
%       \delta \satisfies \Delta
%     } 
%   \end{mathpar}
% \end{theorem}

% \begin{theorem}(Proof subtyping soundness)
%   \label{thm:proof_subtyping_soundness}
%   \begin{mathpar}
%     \inferrule { 
%       \tau_l \subtypes \tau_r \given M, \Delta 
%     } {
%       \exists \delta .\ 
%       \delta \satisfies \tau_l \subtypes \tau_r
%     } 
%   \end{mathpar}
% \end{theorem}


% \begin{theorem}(Proof subtyping weak soundness)
%   \label{thm:proof_subtyping_weak_soundness}
%   \begin{mathpar}
%     \inferrule { 
%       \tau_l \subtypes \tau_r \given M, \Delta 
%     } {
%       \forall \delta .\ 
%       \delta \satisfies \Delta
%       \implies
%       \delta \satisfies \tau_l \subtypes \tau_r
%     } 
%   \end{mathpar}

% \TODO{closed variabless simply remove variables from soundness consideration}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % (EXI[X . 1 <: X, X <: 3] X) <: 2  -| 1 <: X, X <: 3, ..., X <: 2  
% % FAILS, not considered for soundness
% % (EXI[X . 1 <: X, X <: 2] X) <: 2  -| 1 <: X, X <: 2, ..., X <: 2  
% % PASSES, is considered for soundness
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % 2 <: (EXI[X . 1 <: X, X <: 3] X)  -| 2 <: X, ..., 1 <: X, X <: 3 
% % PASSES, is considered for soundness
% % 2 <: (EXI[X . X <: 1 ] X)  -| 2 <: X, ..., X <: 1
% % FAILS, not considered for soundness
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   Proof: 
%   \item \TODO{think about how to handle the mutually recursive definition} 
%   \item $\B{assume } 
%     \tau_l \subtypes \tau_r \given M, \Delta 
%   $
%     \item \Z $\B{induct on } \tau_l \subtypes \tau_r \given M, \Delta$

%     \item \Z $\B{case } \tau_l = \tau \I \tau_r = \tau$
%     \item \Z $\B{wrt } \tau $
%       \item \Z\Z $\B{for } \delta \B{ assume } \delta \satisfies \Delta$
%         \item \Z\Z\Z $\delta \satisfies \tau \subtypes \tau$
%         by theorem \ref{thm:model_typing_reflexivity}
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_r$ by substitution 
%       \item \Z\Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%       by implication and generalization 

%     \item \Z $\B{case } \tau_l = \J{BOT}$
%       \item \Z\Z $\B{for } \delta \B{ assume } \delta \satisfies \Delta$
%         \item \Z\Z\Z $\delta \satisfies \J{BOT} \subtypes \tau_r$ by definition
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_r$ by substitution 
%       \item \Z\Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%       by implication and generalization 

%     \item \Z $\B{case } \tau_r = \J{TOP}$
%       \item \Z\Z $\B{for } \delta \B{ assume } \delta \satisfies \Delta$
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \J{TOP}$ by definition
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_r$ by substitution 
%       \item \Z\Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%       by implication and generalization 

%     \item \Z $\B{case } 
%       \tau_r = \J{$l$->($\tau_{rl}$\&$\tau_{rr}$)}
%       \I
%       \tau_l
%       \subtypes
%       \J{($l$->$\tau_{rl}$)\&($l$->$\tau_{rr}$)}
%       \given M, \Delta
%     $
%     \item \Z $\B{hypo }
%       \forall \delta .\ 
%       \delta \satisfies \Delta
%       \implies
%       \delta \satisfies \tau_l \subtypes \J{($l$->$\tau_{rl}$)\&($l$->$\tau_{rr}$)}
%     $ 
%     \item \Z $\B{wrt } l\ \tau_{rl}\ \tau_{rr}$ 
%       \item \Z\Z $\B{for } \delta \B{ assume } \delta \satisfies \Delta$
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \J{($l$->$\tau_{rl}$)\&($l$->$\tau_{rr}$)}$
%         by application
%         \item \Z\Z\Z $\B{for } e\ \Gamma \B{ assume } \delta, \Gamma \satisfies e \hastype \tau_l$ 
%           \item \Z\Z\Z\Z $\delta, \Gamma \satisfies e \hastype \J{($l$->$\tau_{rl}$)\&($l$->$\tau_{rr}$)}$
%           by theorem \ref{thm:model_typing_subsumption} 
%           \item \Z\Z\Z\Z $\delta, \Gamma \satisfies e \hastype \J{$l$->$\tau_{rl}$}$ by theorem \ref{thm:model_typing_intersection_elimination}
%           \item \Z\Z\Z\Z $\delta, \Gamma \satisfies e \hastype \J{$l$->$\tau_{rr}$}$ by theorem \ref{thm:model_typing_intersection_elimination}
%           \item \Z\Z\Z\Z $\delta, \Gamma \satisfies \J{$e$.$l$} \hastype \tau_{rl}$ by theorem \ref{thm:model_subtyping_record_elimination}
%           \item \Z\Z\Z\Z $\delta, \Gamma \satisfies \J{$e$.$l$} \hastype \tau_{rr}$ by theorem \ref{thm:model_subtyping_record_elimination}
%           \item \Z\Z\Z\Z $\delta, \Gamma \satisfies \J{$e$.$l$} \hastype \J{$\tau_{rl}$\&$\tau_{rr}$}$ by definition
%           \item \Z\Z\Z\Z $\delta, \Gamma \satisfies e \hastype \J{$l$->($\tau_{rl}$\&$\tau_{rr}$)}$ by theorem \ref{thm:model_typing_record_introduction} 
%           \item \Z\Z\Z\Z $\delta, \Gamma \satisfies e \hastype \tau_r$ by substitution 
%         \item \Z\Z\Z $\forall e\ \Gamma .\ \delta, \Gamma \satisfies e \hastype \tau_l \implies 
%           \delta, \Gamma \satisfies e \hastype \tau_r
%         $ by implication and generalization
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_r$
%         by definition 
%       \item \Z\Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%       by implication and generalization 


%     \item \Z $\B{case } 
%       \tau_l = \J{$\tau_{ll}$|$\tau_{lr}$}
%       \I
%       M = M_1
%       \I
%       \Delta = \Delta_1
%     $
%     \item \Z $\contin
%       \tau_{ll} \subtypes \tau_r
%       \given M_0, \Delta_0
%       \I
%       M_0 \preceq M_1
%       \I
%       \Delta_0 \preceq \Delta_1
%       \I
%       \tau_{lr} \subtypes \tau_r
%       \given M_1, \Delta_1
%     $

%     \item \Z $\B{hypo } 
%       \forall \delta .\ \delta \satisfies \Delta_0 \implies \delta \satisfies \tau_{ll} \subtypes \tau_r
%       \I
%       \forall \delta .\ \delta \satisfies \Delta_1 \implies \delta \satisfies \tau_{lr} \subtypes \tau_r
%     $
%     \item \Z $\B{wrt } \tau_{ll}\ \tau_{lr}$

%       \item \Z\Z $\B{for } \delta \B{ assume } M, \delta \satisfies \Delta$
%         \item \Z\Z\Z $\delta \satisfies \Delta_1$ by substitution 
%         \item \Z\Z\Z $\delta \satisfies \tau_{lr} \subtypes \tau_r$ by application 
%         \item \Z\Z\Z $\delta \satisfies \Delta_0$ by theorem \ref{...} \TODO{...} 
%         \item \Z\Z\Z $\delta \satisfies \tau_{ll} \subtypes \tau_r$ by application 
%         \item \Z\Z\Z $\delta \satisfies \J{$\tau_{ll}$|$\tau_{lr}$} \subtypes \tau_r$ 
%         by definition
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_r$ 
%         by substitution 

%       \item \Z\Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%       by implication and generalization

%     \item \Z $\B{case } 
%       \tau_r = \J{$\tau_{rl}$\&$\tau_{rr}$}
%       \I
%       M = M_1
%       \I
%       \Delta = \Delta_1
%     $
%     \item \Z $\contin 
%       \tau_l \subtypes \tau_{rl} \given M_0, \Delta_0
%       \I
%       M_0 \preceq M_1
%       \I
%       \Delta_0 \preceq \Delta_1
%       \I
%       \tau_l \subtypes \tau_{rr} \given M_1, \Delta_1
%     $
%     \item \Z $\B{hypo } 
%       \forall \delta .\ \delta \satisfies \Delta_0 \implies \delta \satisfies \tau_l \subtypes \tau_{rl} 
%       \I
%       \forall \delta .\ \delta \satisfies \Delta_1 \implies \delta \satisfies \tau_l \subtypes \tau_{rr} 
%     $
%     \item \Z $\B{wrt } $
%       \item \Z\Z $\B{for } \delta \B{ assume } \delta \satisfies \Delta$
%         \item \Z\Z\Z $\delta \satisfies \Delta_1 $ by substitution
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_{rr}$ by instantiation and application 
%         \item \Z\Z\Z $\delta \satisfies \Delta_0 $ by theorem \ref{...} \TODO{...} 
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_{rl}$ by instantiation and application 
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \J{$\tau_{rl}$\&$\tau_{rr}$}$ by definition 
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_r$ by substitution
%       \item \Z\Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%       by implication and generalization


%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \tau_l \subtypes
%     %   \J{($\tau_{ra}$->$\tau_{rc}$)\&($\tau_{rb}$->$\tau_{rc}$)}
%     %   \given M, \Delta
%     % } {
%     %   \tau_l \subtypes 
%     %   \J{$\tau_{ra}$|$\tau_{rb}$->$\tau_{rc}$}
%     %   \given M, \Delta
%     % }
%       \item \Z\Z \TODO{...} 

%     %%% TEMPLATE
%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \tau_l \subtypes
%     %   \J{($\tau_{ra}$->$\tau_{rb}$)\&($\tau_{ra}$->$\tau_{rc}$)}
%     %   \given M, \Delta
%     % } {
%     %   \tau_l \subtypes \J{$\tau_{ra}$->$\tau_{rb}$\&$\tau_{rc}$}
%     %   \given M, \Delta
%     % }
%       \item \Z\Z \TODO{...} 

%     %%% TEMPLATE
%     \item \Z $\B{case } 
%       \tau_l = \J{EXI[$\Alpha$ $Q$]$\tau_b$}
%       \I
%       M = M_1
%       \I
%       \Delta = \Delta_1
%     $
%     \item \Z $\contin
%       Q \given M_0, \Delta_0
%       \I
%       A \notfree \tau_r
%       \I
%       M_0 \cup \Alpha \preceq M_1
%       \I
%       \Delta_0 \preceq \Delta_1
%       \I
%       \tau_b \subtypes \tau_r
%       \given M_1, \Delta_1
%     $
%     \item \Z $\B{hypo } 
%       \forall \delta .\ \delta \satisfies \Delta_1 \implies \delta \satisfies M_1, \tau_b \subtypes \tau_r 
%     $
%     \item \Z $\B{mutu } 
%       \forall \delta .\ \delta \satisfies \Delta_0 \implies \delta \satisfies Q 
%     $ by theorem \ref{...} \TODO{sequence soundness / mutual dependence}
%     \item \Z $\B{wrt } \Alpha\ Q\ \tau_b\ M_1\ \Delta_1\ M_0\ \Delta_0$
%       \item \Z\Z $\B{for } \delta \B{ assume } \delta \satisfies \Delta$
%         \item \Z\Z\Z $\delta \satisfies \Delta_1 $ by substitution
%         \item \Z\Z\Z $\delta \satisfies \tau_b \subtypes \tau_r$ by application
%         \item \Z\Z\Z $\delta \satisfies \Delta_0 $ by theorem \ref{thm:model_subtyping_sequence_prefix}
%         \item \Z\Z\Z $\delta \satisfies Q$ by application
%         \item \Z\Z\Z $\B{for } e \B{ assume } \delta \satisfies e \hastype \tau_l$ 
%           \item \Z\Z\Z\Z $\delta \satisfies e \hastype \J{EXI[$\Alpha$ $Q$]$\tau_b$}$ by substitution
%           \item \Z\Z\Z\Z $\delta \satisfies e \hastype \tau_r$ by theorem \ref{thm:model_typing_existential_elimination} 
%         \item \Z\Z\Z $\forall e .\ \delta \satisfies e \hastype \tau_l 
%           \implies \delta \satisfies e \hastype \tau_r
%         $ 
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_r$ by definition 
%       \item \Z\Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%       by implication and generalization

%     \item \Z $\B{case } 
%       \tau_r = \J{ALL[$\Alpha$ $Q$]$\tau_b$}
%       \I
%       M = M_1
%       \I
%       \Delta = \Delta_1
%     $
%     \item \Z $\contin
%       Q \given M_0, \Delta_0
%       \I
%       A \notfree \tau_l
%       \I
%       M_0 \cup \Alpha \preceq M_1
%       \I
%       \Delta_0 \preceq \Delta_1
%       \I
%       \tau_l \subtypes \tau_b
%       \given M_1, \Delta_1
%     $
%     \item \Z $\B{hypo } 
%       \forall \delta .\ \delta \satisfies \Delta_1 \implies \delta \satisfies \tau_l \subtypes \tau_b 
%     $
%     \item \Z $\B{mutu } 
%       \forall \delta .\ \delta \satisfies \Delta_0 \implies \delta \satisfies Q 
%     $ by theorem \ref{...} \TODO{sequence soundness / mutual dependence}
%     \item \Z $\B{wrt } \Alpha\ Q\ \tau_b\ M_1\ \Delta_1\ M_0\ \Delta_0$
%       \item \Z\Z $\B{for } \delta \B{ assume } \delta \satisfies \Delta$
%         \item \Z\Z\Z $\delta \satisfies \Delta_1$ by substitution 
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_b$ by application 
%         \item \Z\Z\Z $\delta \satisfies \Delta_0$ by theorem \ref{thm:model_subtyping_sequence_prefix} 
%         \item \Z\Z\Z $\delta \satisfies Q$ by application 
%         \item \Z\Z\Z $\B{for } e \B{ assume } \delta \satisfies e \hastype \tau_l$ 
%           \item \Z\Z\Z\Z $\delta \satisfies e \hastype \J{ALL[$\Alpha$ $Q$]$\tau_b$}$ by theorem \ref{thm:model_typing_universal_introduction} 
%           \item \Z\Z\Z\Z $\delta \satisfies e \hastype \tau_r$ by substitution 
%         \item \Z\Z\Z $\forall e .\ \delta \satisfies e \hastype \tau_l 
%           \implies \delta \satisfies e \hastype \tau_r
%         $ 
%         \item \Z\Z\Z $\delta \satisfies \tau_l \subtypes \tau_r$ by definition 
%       \item \Z\Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%       by implication and generalization
%       \item \Z\Z \TODO{...} 

% % e :  ALL[a b . 3 <: a ] (a,b) \implies e : (a,b)
%     \item \Z $\B{case } 
%       \tau_l = \alpha
%       \I
%       M = M_1
%       \I
%       \Delta = \Delta_1\ \alpha <: \tau_r
%     $
%     \item \Z $\contin
%       \alpha \notin M_0
%       \I
%       M_0, \Delta_0 \entails \Delta_m <:^\sharp \alpha \slash \tau_r
%       \I
%       M_0, \Delta_0 \entails \Tau <:^\dagger \alpha
%       \I
%       M_0 \preceq M_1
%     $
%     \item \Z $\contin
%       \Delta_0 \cup \Delta_m \preceq \Delta_1
%       \I
%       \J{|$(\Tau)$} <: \tau_r \given M_1, \Delta_1
%     $
%     \item \Z $\B{hypo } \forall \delta .\ \delta \satisfies \Delta_1 \implies
%       \delta \satisfies \J{|$(\Tau)$} <: \tau_r
%     $
%     \item \Z $\B{wrt } \alpha\ M_1\ \Delta_1\ M_0\ \Delta_0\ \Delta_m\ \Tau$
%       \item \Z\Z $\B{for } \delta \B{ assume } \delta \satisfies \Delta$
%         \item \Z\Z\Z $\delta \satisfies \Delta_1 \J{($\alpha$<:$\tau_r$)}$ by substitution
%         \item \Z\Z\Z $\delta \satisfies \alpha <: \tau_r$ by theorem \ref{thm:model_subtyping_sequence_last} 
%         \item \Z\Z\Z $\delta \satisfies \tau_l <: \tau_r$ by substitution 
%       \item \Z\Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%       by implication and generalization 
%       \item \Z\Z \TODO{...} 

%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \alpha \notin M_0
%     %   \\
%     %   M_0, \Delta_0, \Delta_0 \entails \alpha \lessdot M
%     %   \\
%     %   M_0, \Delta_0, \Delta_0 \entails \alpha \lessdot \Delta_{skol}
%     %   \\
%     %   M_0, \Delta_0, \Delta_0 \entails \alpha \ll \Tau 
%     %   \\
%     %   M_0, \Delta_0, \Delta_0 \entails \alpha \ll \Delta_{rel}
%     %   \\
%     %   M_0 \preceq M_1
%     %   \\
%     %   \Delta_0 \preceq \Delta_1
%     %   \\
%     %   \widebar{\J{.$\tau_0[\alpha\slash\tau_l]$<:$\tau_1$}}^{\tau_0<:\tau_1 \in \Delta_{rel}} \cup \widebar{\J{.$\tau_l$<:$\tau$}}^{\tau \in \Tau}
%     %   \given M_1, \Delta_1
%     % } {
%     %   \tau_l \subtypes \alpha
%     %   \given M_1, \Delta_1
%     %   \cup \widebar{\tau_l<:z}^{z \in M}
%     %   \cup \widebar{\tau[\alpha\slash\tau_l]<:z}^{\tau<:z \in \Delta_{skol}} \ \tau_l<:\alpha 
%     % }
%       \item \Z\Z \TODO{...} 

%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \alpha \in M_0
%     %   \\
%     %   \alpha <: \tau \in (\Delta_0 \cup \text{factor}(\Delta_0, \alpha))
%     %   \\\\
%     %   M_0 \preceq M_1
%     %   \\
%     %   \Delta_0 \preceq \Delta_1
%     %   \\
%     %   \tau \subtypes \tau_r
%     %   \given M_1, \Delta_1
%     % } {
%     %   \alpha \subtypes \tau_r
%     %   \given M_1, \Delta_1
%     % }
%       \item \Z\Z \TODO{...} 

%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \alpha \in M_0
%     %   \\
%     %   \tau <: \alpha \in \Delta_0
%     %   \\\\
%     %   M_0 \preceq M_1
%     %   \\
%     %   \Delta_0 \preceq \Delta_1
%     %   \\
%     %   \tau_l \subtypes \tau
%     %   \given M_1, \Delta_1
%     % } {
%     %   \tau_l \subtypes \alpha
%     %   \given M_1, \Delta_1
%     % }
%       \item \Z\Z \TODO{...} 

%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \tau_l \subtypes \tau_r \given M_0, \Delta_0
%     %   \\\\
%     %   M_0 \preceq M_1
%     %   \\
%     %   \Delta_0 \preceq \Delta_1
%     %   \\
%     %   Q
%     %   \given M_1, \Delta_1
%     % } {
%     %   \J{ALL[$\Alpha$ $Q$]$\tau_l$}
%     %   \subtypes 
%     %   \tau_r
%     %   \given M_1, \Delta_1 
%     % }

%       \item \Z\Z \TODO{...} 

%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \tau_l \subtypes \tau_r
%     %   \given M_0, \Delta_0
%     %   \\\\
%     %   M_0 \preceq M_1
%     %   \\
%     %   \Delta_0 \preceq \Delta_1
%     %   \\
%     %   Q \given M_1, \Delta_1
%     % } {
%     %   \tau_l
%     %   \subtypes 
%     %   \J{EXI[$\Alpha$ $Q$]$\tau_r$}
%     %   \given M_1, \Delta_1
%     % }
%       \item \Z\Z \TODO{...} 

%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \tau_{ll} \subtypes \tau_r
%     %   \given M, \Delta
%     % } {
%     %   \J{$\tau_{ll}$\&$\tau_{lr}$}  \subtypes \tau_r
%     %   \given M, \Delta
%     % }
%       \item \Z\Z \TODO{...} 

%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \tau_{lr} \subtypes \tau_r
%     %   \given M, \Delta
%     % } {
%     %   \J{$\tau_{ll}$\&$\tau_{lr}$}  \subtypes \tau_r
%     %   \given M, \Delta
%     % }
%       \item \Z\Z \TODO{...} 

%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \tau_l \subtypes \tau_{rl}
%     %   \given M, \Delta
%     % } {
%     %   \tau_l \subtypes \J{$\tau_{rl}$|$\tau_{rr}$}
%     %   \given M, \Delta
%     % }

%       \item \Z\Z \TODO{...} 

%     \item \Z $\B{case } $
%     \item \Z $\B{hypo } $
%     \item \Z $\B{wrt } $
%     % \inferrule {
%     %   \tau_l \subtypes \tau_{rr}
%     %   \given M, \Delta
%     % } {
%     %   \tau_l \subtypes \J{$\tau_{rl}$|$\tau_{rr}$}
%     %   \given M, \Delta
%     % }
%       \item \Z\Z \TODO{...} 

%     \item \Z $\forall \delta .\ \delta \satisfies \Delta \implies \delta \satisfies \tau_l \subtypes \tau_r$ 
%     by induction
%   \item $\square$ by implication
% \end{theorem}

% \begin{theorem} Model typing existential elimination 
%   \label{thm:model_typing_existential_elimination}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies e \hastype \J{EXI[$\Alpha$ $Q$]$\tau_l$}
%       \\
%       \delta \satisfies Q
%       \\
%       \delta \satisfies \tau_l \subtypes \tau_r
%       \\
%       \Alpha \notfree \tau_r
%     } {
%       \delta \satisfies e \hastype \tau_r
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{depends on Proof Subtyping. can we abstract away Proof Subtyping?}

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % TODO: 
% % depends on Proof Subtyping 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % ... |= 2 : (EXI[X . 1 <: X, X <: 3] X)
% % X/1 |= 1 <: X, X <: 3
% % -------------------------
% % X/1 |= 2 : 1 (FAIL) 
% % -------------------------
% % X/1 |= 2 : 4  (PASS)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % X <: 4  -| X, 1 <: X, X <: 3

% \end{theorem}

% \begin{theorem} Model typing universal introduction 
%   \label{thm:model_typing_universal_introduction}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies e \hastype \tau_l
%       \\
%       \delta \satisfies Q
%       \\
%       \delta \satisfies \tau_l \subtypes \tau_r
%       \\
%       \Alpha \notfree \tau_l
%     } {
%       \delta \satisfies e \hastype \J{ALL[$\Alpha$ $Q$]$\tau_r$}
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{depends on Proof Subtyping. can we abstract away Proof Subtyping?}
% \end{theorem}





% \begin{theorem} Model subtyping sequence last 
%   \label{thm:model_subtyping_sequence_last}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \Delta\ \J{($\tau_l$<:$\tau_r$)}
%     } {
%       \delta \satisfies \tau_l \subtypes \tau_r 
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}

% \begin{theorem} Model subtyping sequence reduction 
%   \label{thm:model_subtyping_sequence_reduction}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \Delta\ \delta
%     } {
%       \delta \satisfies \Delta
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}

% \begin{theorem} Model subtyping sequence prefix  
%   \label{thm:model_subtyping_sequence_prefix}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \Delta'
%       \\
%       \Delta \preceq \Delta'
%     } {
%       \delta \satisfies \Delta
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}

% \begin{theorem} Model subtyping sequence uncat 
%   \label{thm:model_subtyping_sequence_uncat}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \Delta \cup \Delta'
%     } {
%       \delta \satisfies \Delta
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}

% \begin{theorem} concatenation prefix 
%   \label{thm:concatenation prefix}
%   \begin{mathpar}
%     \inferrule { 
%     } {
%       \Delta \preceq \Delta \cup \Delta'
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}



% \begin{theorem} Model subtyping unsub left 
%   \label{thm:Modle_subtyping_unsub_left}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \tau_l \subtypes \tau_r
%       \\
%       \alpha\slash\tau_l \in \delta
%     } {
%       \delta \satisfies \alpha \subtypes \tau_r
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}

% \begin{theorem} Model subtyping unsub right 
%   \label{thm:Modle_subtyping_unsub_right}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \tau_l \subtypes \tau_r
%       \\
%       \alpha\slash\tau_r \in \delta
%     } {
%       \delta \satisfies \tau_l \subtypes \alpha
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}

% \begin{theorem} Model subtyping something 
%   \label{thm:Modle_subtyping_something}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \Delta 
%       \\
%       M, \Delta \entails \Tau \subtypes^\sharp \alpha  
%     } {
%       \alpha\slash\J{|$(\Tau)$} \in \delta
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}


% \begin{theorem} Model typing record introduction 
%   \label{thm:model_typing_record_introduction}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \J{$e$.$l$} \hastype \tau
%     } {
%       \delta \satisfies e \hastype \J{$l$->$\tau$}
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}

% \begin{theorem} Model typing implication introduction 
%   \label{thm:model_typing_implication_introduction}
%   \TODO{this is really messed up}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies \J{$e_0$($e_1$)} \hastype \tau_r
%       \\
%       \delta \satisfies e_1 \hastype \tau_l
%       \\
%       \forall \tau .\ \delta \satisfies e_1 \hastype \tau \implies \tau_l \subtypes \tau
%     } {
%       \delta \satisfies e_0 \hastype \J{$\tau_l$->$\tau_r$}
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}

% \begin{theorem} Model typing intersection elimination 
%   \label{thm:model_typing_intersection_elimination}
%   \begin{mathpar}
%     \inferrule { 
%       \delta \satisfies e \hastype \tau_l \& \tau_r
%     } {
%       \delta \satisfies e \hastype \tau_l 
%       \land
%       \delta \satisfies e \hastype \tau_r
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}



% \begin{theorem} Model typing reflexivity
%   \label{thm:model_typing_reflexivity}
%   \begin{mathpar}
%     \inferrule { 
%     } {
%       \delta \satisfies \tau \subtypes \tau
%     } 
%   \end{mathpar}
%   Proof:
%   \item $\B{for } e\ \Gamma \B{ assume } \delta, \Gamma \satisfies e \hastype \tau$
%     \item \Z $\delta, \Gamma \satisfies e \hastype \tau$ by identity
%   \item $\forall e\ \Gamma .\ \delta, \Gamma \satisfies e \hastype \tau \implies \delta, \Gamma \satisfies e \hastype \tau$
%   by implication and generalization
%   \item $\square$ by definition
% \end{theorem}


% \begin{theorem}(Model typing subsumption)
%   \label{thm:model_typing_subsumption}
%   \begin{mathpar}
%     \inferrule { 
%       \delta, \Gamma \satisfies e \hastype \tau_l 
%       \\
%       \delta, \Gamma \satisfies \tau_l <: \tau_r
%     } {
%       \delta, \Gamma \satisfies e \hastype \tau_r
%     } 
%   \end{mathpar}
%   Proof: 
%   \item $\B{assume } \delta, \Gamma \satisfies e \hastype \tau_l 
%   \I \delta, \Gamma \satisfies \tau_l <: \tau_r
%   $
%     \item \Z $\B{invert on}\ \delta, \Gamma \satisfies \tau_l <: \tau_r$
%     \item \Z $\B{case}\ \forall e' .\ \delta, \Gamma \satisfies e' : \tau_l \implies \delta, \Gamma \satisfies e' : \tau_r$
%       \item \Z\Z $\forall e' .\ \delta, \Gamma \satisfies e' : \tau_l \implies \delta, \Gamma \satisfies e' : \tau_r$ by identity
%     \item \Z $\forall e' .\ \delta, \Gamma \satisfies e' : \tau_l \implies \delta, \Gamma \satisfies e' : \tau_r$ by inversion
%     \item \Z $\delta, \Gamma \satisfies e : \tau_l \implies \delta, \Gamma \satisfies e : \tau_r$ by instantiation 
%     \item \Z $\delta, \Gamma \satisfies e : \tau_r$ by application
%   \item $\square$ by implication 
% \end{theorem}

% \begin{theorem}(Model typing implication elimination)
%   \label{thm:model_typing_implication_elimination}
%   \begin{mathpar}
%     \inferrule { 
%       \delta, \Gamma \satisfies e_0 \hastype \tau_l \J{->} \tau_r
%       \\
%       \delta, \Gamma \satisfies e_1 \hastype \tau_l
%     } {
%       \delta, \Gamma \satisfies e_0\J{(}e_1\J{)} \hastype \tau_r
%     } 
%   \end{mathpar}

%   \item $\B{assume }
%     \delta, \Gamma \satisfies e_0 \hastype \tau_l \J{->} \tau_r
%     \I 
%     \delta, \Gamma \satisfies e_1 \hastype \tau_l
%   $ 

%     \item \Z $\B{def } \sigma \B{ s.t. } \delta, \sigma \satisfies \Gamma$ by theorem \ref{...}
%     \item \Z $\B{induct on } \delta, \Gamma \satisfies e_0 \hastype \tau_l \J{->} \tau_r$

%     \item \Z $\B{case }$ \TODO{...}

%     % \inferrule { 
%     %   \delta, \Gamma \cup \Gamma' \satisfies p \pattype \tau_p
%     %   \\
%     %   \delta, \Gamma \cup \Gamma'  \satisfies e \hastype \tau_r
%     %   \\\\
%     %   \forall e .\ 
%     %     \delta, \Gamma \satisfies e \hastype \tau_l 
%     %     \implies
%     %     \delta, \Gamma \satisfies e \hastype \tau_p 
%     %     \land
%     %     (\forall \tau_n\ \tau .\ \delta, \Gamma \satisfies F \hastype \J{$\tau_n$->$\tau$} \implies \neg (\delta, \Gamma \satisfies e \hastype \tau_n))
%     % } {
%     %   \delta, \Gamma \satisfies \J{$F$*$p$=>$e$} \hastype \J{$\tau_l$->$\tau_r$}
%     % }

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%     % \inferrule { 
%     %   \delta, \Gamma \satisfies F \hastype \J{$\tau_l$->$\tau_r$}
%     % } {
%     %   \delta, \Gamma \satisfies \J{$F$*$p$=>$e$} \hastype \J{$\tau_l$->$\tau_r$}
%     % } 
%     \item \Z $\B{case }
%       e_0 = \J{$F$?$p$=>$e_2$}
%       \I
%       \delta, \Gamma \satisfies F \hastype \J{$\tau_l$->$\tau_r$}
%     $ 
%     \item \Z $\B{hypo }
%       \delta, \Gamma \satisfies \J{$F$($e_1$)} \hastype \tau_r
%     $
%     \item \Z $\B{wrt }
%       F\ p\ e_2 
%     $
%       \item \Z\Z $\VDash \J{$F$($e_1$)}[\sigma] $
%       by theorem \ref{thm:model_typing_soundness}
%       \item \Z\Z $\B{invert on } \VDash \J{$F$($e_1$)}[\sigma]$
%       \item \Z\Z $\B{case } \J{$F$($e_1$)}[\sigma] = v$
%       \item \Z\Z $\B{wrt } v$
%         \item \Z\Z\Z $\J{$F$($e_1$)}[\sigma] \neq v$ by definition 
%         \item \Z\Z\Z $\bot$ by application
%       \item \Z\Z $\B{case } 
%         (\J{$F$($e_1$)})[\sigma] \rightsquigarrow e_3
%         \I
%         \delta, \Gamma \satisfies e_3 \hastype \tau_r
%       $
%       \item \Z\Z $\B{wrt } e_3$
%         \item \Z\Z\Z $(\J{$F$($e_1$)})[\sigma] = \J{$F[\sigma]$($e_1[\sigma]$)}$ by definition
%         \item \Z\Z\Z $\J{$F[\sigma]$($e_1[\sigma]$)} \rightsquigarrow e_3$ by substitution 

%         \item \Z\Z\Z $\B{def } F' \B{ s.t. } F[\sigma] = F'$ by theorem \ref{...} \TODO{...}
%         \item \Z\Z\Z $\B{def } e_1' \B{ s.t. } e_1[\sigma] = e_1'$ by theorem \ref{...} \TODO{...}

%         \item \Z\Z\Z $\text{FV}(e_2[\sigma\backslash\text{FV}(p)]) \subseteq \text{FV}(p)$ 
%         by theorem \ref{...} \TODO{...}

%         \item \Z\Z\Z $\J{$F'$($e_1'$)} \rightsquigarrow e_3$ by substitution 
%         \item \Z\Z\Z $\J{($F'$?$p$=>$e_2[\sigma\backslash\text{FV}(p)]$)($e_1'$)} \rightsquigarrow e_3$ by definition 
%         \item \Z\Z\Z $(\J{$F[\sigma]$?$p$=>$e_2[\sigma\backslash\text{FV}(p)]$)($e_1[\sigma]$)} \rightsquigarrow e_3$ by substitution 

%         \item \Z\Z\Z $(\J{($F$?$p$=>$e_2$)($e_1$)})[\sigma] = \J{($F[\sigma]$?$p$=>$e[\sigma\backslash\text{FV}(p)]$)($e_1[\sigma]$)}
%         $ by definition
%         \item \Z\Z\Z $(\J{($F$?$p$=>$e_2$)($e_1$)})[\sigma] \rightsquigarrow e_3$ by substitution 

%         \item \Z\Z\Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)($e_1$)} \hastype \tau_r$ by definition
%       \item \Z\Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)($e_1$)} \hastype \tau_r$ by inversion 
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     %%% OLD 
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     % \item \Z $\B{case }
%     %   \delta, \Gamma \cup \Gamma' \satisfies p \hastype \tau_l
%     %   \I
%     %   \delta, \Gamma \cup \Gamma'  \satisfies e \hastype \tau_r
%     % $
%     % \item \Z $ 
%     %   \contin
%     %   F = \epsilon \lor \delta, \Gamma \satisfies F \hastype \tau_l \J{->} \tau_r
%     %   \I
%     %   e_0 = \J{($F$?$p$=>$e$)} 
%     % $
%     % \item \Z $
%     %   \B{hypo} \  \delta, \Gamma \satisfies F \hastype \tau_l \J{->} \tau_r \implies \delta, \Gamma \satisfies \J{$F$($e_1$)} \hastype \tau_r
%     % $
%     % \item \Z $
%     %   \B{wrt} \ F \ p \ e \ \Gamma' \  
%     % $
%     %   \item \Z\Z $F = \epsilon \lor \delta, \Gamma \satisfies \J{$F$($e_1$)} \hastype \tau_r$ by application
%     %   \item \Z\Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)} \hastype \tau_l \J{->} \tau_r$ by substitution 
%     %   \item \Z\Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)}\J{(}e_1\J{)} \hastype \tau_r$ by theorem \ref{thm:model_typing_reduced_implication_elimination}
%     %   \item \Z\Z $\delta, \Gamma \satisfies e_0\J{(}e_1\J{)} \hastype \tau_r$ by substitution 
%     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%     \item \Z $\B{case }
%       \delta, \sigma \satisfies \Gamma
%       \I
%       e_0[\sigma] \rightsquigarrow e_0'
%       \I
%       \delta, \Gamma \satisfies e_0' \hastype \tau_l \J{->} \tau_r
%     $
%     \item \Z $\B{hypo}\ 
%       \delta, \Gamma \satisfies e_0' \hastype \tau_l \J{->} \tau_r
%       \implies
%       \delta, \Gamma \satisfies \J{$e_0'$($e_1$)} \hastype \tau_r
%     $
%     \item \Z $ 
%     \B{wrt}\ \sigma\ e_0' 
%     $
%       \item \Z\Z $\delta, \Gamma \satisfies e_0'\J{(}e_1\J{)} \hastype \tau_r$ by application 
%       \item \Z\Z $e_0[\sigma]\J{(}e_1\J{)} \rightsquigarrow e_0'\J{(}e_1\J{)}$
%       \item \Z\Z ($e_0\J{(}e_1\J{)})[\sigma] \rightsquigarrow e_0'\J{(}e_1\J{)}$
%       \item \Z\Z $\delta, \Gamma \satisfies e_0\J{(}e_1\J{)} \hastype \tau_r$ 

%     \item \Z $\delta, \Gamma \satisfies e_0\J{(}e_1\J{)} \hastype \tau_r$ by induction
%   \item $\square$
% \end{theorem}

\begin{theorem}\ Model typing reduced implication elimination  

  \label{thm:model_typing_reduced_implication_elimination}
  \begin{mathpar}
    \inferrule {
      \delta, \Gamma \satisfies \J{($F$?$p$=>$e$)} \hastype \tau_l \J{->} \tau_r
      \\
      \delta, \Gamma \satisfies e_1 \hastype \tau_l
      \\
      F = \epsilon \lor \delta, \Gamma \satisfies \J{$F$($e_1$)} \hastype \tau_r
    } {
      \delta, \Gamma \satisfies \J{($F$?$p$=>$e$)}\J{(}e_1\J{)} \hastype \tau_r
    } 
  \end{mathpar}

  \item $\B{assume } \VDash e_1[\sigma]$


    \item \Z $\B{def } \sigma \B{ s.t. } \delta, \sigma \satisfies \Gamma $ by theorem \ref{thm:model_typing_assignability} 
    \item \Z $\VDash e_1[\sigma]$ by theorem \ref{thm:model_typing_soundness}
    \item \Z $\B{induct on } \VDash e_1[\sigma]$

    \item \Z $\B{case } e_1[\sigma] = v_1 $
    \item \Z $\B{wrt } v_1$  
      \item \Z\Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)($e_1$)} \hastype \tau_r$ by theorem \ref{thm:model_typing_fully_reduced_implication_elimination}

    \item \Z $\B{case}\ e_1[\sigma] \rightsquigarrow e_1' \I \VDash e_1'$
    \item \Z $\B{hypo}\ \VDash e_1' \implies \delta, \Gamma \satisfies \J{($F$?$p$=>$e$)($e_1'$)} \hastype \tau_r$
    \item \Z $\B{wrt}\ e_1' $

      \item \Z\Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)($e_1'$)} \hastype \tau_r$ by application
      \item \Z\Z $\J{($F$?$p$=>$e$)$[\sigma]$($e_1[\sigma]$)} \rightsquigarrow \J{($F$?$p$=>$e$)$[\sigma]$($e_1'$)}$ by definition 
      \item \Z\Z $\forall x .\ x \notin \B{FV}(e_1')$ by theorem \ref{thm:reduction_closed} 
      \item \Z\Z $e_1' = e_1'[\sigma]$ by by theorem \ref{thm:closed_substitution} 
      \item \Z\Z $\J{($F$?$p$=>$e$)$[\sigma]$($e_1[\sigma]$)} \rightsquigarrow \J{($F$?$p$=>$e$)$[\sigma]$($e_1'[\sigma]$)}$ by substitution 
      \item \Z\Z $(\J{($F$?$p$=>$e$)($e_1$)})[\sigma] \rightsquigarrow (\J{($F$?$p$=>$e$)($e_1'$)})[\sigma]$ by definition 
      \item \Z\Z $\sigma \cup \epsilon = \sigma$ by definition 
      \item \Z\Z $(\J{($F$?$p$=>$e$)($e_1$)})[\sigma] \rightsquigarrow (\J{($F$?$p$=>$e$)($e_1'$)})[\sigma \cup \epsilon]$ by substitution 
      \item \Z\Z $\Gamma \cup \epsilon = \Gamma$ by definition
      \item \Z\Z $\delta, \epsilon \satisfies \epsilon$ by definition
      \item \Z\Z $\delta, \Gamma \cup \epsilon \satisfies \J{($F$?$p$=>$e$)($e_1'$)}$ by substitution 
      \item \Z\Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)}\J{(}e_1\J{)} \hastype \tau_r$ by definition
    \item \Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)}\J{(}e_1\J{)} \hastype \tau_r$ by induction
  \item $\square$ by implication 
\end{theorem}

% \begin{theorem}\ Model typing fully reduced implication elimination 
%   \label{thm:model_typing_fully_reduced_implication_elimination}
%   \begin{mathpar}
%     \inferrule {
%       \delta, \Gamma \satisfies \J{($F$?$p$=>$e$)} \hastype \tau_l \J{->} \tau_r
%       \\
%       F = \epsilon \lor \delta, \Gamma \satisfies \J{$F$($e_1$)} \hastype \tau_r
%       \\
%       \delta \satisfies e_1 \hastype \tau_l
%       \\
%       \delta, \sigma \satisfies \Gamma 
%       \\
%       e_1[\sigma] = v_1
%       \\
%     } {
%       \delta, \Gamma \satisfies \J{($F$?$p$=>$e$)($e_1$)} \hastype \tau_r
%     } 
%   \end{mathpar}
%   Proof:
%   \item $\B{assume}\ F = \epsilon \lor \delta, \Gamma \satisfies F \hastype \tau_l \J{->} \tau_r$
%     \TODO{add more assumptions}
%     \item \Z $\delta \satisfies e_1[\sigma] \hastype \tau_l$ by theorem \ref{thm:model_typing_valuation} 
%     \item \Z $\delta \satisfies v_1 \hastype \tau_l$ by substitution 
%     \item \Z $\B{invert on}\ F = \epsilon \lor \delta, \Gamma \satisfies F \hastype \tau_l \J{->} \tau_r$
%     \item \Z $\B{case } F = \epsilon$ 
%       \item \Z\Z $\delta, \Gamma \satisfies \J{$F$?$p$=>$e$} \hastype \tau_l \J{->} \tau_r$ by theorem \ref{thm:model_typing_unwrapping} 
%       \item \Z\Z $\delta, \Gamma \satisfies \J{?$p$=>$e$} \hastype \tau_l \J{->} \tau_r$ by substitution 

%       \item \Z\Z $\B{def}\ \sigma' \B{ s.t. } p \equiv v_1 \given \sigma'$ 
%       by theorem \ref{thm:model_typing_pattern_matching} 

%       \item \Z\Z $\B{for } e'$ 
%         \item \Z\Z\Z $\neg \epsilon[\sigma]\J{($v_1$)} \rightsquigarrow e'$ by definition
%         \item \Z\Z\Z $\neg F[\sigma]\J{($v_1$)} \rightsquigarrow e'$ by substitution 
%       \item \Z\Z $\forall e' .\ \neg F[\sigma]\J{($v_1$)} \rightsquigarrow e'$ by generalization 

%       \item \Z\Z $\J{($F[\sigma]$?$p$=>$e[\sigma\backslash\B{FV}(p)]$)($v_1$)} \rightsquigarrow e[\sigma\backslash\B{FV}(p)][\sigma]$ by definition 

%       \item \Z\Z $\forall x .\ x \in \B{FV}(p) \iff x \in \B{dom}(\sigma')$ 
%       by theorem \ref{thm:pattern_matching_consistency}
%       \item \Z\Z $\sigma\backslash\B{FV}(p) = \sigma\backslash\B{dom}(\sigma')$ 
%       by theorem \ref{thm:consistency_diffing}
%       \item \Z\Z $e[\sigma\backslash\B{dom}(\sigma')][\sigma'] = e[\sigma \cup \sigma']$ 
%       by theorem \ref{thm:concatenation_substitution}

%       \item \Z\Z $\J{($F[\sigma]$?$p$=>$e[\sigma\backslash\B{FV}(p)]$)($v_1$)} \rightsquigarrow e[\sigma\backslash\B{dom}(\sigma')][\sigma]$ 
%         by substitution
%       \item \Z\Z $\J{($F[\sigma]$?$p$=>$e[\sigma\backslash\B{FV}(p)]$)($v_1$)} \rightsquigarrow e[\sigma \cup \sigma']$ 
%         by substitution 
%       \item \Z\Z $\J{($F$?$p$=>$e$)$[\sigma]$($v_1$)} \rightsquigarrow e[\sigma \cup \sigma']$ by definition 
%       \item \Z\Z $\J{($F$?$p$=>$e$)$[\sigma]$($e_1[\sigma]$)} \rightsquigarrow e[\sigma \cup \sigma']$ by substitution  

%       \item \Z\Z $\J{($F$?$p$=>$e$)$[\sigma]$($e_1[\sigma]$)} = (\J{($F$?$p$=>$e$)($e_1$)})[\sigma]$ by definition  
%       \item \Z\Z $(\J{($F$?$p$=>$e$)($e_1$)})[\sigma] \rightsquigarrow e[\sigma \cup \sigma']$ by substitution  

%       \item \Z\Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)($e_1$)} \hastype \tau_r$ by definition

%     \item \Z $\B{case } \delta, \Gamma \satisfies \J{$F$($e_1$)} \hastype \tau_r$ 
%       \item \Z\Z $\B{def } e' \B{ s.t. } (\J{$F$($e_1$}))[\sigma] \rightsquigarrow e' \land \delta, \Gamma \satisfies e' \hastype \tau_r$ by theorem \ref{thm:model_typing_function_progress}
%       \item \Z\Z $(\J{($F$?$p$=>$e$)($e_1$)})[\sigma] \rightsquigarrow e'$ by definition 
%       \item \Z\Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)($e_1$)} \hastype \tau_r$ by definition
%     \item \Z $\delta, \Gamma \satisfies \J{($F$?$p$=>$e$)($e_1$)} \hastype \tau_r$ by inversion 
%   \item $\square$ by implication
% \end{theorem}


% \begin{theorem}\ (Pattern matching consistency)
%   \label{thm:pattern_matching_consistency}
%   \begin{mathpar}
%     \inferrule {
%       p \equiv v \given \sigma
%     } {
%       \forall x .\ x \in \B{FV}(p) \iff x \in \B{dom}(\sigma)
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
%   \item $\square$
% \end{theorem}



% \begin{theorem}\ (Consistency diffing)
%   \label{thm:consistency_diffing}
%   \begin{mathpar}
%     \inferrule {
%       \forall x .\ x \in X_l \iff x \in X_r 
%     } {
%       \sigma\backslash X_l = \sigma\backslash X_r
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Concatenation Substitution )
%   \label{thm:concatenation_substitution}
%   \begin{mathpar}
%     \inferrule {
%     } {
%       e[\sigma\backslash\B{dom}(\sigma')][\sigma'] = e[\sigma \cup \sigma']
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
%   \item $\square$
% \end{theorem}



% \begin{theorem}(Model typing valuation)
%   \label{thm:model_typing_valuation}
%   \begin{mathpar}
%     \inferrule {
%       \delta, \Gamma \satisfies e \hastype \tau 
%       \\
%       \delta, \sigma \satisfies \Gamma
%     } {
%       \delta \satisfies e[\sigma] \hastype \tau 
%     } 
%   \end{mathpar}
%   Proof:
%   \item $\B{assume } 
%     \delta, \Gamma \satisfies e \hastype \tau 
%     \I
%     \delta, \sigma \satisfies \Gamma
%   $
%   \item \TODO{...}
%   \item $\square$
% \end{theorem}


% \begin{theorem}(Model typing pattern matching)
%   \label{thm:model_typing_pattern_matching}
%   \begin{mathpar}
%     \inferrule {
%       \delta, \Gamma \satisfies \J{?$p$=>$e$} \hastype \tau_l \J{->} \tau_r
%       \\
%       \delta \satisfies v \hastype \tau_l 
%     } {
%       \exists \sigma .\  p \equiv v \given \sigma
%     } 
%   \end{mathpar}
%   Proof:
%   \item $\B{assume } 
%     \delta, \Gamma \satisfies \J{?$p$=>$e$} \hastype \tau_l \J{->} \tau_r
%     \I
%     \delta \satisfies v \hastype \tau_l 
%   $
%   \item \TODO{...}
%   \item $\square$
% \end{theorem}


% \begin{theorem}(Well-formed function valuation)
%   \label{thm:wellformed_function_valuation}
%   \begin{mathpar}
%     \inferrule {
%       \VDash F
%     } {
%       \exists v .\ v = F 
%     } 
%   \end{mathpar}
% \end{theorem}
% \begin{proof}
%   \item $\B{assume } \VDash F$ 
%     \item \Z $\B{invert on } \VDash F$
%     \item \Z $\B{case } v = F$
%       \item \Z\Z $v = F$ by identity
%     \item \Z $\B{case } F \rightsquigarrow e$
%     \item \Z $\B{wrt } e$
%       \item \Z\Z $\neg F \rightsquigarrow e$ by definition
%       \item \Z\Z $\bot$ by application 
%     \item \Z $v = F$ by inversion 
%   \item $\square$
% \end{proof}


% \begin{theorem}(Reduction closed)
%   \label{thm:reduction_closed}
%   \begin{mathpar}
%     \inferrule {
%       e \rightsquigarrow e'
%     } {
%       \forall x .\ x \notin \B{FV}(e')
%     } 
%   \end{mathpar}
%   Proof:
%   \item $\B{assume } 
%     e \rightsquigarrow e'
%   $
%   \item \TODO{...}
%   \item $\square$
% \end{theorem}

% \begin{theorem}(Closed substitution)
%   \label{thm:closed_substitution}
%   \begin{mathpar}
%     \inferrule {
%       \forall x .\ x \notin \B{FV}(e)
%     } {
%       e = e[\sigma]
%     } 
%   \end{mathpar}
%   Proof:
%   \item $\B{assume } 
%     \forall x .\ x \notin \B{FV}(e)
%   $
%   \item \TODO{...}
%   \item $\square$
% \end{theorem}



% % \begin{theorem}(Progress of pattern matching)
% %   \label{thm:pattern_matching_progress}
% %   \begin{mathpar}
% %     \inferrule {
% %       \J{*$p$=>$e$} \in F 
% %       \\
% %       p \equiv v \given \sigma 
% %       \\
% %       \forall e' .\ \J{*$p$=>$e'$} \in F \implies e' = e 
% %     } {
% %       \exists e' .\ F\J{(}v\J{)} \rightsquigarrow e'
% %     } 
% %   \end{mathpar}
% %   Proof:
% %   \item $\B{for } p\ e\ F\ v\ \sigma\ \B{assume }
% %       \J{*$p$=>$e$} \in F 
% %       \I
% %       p \equiv v \given \sigma 
% %       \I
% %       \forall e' .\ \J{*$p$=>$e'$} \in F \implies e' = e 
% %   $

% %   \item \Z $\B{case }
% %     F = F'\ \J{*$p$=>$e$} 
% %     \I
% %     \J{*$p$=>$e$} \notin F'
% %   $

% %   \item \Z\Z $\B{for } e'$
% %   \item \Z\Z\Z $\B{case}\ F'\J{($v$)} \rightsquigarrow e'$
% %   \item \Z\Z\Z\Z $\J{(}F'\ \J{*}p\J{=>}e\J{)(} v \J{)} \rightsquigarrow e'$ by definition
% %   \item \Z\Z\Z\Z $F\J{(}v\J{)} \rightsquigarrow e'$ by substitution 
% %   \item \Z\Z\Z $\B{case}\ \neg F'\J{($v$)} \rightsquigarrow e'$
% %   \item \Z\Z\Z\Z $\J{(}F'\ \J{*}p\J{=>}e\J{)(} v \J{)} \rightsquigarrow e[\sigma]$ by definition
% %   \item \Z\Z\Z\Z $F\J{(}v\J{)} \rightsquigarrow e[\sigma]$ by substitution 
% %   \item \Z\Z\Z $\exists e'' .\ F\J{(}v\J{)} \rightsquigarrow e''$ by decidability of $F'\J{($v$)} \rightsquigarrow e'$
% %   \item \Z\Z $\forall e' .\ \exists e'' .\ F\J{(}v\J{)} \rightsquigarrow e''$ by summarization
% %   \item \Z\Z $\exists e'' .\ F\J{(}v\J{)} \rightsquigarrow e''$ by independence 

% %   \item \Z $\B{case }
% %     F = F'\ f 
% %     \I
% %     \J{*$p$=>$e$} \in F' 
% %   $
% %   \item \Z\Z $\B{def } e' \B{ s.t. } F'\J{(}v\J{)} \rightsquigarrow e'$ by induction hypothesis
% %   \item \Z\Z $F'\ f\J{(}v\J{)} \rightsquigarrow e'$ by definition
% %   \item \Z\Z $F\J{(}v\J{)} \rightsquigarrow e'$ by definition
% %   \item \Z $\exists e' .\ F\J{(}v\J{)} \rightsquigarrow e'$ by induction on $\J{*$p$=>$e$} \in F$
% %   \item $\square$
% % \end{theorem}

% \begin{theorem}(Model typing assignability)
%   \label{thm:model_typing_assignability}
%   \begin{mathpar}
%     \inferrule { 
%       \delta, \Gamma \satisfies e \hastype \tau
%     } {
%       \exists \sigma .\ \delta, \sigma \satisfies \Gamma 
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{...}
% \end{theorem}


% \begin{theorem}(Model typing soundness)
%   \label{thm:model_typing_soundness}
%   \begin{mathpar}
%     \inferrule { 
%       \delta, \Gamma \satisfies e \hastype \tau
%     } {
%       \forall \sigma .\ 
%       \delta, \sigma \satisfies \Gamma
%       \implies
%       \VDash e[\sigma]
%     } 
%   \end{mathpar}
%   Proof:
%   \item \TODO{redo using universal/implication}
%   \item $\B{assume }
%         \delta, \sigma \satisfies \Gamma 
%         \I \delta, \Gamma \satisfies e \hastype \tau
%   $
%     \item \Z $\B{case } e = \J{@}$
%       \item \Z\Z $\B{def } v \B{ s.t. } \J{@} = v$
%       \item \Z\Z $e[\sigma] = v$
%       \item \Z\Z $ \VDash e[\sigma]$


%     \item \Z $\B{case } 
%       \delta, \Gamma \satisfies e' \hastype \tau'
%       \I 
%       e = \J{<}l\J{>}e' 
%       \I 
%       \tau = \J{<}l\J{>}\tau'
%     $
%       \item \Z\Z $\Vdash e'$ by induction hypothesis
%       \item \Z\Z $\B{case } e'[\sigma] = v$
%         \item \Z\Z\Z $\B{def } v' \B{ s.t. } \J{<}l\J{>}v = v'$
%         \item \Z\Z\Z $\J{<}l\J{>}e'[\sigma] = v'$
%         \item \Z\Z\Z $(\J{<}l\J{>}e')[\sigma] = v'$
%         \item \Z\Z\Z $e[\sigma] = v'$
%         \item \Z\Z\Z $\VDash e[\sigma] $

%       \item \Z\Z $\B{case } e'[\sigma] \rightsquigarrow e'' \I \VDash e''$
%         \item \Z\Z\Z $\J{<}l\J{>}e'[\sigma] \rightsquigarrow \J{<}l\J{>} e''$
%         \item \Z\Z\Z $\VDash \J{<}l\J{>}e'' $
%         \item \Z\Z\Z $\VDash \J{<}l\J{>}e'[\sigma] $
%         \item \Z\Z\Z $\VDash (\J{<}l\J{>}e')[\sigma] $
%         \item \Z\Z\Z $\VDash e[\sigma] $

%       \item \Z\Z $\VDash e[\sigma] $ by cases on $\VDash e' $

%     \item \Z \TODO{remaining introduction cases}

%     \item \Z $\B{case } 
%       x \hastype \tau \in \Gamma
%       \I 
%       x \slash v \in \sigma
%       \I 
%       e = x
%     $
%       \item \Z\Z $x[\sigma] = v$
%       \item \Z\Z $e[\sigma] = v$
%       \item \Z\Z $\VDash e[\sigma] $

%     \item \Z $\B{case } 
%       e[\sigma] \rightsquigarrow e' 
%       \I 
%       \delta, \Gamma \satisfies e' \hastype \tau
%     $ 
%       \item \Z\Z $\VDash e'[\sigma] $ by induction hypothesis
%       \item \Z\Z $\VDash e[\sigma] $

%     \item \Z $\VDash e[\sigma] $ by induction on $\delta, \Gamma \satisfies e \hastype \tau$
%   \item $\square$
%   \item \TODO{Cretin's corresponding theorem is by definition of pretypes on p. 125}
% \end{theorem}

% \noindent
% \B{NOTE: } The induction hypothesis includes the generalized assumption, e.g. $\forall e' .\ e' < e \implies Q(e')$ if inducting on $e$ or $\forall e' .\ (P(e') \implies P(e)), P(e') \implies Q(e')$ if inducting on predicate $P$

% \noindent
% \B{NOTE: } we induct on $\delta, \Gamma \satisfies e \hastype \tau$ instead of $e$, as the predicate acts as a guard/ordering in lieu of a decreasing e.
% This allows us to use the induction hypothesis on the reduction step result in the elimination case.

% \noindent
% \B{NOTE: } Kozen says, "Intuitively, one can appeal to the coinductive hypothesis as long as there
% has been progress in observing the elements of the stream (guardedness) and there is no
% further analysis of the tails (opacity)".  Kozen demonstrates a legal proof by induction on infinite streams too

% % \begin{theorem}(Progress of Proof Typing)
% %   \label{thm:proof_typing_soundness}
% %   \begin{mathpar}
% %     \inferrule { 
% %       \Gamma \entails e \hastype \tau \given Z  
% %     } {
% %       e \B{ progressive}
% %     } 
% %   \end{mathpar}
% %   Proof ... 
% % \end{theorem}

% % \begin{theorem}(Preservation of Proof Typing)
% %   \begin{mathpar}
% %     \inferrule { 
% %       \Gamma \entails e \hastype \tau \given Z  
% %       \\
% %       e \rightsquigarrow e'
% %     } {
% %       \Gamma \entails e' \hastype \tau \given Z  
% %     } 
% %   \end{mathpar}
% %   Proof ... 
% % \end{theorem}


% \begin{definition}\boxed{\delta, \sigma \satisfies \Gamma}
%   \label{def:model_typing_sequence}
%   \begin{mathpar}
%     \inferrule { 
%     } {
%       \delta, \sigma \satisfies \epsilon  
%     } 

%     \inferrule { 
%       \delta, \sigma \satisfies \Gamma 
%       \\
%       \delta \satisfies v \hastype \tau 
%     } {
%       \delta, \sigma \ x \slash v \satisfies \Gamma \ x:\tau 
%     } 
%   \end{mathpar}
% \end{definition}


% \begin{definition} 
%   \label{def:unique_proof_subtyping_environment}
%   Unique Proof Subtyping Environment 
%   \hfill
%   \boxed{\Theta, \Delta \entails \Delta_q \given \Theta', \Delta' \unique}
%   \\
%   \begin{mathpar}
%     \inferrule {
%       \TODO{compeleteness of qualifiers is required for soundness}
%       \\\\
%       \TODO{decidable qualifiers are sound and complete}
%       \\\\
%       \Theta, \Delta \entails \Delta_q \given \Theta', \Delta'
%       \\
%       \textbf{decidable}(\Delta_q)
%       \\\\
%       \forall \Theta'', \Delta'' \qua 
%       \Theta, \Delta \entails
%       \Delta_q \given \Theta'', \Delta'' \implies (\Theta'', \Delta'') = (\Theta', \Delta')
%     } {
%       \Theta, \Delta \entails \Delta_q \given \Theta', \Delta' \unique
%     }
%   \end{mathpar}
% \end{definition}


% \section{Experiments}

% \TODO{develop 12 tree/list experiments}

% \section{Related work}

% \TODO{...}


% \paragraph{Tree interpolation}
% Exemplified by CHC duality solver.

% \paragraph{Hindley-Milner type inference}
% Exemplified by ML.

% \paragraph{Logic programming.}
% Exemplified by Prolog. 


% Similar: both have backchaining. 

% Different: RLT is fully declarative, lacks negations, but has implication. 

% Different: RLT allows comparing inductive relations via subtyping. 

% \paragraph{Semantic subtyping.} 
% Exemplified by XDuce and CDuce. complete subtyping.

% Similar: set-like combinators: union and intersection.

% Different: RLT uses rigid syntactic rules; incomplete subtyping.

% % set theoretic notes: https://pnwamk.github.io/sst-tutorial/#%28part._sec~3asemantic-subtyping%29
% % semantic subtyping: https://www.irif.fr/~gc/papers/semantic_subtyping.pdf
% The terminology "semantic subtyping" vs "syntactic subtyping" are confusing terms. 
% "semantics subtyping" means the semantics of types is determined indirectly by the semantics of another structure.
% "syntactic subtyping" means the semantics of types is determined directly by the type structure

% \paragraph{Extrinsic typing.}
% Exemplified by Typescript, which is unsound. Maybe not as lenient?  
% The static behavior of a program is not necessarily specified/prescribed; 
% it may be over-approximated from the program composition. 
% Intrinsic vs extrinsic is orthogonal to static vs dynamic, although static and dynamic are often used to mean the former.
% All modern languages use a combination of static and dynamic type checking.
% The term "dynamically typed" some times refers to a language that doesn't prescribe static meaning,
% even if it uses both static and dynamic type checking. The term "extrinsic typing" is less ambiguous.

% \paragraph{Refinement Types.}
% Exemplified by Refinement ML. Base types with intersections and subtyping.

% \paragraph{Predicate Subtyping.}
% Exemplified by Liquid Types. An extension of refinement types.

% Similar: both use type inference to infer expressive relational properties. 

% Different: RLT starts with an invalid post-condition, then weakens return type to a valid post-condition from outside in by expanding unions.

% Different: RLT starts with an invalid pre-condition, then strengthens parameter type to a valid pre-condition from inside out by adding intersections.

% Different: Liquid types starts with an invalid post-condition, then uses iterative weakening by dropping conjunctions until a valid post-condition is reached.


% \paragraph{Abstraction Refinement.} 
% Similar: type unification over subtyping resembles abstraction refinement  
% where solving for variables and failing on different sides of the subtyping relation corresponds to
% solving with the abstractor vs solving with the refiner.

% \paragraph{Craig interpolation.} 
% Similar: extracting an recursive type with unions and intersections 
% from a recursive program without needing to specify a predicate universe might be similar to
% craig interpolation.

% \paragraph{PDR.}
% exemplified by IC3. 

% Similar: RLT infers abstract type for return type, 
% then safely constrains the variables in previous step (fix's antecedent) 
% to subtype the least fixed point.
% This lazily propagates the type for the last step to the previous steps.
% This is safe as antecedent is stronger than consequent at any step.
% Seems similar to the notion in PDR of propagating negation of loss points to previous steps. 

% Different: RLT isn't cartesian


\end{document}